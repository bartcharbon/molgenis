var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,v,u){c!=Array.prototype&&c!=Object.prototype&&(c[v]=u.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,v,u,m){if(v){u=$jscomp.global;c=c.split(".");for(m=0;m<c.length-1;m++){var k=c[m];k in u||(u[k]={});u=u[k]}c=c[c.length-1];m=u[c];v=v(m);v!=m&&null!=v&&$jscomp.defineProperty(u,c,{configurable:!0,writable:!0,value:v})}};$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,u,m){var k=this.length||0;0>u&&(u=Math.max(0,k+u));if(null==m||m>k)m=k;m=Number(m);0>m&&(m=Math.max(0,k+m));for(u=Number(u||0);u<m;u++)this[u]=c;return this}},"es6","es3");
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var v=0;return $jscomp.iteratorPrototype(function(){return v<c.length?{done:!1,value:c[v++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,v){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var u=0,m={next:function(){if(u<c.length){var k=u++;return{value:v(k,c[k]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
(function e$jscomp$0(v,u,m){function k(A,w){if(!u[A]){if(!v[A]){var B="function"==typeof require&&require;if(!w&&B)return B(A,!0);if(h)return h(A,!0);throw Error("Cannot find module '"+A+"'");}w=u[A]={exports:{}};v[A][0].call(w.exports,function(f){var b=v[A][1][f];return k(b?b:f)},w,w.exports,e$jscomp$0,v,u,m)}return u[A].exports}for(var h="function"==typeof require&&require,r=0;r<m.length;r++)k(m[r]);return k})({1:[function(c,v,u){function m(){}function k(b,g,d,a,e){b.slice(0,10).fetch(function(f){return f?
h(b,g,d,a,e):a(null,"Couldn't access BAM.")},{timeout:5E3})}function h(f,g,F,a,e){function p(g){if(!g)return a(null,"Couldn't access BAM");g=d(g,g.byteLength);g=new Uint8Array(g);var e=A(g,0);if(21840194!=e)return a(null,"Not a BAM file, magic=0x"+e.toString(16));var b=A(g,4),f="";for(e=0;e<b;++e)f+=String.fromCharCode(g[e+8]);f=A(g,b+8);b+=12;x.chrToIndex={};x.indexToChr=[];for(e=0;e<f;++e){for(var n=A(g,b),D="",p=0;p<n-1;++p)D+=String.fromCharCode(g[b+4+p]);A(g,b+n+4);x.chrToIndex[D]=e;0==D.indexOf("chr")?
x.chrToIndex[D.substring(3)]=e:x.chrToIndex["chr"+D]=e;x.indexToChr.push(D);b=b+8+n}if(x.indices)return a(x)}var x=new m;x.data=f;x.bai=g;x.indexChunks=F;var t=x.indexChunks?x.indexChunks.minBlockIndex:1E9;if(x.indexChunks){g=x.indexChunks.chunks;x.indices=[];for(var n=0;n<g.length;n++)x.indices[n]=null;x.data.slice(0,t).fetch(p)}else x.bai.fetch(function(g){var d;if(g){var n=new Uint8Array(g),E=A(n,0);if(21578050!=E)g=a(null,"Not a BAI file, magic=0x"+E.toString(16));else{E=A(n,4);x.indices=[];for(var l=
8,D=0;D<E;++D){var q=l;var G=n;var J=d=q;var y=A(G,J);J+=4;for(var H=0;H<y;++H){A(G,J);var N=A(G,J+4);J+=8+16*N}H=A(G,J);J+=4;N=1E9;for(var C=J,c=0;c<H;++c){var z=b(G,C);C+=8;if(z){G=z.block;0<z.offset&&(G+=65536);G<N&&(N=G);break}}G=N;d=J+8*H-d;l+=d;t=Math.min(G,t);0<y&&(x.indices[D]=new Uint8Array(g,q,l-q))}g=!0}}else g="Couldn't access BAI";!0!==g?x.bai.url&&"undefined"===typeof e?(x.bai.url=x.data.url.replace(/.bam$/,".bai"),h(f,x.bai,F,a,!0)):a(null,g):x.data.slice(0,t).fetch(p)})}function r(){}
if("undefined"!==typeof c){c("./spans");u=c("./bin");var A=u.readInt;var w=u.readShort;var B=u.readByte;var f=u.readFloat;c=c("./lh3utils");var b=c.readVob;var d=c.unbgzf;var q=c.reg2bins;var z=c.Chunk}c={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};m.prototype.blocksForRange=function(d,g,f){var a=this.indices[d];
if(!a)return[];d=q(g,f);for(var e=[],p=0;p<d.length;++p)e[d[p]]=!0;d=[];var x=[];p=A(a,0);for(var F=4,n=0;n<p;++n){var E=A(a,F),l=A(a,F+4);F+=8;if(e[E])for(var t=0;t<l;++t){var C=b(a,F),c=b(a,F+8);(4681>E?x:d).push(new z(C,c));F+=16}else F+=16*l}p=A(a,F);e=null;f=Math.min(f>>14,p-1);for(p=Math.min(g>>14,p-1);p<=f;++p)(g=b(a,F+4+8*p))&&(!e||g.block<e.block||g.offset<e.offset)&&(e=g);g=[];if(null!=e)for(p=0;p<x.length;++p)a=x[p],a.maxv.block>=e.block&&a.maxv.offset>=e.offset&&g.push(a);x=g;g=[];for(p=
0;p<x.length;++p)g.push(x[p]);for(p=0;p<d.length;++p)g.push(d[p]);g.sort(function(a,g){var e=a.minv.block-g.minv.block;return 0!=e?e:a.minv.offset-g.minv.offset});d=[];if(0<g.length){x=g[0];for(p=1;p<g.length;++p)a=g[p],a.minv.block==x.maxv.block?x=new z(x.minv,a.maxv):(d.push(x),x=a);d.push(x)}return d};m.prototype.fetch=function(b,g,f,a,e){function p(){if(t>=n.length)return a(q);if(C){var b=new Uint8Array(C);b=x.readBamRecords(b,n[t].minv.offset,q,g,f,F,e);C=null;++t;return b?a(q):p()}var D=n[t];
b=D.minv.block;x.data.slice(b,D.maxv.block+65536-b).fetch(function(a){C=d(a,D.maxv.block-D.minv.block+1);return p()})}var x=this;e=e||{};var F=this.chrToIndex[b];if(void 0===F)var n=[];else{if(null===this.indices[F]&&this.indexChunks.chunks[F]){var l=this.indexChunks.chunks[F];return this.bai.slice(l[0],l[1]).fetch(function(d){d=new Uint8Array(d);this.indices[F]=d;return this.fetch(b,g,f,a,e)}.bind(this))}(n=this.blocksForRange(F,g,f))||a(null,"Error in index fetch")}var q=[],t=0,C;p()};var C="=ACxGxxxTxxxxxxN".split(""),
l="MIDNSHP=X???????".split("");m.prototype.readBamRecords=function(b,g,d,a,e,p,x){for(;;){var F=A(b,g);F=g+F+4;if(F>=b.length)return!1;var n=new r,q=A(b,g+4),t=A(b,g+8),c=A(b,g+12),z=(c&65280)>>8,h=c&255;c=A(b,g+16);var D=(c&4294901760)>>16,I=c&65535;c=A(b,g+20);var G=A(b,g+24),P=A(b,g+28);A(b,g+32);n.segment=this.indexToChr[q];n.flag=D;n.pos=t;n.mq=z;x.light&&(n.seqLength=c);if(!x.light){0<=G&&(n.nextSegment=this.indexToChr[G],n.nextPos=P);z="";for(t=0;t<h-1;++t)z+=String.fromCharCode(b[g+36+t]);
n.readName=z;g=g+36+h;h="";for(t=0;t<I;++t)z=A(b,g),h=h+(z>>4)+l[z&15],g+=4;n.cigar=h;I="";h=c+1>>1;for(t=0;t<h;++t)z=b[g+t],I+=C[(z&240)>>4],I.length<c&&(I+=C[z&15]);g+=h;n.seq=I;I="";for(t=0;t<c;++t)I+=String.fromCharCode(b[g+t]+33);g+=c;for(n.quals=I;g<F;){I=String.fromCharCode(b[g],b[g+1]);h=String.fromCharCode(b[g+2]);if("A"==h)h=String.fromCharCode(b[g+3]),g+=4;else if("i"==h||"I"==h)h=A(b,g+3),g+=7;else if("c"==h||"C"==h)h=b[g+3],g+=4;else if("s"==h||"S"==h)h=w(b,g+3),g+=5;else if("f"==h)h=
f(b,g+3),g+=7;else if("Z"==h||"H"==h)for(g+=3,h="";t=b[g++],0!=t;)h+=String.fromCharCode(t);else if("B"==h){h=String.fromCharCode(b[g+3]);t=A(b,g+4);if("i"==h||"I"==h||"f"==h)z=4,D="f"==h?f:A;else if("s"==h||"S"==h)z=2,D=w;else if("c"==h||"C"==h)z=1,D=B;else throw"Unknown array type "+h;g+=8;h=[];for(G=0;G<t;++G)h.push(D(b,g)),g+=z}else throw"Unknown type "+h;n[I]=h}}if(!a||n.pos<=e&&n.pos+c>=a)void 0!==p&&q!=p||d.push(n);if(n.pos>e)return!0;g=F}};"undefined"!==typeof v&&(v.exports={makeBam:k,BAM_MAGIC:21840194,
BAI_MAGIC:21578050,BamFlags:c})},{"./bin":4,"./lh3utils":24,"./spans":37}],2:[function(c,v,u){function m(b){this.type=b}function k(b,g){this.parser=b;this.sink=g}function h(b,g){this.parser=b;this.sink=g;this.wigState=null}if("undefined"!==typeof c){var r=c("./spans");var A=r.Range;var w=r.union;var B=r.intersection;r=c("./sourceadapters").registerParserFactory;v=c("./das");var f=v.DASStylesheet;var b=v.DASStyle;var d=v.DASGroup;var q=c("./utils").shallowCopy}m.prototype.createSession=function(b){return"wig"==
this.type?new h(this,b):new k(this,b)};var z=/([^=]+)=(.+)/,C=/\s/,l=/^[0-9]+,[0-9]+,[0-9]+/;k.prototype.parse=function(b){var g=b.split(C);if(!(3>g.length)){var f=parseInt(g[1])+1;b=parseInt(g[2]);b={segment:g[0],min:f,max:b};3<g.length&&"."!==g[3]&&(b.label=g[3]);4<g.length&&(b.score=parseFloat(g[4]));5<g.length&&(b.orientation=g[5]);if(8<g.length){var a=g[8];l.test(a)&&(b.itemRgb="rgb("+a+")")}if(12<=g.length){a=parseInt(g[6]);var e=parseInt(g[7]);var p=parseInt(g[9]);var x=g[10].split(",").map(function(a){return parseInt(a)});
var t=g[11].split(",").map(function(a){return parseInt(a)});b.type="transcript";var n=new d;n.id=g[3];n.type="transcript";n.notes=[];b.groups=[n];if(12<g.length){var E=n=g[12];13<g.length&&(E=g[13]);g=new d;g.id=n;g.label=E;g.type="gene";b.groups.push(g)}g=null;for(n=0;n<p;++n)E=t[n]+f,E=new A(E,E+x[n]),g=g?w(g,E):E;t=g.ranges();for(f=0;f<t.length;++f)x=t[f],p=q(b),p.min=x.min(),p.max=x.max(),this.sink(p);if(e>a&&(a="+"==b.orientation?new A(a,e+3):new A(a-3,e),a=B(g,a)))for(b.type="translation",a=
a.ranges(),f=e=0;f<a.length;++f)p=f,"-"==b.orientation&&(p=a.length-f-1),x=a[p],p=q(b),p.min=x.min(),p.max=x.max(),b.readframe=e,x=x.max()-x.min(),e=(e+x)%3,this.sink(p)}else this.sink(b)}};k.prototype.flush=function(){};h.prototype.parse=function(b){var g;b=b.split(C);if("fixedStep"==b[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var d=this.span=1;d<b.length;++d)if(g=z.exec(b[d]))"chrom"==g[1]?this.chr=g[2]:"start"==g[1]?this.pos=parseInt(g[2]):"step"==g[1]?this.step=parseInt(g[2]):
"span"==g[1]&&(this.span=parseInt(g[2]))}else if("variableStep"==b[0])for(this.wigState="variableStep",this.chr=null,d=this.span=1;d<b.length;++d)g=z.exec(b[d]),"chrom"==g[1]?this.chr=g[2]:"span"==g[1]&&(this.span=parseInt(g[2]));else this.wigState?"fixedStep"==this.wigState?1==b.length&&(b=parseFloat(b[0]),b={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:b},this.pos+=this.step,this.sink(b)):"variableStep"==this.wigState&&2==b.length&&(g=parseInt(b[0]),b=parseFloat(b[1]),b={segment:this.chr,
min:g,max:g+this.span-1,score:b},this.sink(b)):4>b.length||(b={segment:b[0],min:parseInt(b[1])+1,max:parseInt(b[2]),score:parseFloat(b[3])},this.sink(b))};h.prototype.flush=function(){};m.prototype.getStyleSheet=function(d){var g=new f;if("wig"==this.type){var l=new b;l.glyph="HISTOGRAM";l.BGCOLOR="blue";l.HEIGHT=30;g.pushStyle({type:"default"},null,l)}else l=new b,l.glyph="BOX",l.FGCOLOR="black",l.BGCOLOR="blue",l.HEIGHT=8,l.BUMP=!0,l.LABEL=!0,l.ZINDEX=20,g.pushStyle({type:"default"},null,l),l=new b,
l.glyph="BOX",l.FGCOLOR="black",l.BGCOLOR="red",l.HEIGHT=10,l.BUMP=!0,l.ZINDEX=20,g.pushStyle({type:"translation"},null,l),l=new b,l.glyph="BOX",l.FGCOLOR="black",l.BGCOLOR="white",l.HEIGHT=10,l.ZINDEX=10,l.BUMP=!0,l.LABEL=!0,g.pushStyle({type:"transcript"},null,l),l=new b,l.glyph="HISTOGRAM",l.COLOR1="white",l.COLOR2="black",l.HEIGHT=30,g.pushStyle({type:"density"},null,l);return d(g)};r("bed",function(b){return new m(b)});r("wig",function(b){return new m(b)})},{"./das":10,"./sourceadapters":35,
"./spans":37,"./utils":50}],3:[function(c,v,u){function m(g,b){return g[b]+256*g[b+1]+65536*g[b+2]+16777216*g[b+3]+4294967296*g[b+4]}function k(){}function h(g,b,a,e){this.bwg=g;this.cirTreeOffset=b;this.cirTreeLength=a;this.isSummary=e}function r(g,b,a){var e=new k;e.data=g;e.name=a;e.data.slice(0,512).salted().fetch(function(a){if(!a)return b(null,"Couldn't fetch file");var g=new Uint8Array(a),d=new Int16Array(a);a=new Int32Array(a);var f=g[0]+256*g[1]+65536*g[2]+16777216*g[3];if(2291137574==f)e.type=
"bigwig";else if(2273964779==f)e.type="bigbed";else return 654086024==f||3958540679==f?b(null,"Currently don't support big-endian BBI files"):b(null,"Not a supported format, magic=0x"+f.toString(16));e.version=d[2];e.numZoomLevels=d[3];e.chromTreeOffset=m(g,8);e.unzoomedDataOffset=m(g,16);e.unzoomedIndexOffset=m(g,24);e.fieldCount=d[16];e.definedFieldCount=d[17];e.asOffset=m(g,36);e.totalSummaryOffset=m(g,44);e.uncompressBufSize=a[13];e.extHeaderOffset=m(g,56);e.zoomLevels=[];for(d=0;d<e.numZoomLevels;++d){f=
a[6*d+16];var p=m(g,24*d+72),l=m(g,24*d+80);e.zoomLevels.push({reduction:f,dataOffset:p,indexOffset:l})}e.readChromTree(function(){e.getAutoSQL(function(a){e.schema=a;return b(e)})})},{timeout:5E3})}function A(g,b,a,e,d){this.bbi=g;this.type=b;this.fieldCount=a;this.offset=e;this.field=d}if("undefined"!==typeof c){u=c("./spans");var w=u.Range;var B=u.union;var f=u.intersection;u=c("./das");var b=u.DASFeature;var d=u.DASGroup;var q=c("./utils").shallowCopy;var z=c("./bin").readInt;c=c("jszlib");var C=
c.inflateBuffer;var l=c.arrayCopy}var t=/^[0-9]+,[0-9]+,[0-9]+/;k.prototype.readChromTree=function(g){var b=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var a=this.unzoomedDataOffset;this.data.slice(this.chromTreeOffset,a+4-(a-this.chromTreeOffset&3)-this.chromTreeOffset).fetch(function(a){var e=new Uint8Array(a),d=new Int16Array(a),f=(new Int32Array(a))[2];m(e,16);var n=function(a){var g=e[a],p=d[a/2+1];a+=4;for(var l=0;l<p;++l)if(0==g){a+=f;var x=m(e,a);a+=8;x-=b.chromTreeOffset;n(x)}else{x=
"";for(var D=0;D<f;++D){var q=e[a++];0!=q&&(x+=String.fromCharCode(q))}D=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a+0];a+=8;b.chromsToIDs[x]=D;0==x.indexOf("chr")&&(b.chromsToIDs[x.substr(3)]=D);b.idsToChroms[D]=x;b.maxID=Math.max(b.maxID,D)}};n(32);g(b)})};h.prototype.readWigData=function(g,b,a,e){g=this.bwg.chromsToIDs[g];if(void 0===g)return e([]);this.readWigDataById(g,b,a,e)};h.prototype.readWigDataById=function(g,b,a,e){var d=this;if(this.cirHeader){var f=[],l=0;Date.now();var n=function(e,d,D,f){return(0>
g||e==g)&&d<=a&&D>=b},q=function(a,g){d.bwg.instrument&&console.log("level="+g+"; offset="+a+"; time="+(Date.now()|0));l+=a.length;if(1==a.length&&48==a[0]-d.cirTreeOffset&&d.cachedCirRoot)c(d.cachedCirRoot,0,g),--l,0==l&&d.fetchFeatures(n,f,e);else{for(var b=4+32*d.cirBlockSize,p,x=0;x<a.length;++x){var q=new w(a[x],a[x]+b);p=p?B(p,q):q}b=p.ranges();for(p=0;p<b.length;++p)C(a,b[p],g)}},C=function(a,g,b,p){g.max();g.min();d.bwg.data.slice(g.min(),g.max()-g.min()).fetch(function(D){for(var p=0;p<a.length;++p)g.contains(a[p])&&
(c(D,a[p]-g.min(),b),48==a[p]-d.cirTreeOffset&&0==a[p]-g.min()&&(d.cachedCirRoot=D),--l,0==l&&d.fetchFeatures(n,f,e))})},c=function(e,d,D){var n=new Uint8Array(e),p=new Int16Array(e);e=new Int32Array(e);var l=n[d];p=p[d/2+1];d+=4;if(0!=l)for(var y=0;y<p;++y){var x=d/4;var N=e[x];var E=e[x+1];l=e[x+2];var C=e[x+3];x=m(n,d+16);D=m(n,d+24);(0>g||N<g||N==g&&E<=a)&&(0>g||l>g||l==g&&C>=b)&&f.push({offset:x,size:D});d+=32}else{var c=[];for(y=0;y<p;++y)x=d/4,N=e[x],E=e[x+1],l=e[x+2],C=e[x+3],x=m(n,d+16),
(0>g||N<g||N==g&&E<=a)&&(0>g||l>g||l==g&&C>=b)&&c.push(x),d+=24;0<c.length&&q(c,D+1)}};q([d.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(f){d.cirHeader=f;f=new Int32Array(d.cirHeader);d.cirBlockSize=f[1];d.readWigDataById(g,b,a,e)})};h.prototype.fetchFeatures=function(g,d,a){var e=this;d.sort(function(a,g){return(a.offset|0)-(g.offset|0)});if(0==d.length)a([]);else{var f=[],x=function(a,g,d,p){p||(p={});var n=new b;n._chromId=a;n.segment=e.bwg.idsToChroms[a];
n.min=g;n.max=d;n.type=e.bwg.type;for(var l in p)n[l]=p[l];f.push(n)},q=function(){if(0==d.length)Date.now(),a(f);else{var b=d[0];if(b.data)e.parseFeatures(b.data,x,g),d.splice(0,1),q();else{var p=b.offset,c=b.size;for(b=1;b<d.length&&d[b].offset==p+c;)c+=d[b].size,++b;e.bwg.data.slice(p,c).fetch(function(a){for(var g=0,b=0;g<c;){var D=d[b];if(0<e.bwg.uncompressBufSize)var f=C(a,g+2,D.size-2);else f=new Uint8Array(D.size),l(new Uint8Array(a,g,D.size),0,f,0,D.size),f=f.buffer;D.data=f;g+=D.size;++b}q()})}}};
q()}};h.prototype.parseFeatures=function(g,b,a){var e;var p=new Uint8Array(g);if(this.isSummary){new Int16Array(g);var l=new Int32Array(g);var C=new Float32Array(g);p=g.byteLength/32;for(e=0;e<p;++e){g=l[8*e];var n=l[8*e+1];var E=l[8*e+2];var c=l[8*e+3],z=C[8*e+5],h=C[8*e+6];a(g,n+1,E)&&(c={type:"bigwig",score:h/c,maxScore:z},"bigbed"==this.bwg.type&&(c.type="density"),b(g,n+1,E,c))}}else if("bigwig"==this.bwg.type)if(e=new Int16Array(g),l=new Int32Array(g),C=new Float32Array(g),g=l[0],z=l[1],h=l[3],
c=l[4],n=p[20],p=e[11],3==n)for(e=0;e<p;++e){var F=C[e+6];l=z+e*h+1;n=z+e*h+c;a(g,l,n)&&b(g,l,n,{score:F})}else if(2==n)for(e=0;e<p;++e)n=l[2*e+6]+1,E=n+c-1,F=C[2*e+7],a(g,n,E)&&b(g,n,E,{score:F});else if(1==n)for(e=0;e<p;++e)n=l[3*e+6]+1,E=l[3*e+7],F=C[3*e+8],n>E&&(n=E),a(g,n,E)&&b(g,n,E,{score:F});else console.log("Currently not handling bwgType="+n);else if("bigbed"==this.bwg.type)for(e=0,c=this.bwg.definedFieldCount,z=this.bwg.schema;e<p.length;){g=p[e+3]<<24|p[e+2]<<16|p[e+1]<<8|p[e+0];n=p[e+
7]<<24|p[e+6]<<16|p[e+5]<<8|p[e+4];E=p[e+11]<<24|p[e+10]<<16|p[e+9]<<8|p[e+8];e+=12;for(F="";;)if(h=p[e++],0!=h)F+=String.fromCharCode(h);else break;h={};var D=0<F.length?F.split("\t"):[];0<D.length&&3<c&&(h.label=D[0]);1<D.length&&4<c&&(F=parseInt(D[1]),isNaN(F)||(h.score=F));2<D.length&&5<c&&(h.orientation=D[2]);5<D.length&&8<c&&(F=D[5],t.test(F)&&(h.itemRgb="rgb("+F+")"));if(D.length>c-3&&z)for(F=c-3;F<D.length;++F)h[z.fields[F+3].name]=D[F];if(a(g,n+1,E,D))if(12>c)b(g,n+1,E,h);else{F=D[3]|0;var I=
D[4]|0,G=D[6]|0,P=D[7].split(","),y=D[8].split(",");h.exonFrames&&(C=h.exonFrames.split(","),h.exonFrames=void 0);h.type="transcript";var H=new d;for(l in h)H[l]=h[l];H.id=D[0];H.segment=this.bwg.idsToChroms[g];H.min=n+1;H.max=E;H.notes=[];h.groups=[H];if(9<D.length){var N=E=h.geneName||D[9];10<D.length&&(N=D[10]);h.geneName2&&(N=h.geneName2);D=q(H);D.id=E;D.label=N;D.type="gene";h.groups.push(D)}E=[];for(D=0;D<G;++D)H=(y[D]|0)+n,H=new w(H,H+(P[D]|0)),E.push(H);P=B(E);G=P.ranges();for(E=0;E<G.length;++E)n=
G[E],b(g,n.min()+1,n.max(),h);if(I>F&&(n="+"==h.orientation?new w(F,I+3):new w(F-3,I),n=f(P,n))){h.type="translation";F=n.ranges();for(P=I=0;F[0].min()>G[P].max();)P++;for(E=0;E<F.length;++E)G=E,"-"==h.orientation&&(G=F.length-E-1),n=F[G],h.readframe=I,C&&(G=parseInt(C[G+P]),"number"===typeof G&&0<=G&&2>=G&&(h.readframe=G,h.readframeExplicit=!0)),G=n.max()-n.min(),I=(I+G)%3,b(g,n.min()+1,n.max(),h)}}}else throw Error("Don't know what to do with "+this.bwg.type);};h.prototype.getFirstAdjacent=function(g,
b,a,e){g=this.bwg.chromsToIDs[g];if(void 0===g)return e([]);this.getFirstAdjacentById(g,b,a,e)};h.prototype.getFirstAdjacentById=function(g,b,a,e){var d=this;if(this.cirHeader){var f=null,l=-1,n=-1,q=0;Date.now();var C=function(a,g){q+=a.length;for(var b=4+32*d.cirBlockSize,e,D=0;D<a.length;++D){var y=new w(a[D],a[D]+b);e=e?B(e,y):y}b=e.ranges();for(e=0;e<b.length;++e)c(a,b[e],g)},c=function(n,D,p,l){D.max();D.min();d.bwg.data.slice(D.min(),D.max()-D.min()).fetch(function(l){for(var y=0;y<n.length;++y)if(D.contains(n[y])&&
(h(l,n[y]-D.min(),p),--q,0==q)){if(!f)return 0<a&&(0!=g||0<b)?d.getFirstAdjacentById(0,0,a,e):0>a&&(g!=d.bwg.maxID||1E9>b)?d.getFirstAdjacentById(d.bwg.maxID,1E9,a,e):e([]);d.fetchFeatures(function(e,y,D,d){return 0>a&&(e<g||D<b)||0<a&&(e>g||y>b)},[f],function(g){for(var b=null,y=-1,D=-1,d=0;d<g.length;++d){var f=g[d],n=f._chromId,p=f.min,l=f.max;if(null==b||0>a&&(n>y||l>D)||0<a&&(n<y||p<D))b=f,D=0>a?l:p,y=n}return null!=b?e([b]):e([])})}})},h=function(e,D,p){var x=new Uint8Array(e),q=new Int16Array(e);
e=new Int32Array(e);var y=x[D];q=q[D/2+1];D+=4;if(0!=y)for(var H=0;H<q;++H){var N=D/4;var c=e[N];var E=e[N+1];var h=e[N+2];y=e[N+3];N=m(x,D+16);p=m(x,D+24);(0>a&&(c<g||c==g&&E<=b)||0<a&&(h>g||h==g&&y>=b))&&!/_random/.exec(d.bwg.idsToChroms[c])&&(null==f||0>a&&(h>l||h==l&&y>n)||0<a&&(c<l||c==l&&E<n))&&(f={offset:N,size:p},n=0>a?y:E,l=0>a?h:c);D+=32}else{var z=x=-1;for(H=0;H<q;++H){N=D/4;c=e[N];E=e[N+1];h=e[N+2];y=e[N+3];N=e[N+4]<<32|e[N+5];if(0>a&&(c<g||c==g&&E<=b)&&h>=g||0<a&&(h>g||h==g&&y>=b)&&c<=
g)if(0>x||y>z)x=N,z=0>a?y:E;D+=24}0<=x&&C([x],p+1)}};C([d.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(f){d.cirHeader=f;f=new Int32Array(d.cirHeader);d.cirBlockSize=f[1];d.getFirstAdjacentById(g,b,a,e)})};k.prototype.readWigData=function(g,b,a,e){this.getUnzoomedView().readWigData(g,b,a,e)};k.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var g=4E3;this.zoomLevels[0]&&(g=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new h(this,
this.unzoomedIndexOffset,g,!1)}return this.unzoomedView};k.prototype.getZoomedView=function(g){g=this.zoomLevels[g];g.view||(g.view=new h(this,g.indexOffset,4E3,!0));return g.view};k.prototype._tsFetch=function(g,b,a,e,d){var f=this;if(g>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var p=[],n=this.topLevelReductionCache,l=0;l<n.length;++l)n[l]._chromId==b&&p.push(n[l]);return d(p)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(n){f.topLevelReductionCache=
n;return f._tsFetch(g,b,a,e,d)})}else return(0>g?this.getUnzoomedView():this.getZoomedView(g)).readWigDataById(b,a,e,d)};k.prototype.thresholdSearch=function(g,b,a,e,d){function f(){if(0==n.length)return d(null);n.sort(function(g,b){var e=g.zoom-b.zoom;if(0!=e)return e;e=g.chrOrd-b.chrOrd;return 0!=e?e:g.min-b.min*a});var g=n.splice(0,1)[0];p._tsFetch(g.zoom,g.chr,g.min,g.max,function(p){var l=0<a?0:3E8;g.fromRef&&(l=b);for(var D=0;D<p.length;++D){var q=p[D];var x=void 0!=q.maxScore?q.maxScore:q.score;
if(0<a){if(x>e)if(0>g.zoom){if(q.min>l)return d(q)}else q.max>l&&n.push({chr:g.chr,chrOrd:g.chrOrd,zoom:g.zoom-2,min:q.min,max:q.max,fromRef:g.fromRef})}else if(x>e)if(0>g.zoom){if(q.max<l)return d(q)}else q.min<l&&n.push({chr:g.chr,chrOrd:g.chrOrd,zoom:g.zoom-2,min:q.min,max:q.max,fromRef:g.fromRef})}f()})}a=0>a?-1:1;var p=this;g=this.chromsToIDs[g];for(var n=[{chrOrd:0,chr:g,zoom:p.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],l=1;l<=this.maxID+1;++l){var q=(g+a*l)%(this.maxID+1);0>q&&(q+=this.maxID+
1);n.push({chrOrd:l,chr:q,zoom:p.zoomLevels.length-1,min:0,max:3E8})}f()};k.prototype.getAutoSQL=function(g){if(!this.asOffset)return g(null);this.data.slice(this.asOffset,2048).fetch(function(b){var a=new Uint8Array(b);b="";for(var e=0;e<a.length&&0!=a[e];++e)b+=String.fromCharCode(a[e]);a=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g;var d=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(b);if(d){e={declType:d[1],name:d[2],comment:d[4],fields:[]};b=b.substring(d[0]);for(d=a.exec(b);null!=d;d=a.exec(b))e.fields.push({type:d[1],
name:d[2],comment:d[4]});return g(e)}})};k.prototype.getExtraIndices=function(g){var b=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return g(null);this.data.slice(this.extHeaderOffset,64).fetch(function(a){if(!a)return g(null,"Couldn't fetch extension header");var e=new Uint8Array(a),d=new Int16Array(a);new Int32Array(a);var f=d[1];a=m(e,4);if(0==f)return g(null);b.data.slice(a,20*f).fetch(function(a){if(!a)return g(null,"Couldn't fetch index info");var e=new Uint8Array(a),
d=new Int16Array(a);new Int32Array(a);a=[];for(var l=0;l<f;++l){var p=d[10*l],q=d[10*l+1],x=m(e,20*l+4);p=new A(b,p,q,x,d[10*l+8]);a.push(p)}g(a)})})};A.prototype.lookup=function(g,b){var a=this;this.bbi.data.slice(this.offset,32).fetch(function(e){function d(e){a.bbi.data.slice(e,4+l*(n+q)).fetch(function(e){var f=new Uint8Array(e);var l=new Uint16Array(e);new Uint32Array(e);var D=l[1];e=4;if(0==f[0]){for(var p=null,x=0;x<D;++x){l="";for(var c=0;c<n;++c){var y=f[e++];0!=y&&(l+=String.fromCharCode(y))}y=
m(f,e);e+=8;if(0>g.localeCompare(l)&&p){d(p);return}p=y}d(p)}else{for(x=0;x<D;++x){l="";for(c=0;c<n;++c)y=f[e++],0!=y&&(l+=String.fromCharCode(y));if(l==g)return l=m(f,e),f=z(f,e+8),a.bbi.getUnzoomedView().fetchFeatures(function(b,e,y,d){if(d&&d.length>a.field-3)return d[a.field-3]==g},[{offset:l,size:f}],b);e+=q}return b([])}})}var f=new Uint8Array(e);new Int16Array(e);e=new Int32Array(e);var l=e[1],n=e[2],q=e[3];m(f,16);d(a.offset+32)})};"undefined"!==typeof v&&(v.exports={makeBwg:r,BIG_BED_MAGIC:2273964779,
BIG_WIG_MAGIC:2291137574})},{"./bin":4,"./das":10,"./spans":37,"./utils":50,jszlib:66}],4:[function(c,v,u){function m(b){this.blob=b}function k(b,d,f,g){g||("object"===typeof d?(g=d,d=void 0):g={});this.url=b;this.start=d||0;f&&(this.end=f);this.opts=g}function h(b){if(!b)return null;for(var d=new Uint8Array(b.length),f=0;f<d.length;++f)d[f]=b.charCodeAt(f);return d.buffer}function r(b,d){return b[d+7]<<24|b[d+6]<<16|b[d+5]<<8|b[d+4]}function A(b,d){return b[d+3]<<24|b[d+2]<<16|b[d+1]<<8|b[d]}function w(b,
d){return b[d+1]<<8|b[d]}function B(b,d){return b[d]}function f(b,d){return b[d]<<24|b[d+1]<<16|b[d+2]<<8|b[d+3]}if("undefined"!==typeof c){var b=c("./utils").shallowCopy;var d=c("./sha1").b64_sha1}m.prototype.slice=function(b,d){b=this.blob.slice?d?this.blob.slice(b,b+d):this.blob.slice(b):d?this.blob.webkitSlice(b,b+d):this.blob.webkitSlice(b);return new m(b)};m.prototype.salted=function(){return this};m.prototype.fetch="undefined"!==typeof FileReader?function(b){var d=new FileReader;d.onloadend=
function(f){b(h(d.result))};d.readAsBinaryString(this.blob)}:function(b){var d=new FileReaderSync;try{var f=d.readAsArrayBuffer(this.blob);b(f)}catch(g){b(null,g)}};k.prototype.slice=function(b,d){if(0>b)throw"Bad slice "+b;var f=this.start,g=this.end;f=f&&b?f+b:b||f;return new k(this.url,f,d&&f?f+d-1:g||d-1,this.opts)};var q=0,z=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");k.prototype.fetchAsText=function(b){try{var f=new XMLHttpRequest,c=this.url;(z||this.opts.salt)&&
0>c.indexOf("?")&&(c=c+"?salt="+d(""+Date.now()+","+ ++q));f.open("GET",c,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";f.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}f.onreadystatechange=function(){if(4==f.readyState)return 200==f.status||206==f.status?b(f.responseText):b(null)};this.opts.credentials&&(f.withCredentials=!0);f.send("")}catch(g){return b(null)}};k.prototype.salted=function(){var d=b(this.opts);d.salt=!0;return new k(this.url,this.start,this.end,d)};
k.prototype.fetch=function(b,f){var l=this;f=f||{};var g=f.attempt||1,c=f.truncatedLength;if(3<g)return b(null);try{var a;f.timeout&&!this.opts.credentials&&(a=setTimeout(function(){console.log("timing out "+p);e.abort();return b(null,"Timeout")},f.timeout));var e=new XMLHttpRequest,p=this.url;(z||this.opts.salt)&&0>p.indexOf("?")&&(p=p+"?salt="+d(""+Date.now()+","+ ++q));e.open("GET",p,!0);e.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";
e.setRequestHeader("Range","bytes="+this.start+"-"+this.end);var x=this.end-this.start+1}e.responseType="arraybuffer";e.onreadystatechange=function(){if(4==e.readyState){a&&clearTimeout(a);if(200==e.status||206==e.status){if(e.response){var d=e.response.byteLength;return!x||x==d||c&&d==c?b(e.response):l.fetch(b,{attempt:g+1,truncatedLength:d})}if(e.mozResponseArrayBuffer)return b(e.mozResponseArrayBuffer);d=e.responseText;return!x||x==d.length||c&&d.length==c?b(h(e.responseText)):l.fetch(b,{attempt:g+
1,truncatedLength:d.length})}return l.fetch(b,{attempt:g+1})}};this.opts.credentials&&(e.withCredentials=!0);e.send("")}catch(J){return b(null)}};(function(b){var d=new ArrayBuffer(8),f=new Uint8Array(d),g=new Float32Array(d);b.readFloat=function(b,a){f[0]=b[a];f[1]=b[a+1];f[2]=b[a+2];f[3]=b[a+3];return g[0]}})(this);"undefined"!==typeof v&&(v.exports={BlobFetchable:m,URLFetchable:k,readInt:A,readIntBE:f,readInt64:r,readShort:w,readByte:B,readFloat:this.readFloat})},{"./sha1":34,"./utils":50}],5:[function(c,
v,u){function m(c){var h="bp";1E9<c?(c/=1E9,h="Gb"):1E6<c?(c/=1E6,h="Mb"):1E3<c&&(c/=1E3,h="kb");return""+Math.round(c)+h}if("undefined"!==typeof c){var k=c("./cbrowser").Browser;var h=c("./utils").makeElement;var r=c("./numformats").formatLongInt;var A=c("./zoomslider");c("./tier-edit");c("./export-config");c("./export-ui");c("./export-image");c("./svg-export");c("./session")}k.prototype.initUI=function(c,B){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(h("link",
"",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var f=this;f.disableDefaultFeaturePopup||this.addFeatureListener(function(a,b,g,e){f.featurePopup(a,b,g,e)});c.classList.add("dalliance");var b=f.toolbar=h("div",null,{className:"btn-toolbar toolbar"}),d=f.coordSystem.speciesName+" "+f.nameForCoordSystem(f.coordSystem);this.setDocumentTitle&&(document.title=d+" :: dalliance");var q=h("input","",{className:"loc-field"});f.makeTooltip(q,"Enter a genomic location or gene name");var z=
h("p","",{className:"loc-status"}),C=h("a",[h("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),l=new A;f.makeTooltip(l,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var t=h("a",[h("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),g=h("a",[h("i",null,{className:"fa fa-eraser"})],{className:"btn"}),F=h("a",[h("i",null,{className:"fa fa-plus"})],{className:"btn"}),a=h("a",[h("i",null,{className:"fa fa-bookmark"})],
{className:"btn"}),e=h("a",[h("i",null,{className:"fa fa-print"})],{className:"btn"});h("a",[h("i",null,{className:"fa fa-refresh"})],{className:"btn"});var p=h("a",[h("i",null,{className:"fa fa-cogs"})],{className:"btn"}),x=h("a",[h("i",null,{className:"fa fa-question"})],{className:"btn"}),J=h("a",[h("i",null,{className:"fa fa-road"})],{className:"btn"});f.makeTooltip(J,"Configure currently selected track(s) (E)");var n=h("a",[h("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),
E=h("a",[h("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),w=h("div",null,{className:"btn-group pull-right"});this.noTrackAdder||w.appendChild(F);this.noTrackEditor||w.appendChild(J);this.noExport||w.appendChild(e);this.noOptions||w.appendChild(p);this.noHelp||w.appendChild(x);this.setUiMode=function(a){this.uiMode=a;var b={help:x,add:F,opts:p,"export":e,tier:J},g;for(g in b)g==a?b[g].classList.add("active"):b[g].classList.remove("active")};this.noLeapButtons||
b.appendChild(E);w.firstChild&&b.appendChild(w);this.noLeapButtons||b.appendChild(n);this.noTitle||b.appendChild(h("div",h("h4",d,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||b.appendChild(h("div",[q,z],{className:"btn-group loc-group"}));this.noClearHighlightsButton||b.appendChild(g);this.noZoomSlider||b.appendChild(h("div",[C,h("span",l,{className:"btn"}),t],{className:"btn-group"}));this.toolbarBelow?(c.appendChild(B),c.appendChild(b)):(c.appendChild(b),c.appendChild(B));
var k=Math.log(2)/Math.log(10),S=Math.log(5)/Math.log(10),u=function(a){var b=(a/f.zoomExpt+Math.log(f.zoomBase))/Math.log(10);a=b|0;b-=a;return((.01>b?a:b<=k+.01?a+k:b<=S+.01?a+S:a+1)*Math.log(10)-Math.log(f.zoomBase))*f.zoomExpt},D=function(a){l.addLabel(a,m(Math.exp(a/f.zoomExpt)*f.zoomBase))};this.addViewListener(function(a,b,e,d,n){q.value=a+":"+r(b)+".."+r(e);l.min=n.min|0;l.max=n.max|0;n.isSnapZooming?(l.value=n.alternate,l.value2=n.current,l.active=2):(l.value=n.current,l.value2=n.alternate,
l.active=1);n.current==n.min?C.classList.add("disabled"):C.classList.remove("disabled");n.current==n.max?t.classList.add("disabled"):t.classList.remove("disabled");l.removeLabels();a=n.min;n=n.max;b=n-a;D(u(a));D(u(a+1*b/3));D(u(a+2*b/3));D(u(n));f.storeStatus&&f.storeViewStatus();g.style.display=0<f.highlights.length?"inline-block":"none"});this.addTierListener(function(){f.storeStatus&&f.storeTierStatus()});q.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),
f.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),f.search(q.value,function(a){z.textContent=a?""+a:""})},!1);var I;F.addEventListener("click",function(a){I&&I.displayed?f.removeAllPopups():I=f.showTrackAdder(a)},!1);f.makeTooltip(F,"Add a new track from the registry or an indexed file. (A)");C.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();f.zoomStep(-10)},!1);f.makeTooltip(C,"Zoom in (+)");t.addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();f.zoomStep(10)},!1);f.makeTooltip(t,"Zoom out (-)");l.addEventListener("change",function(a){a=2==l.active;a!=f.isSnapZooming&&(f.savedZoom=f.zoomSliderValue-f.zoomMin,f.isSnapZooming=a);a=1==l.active?l.value:l.value2;f.zoomSliderValue=1*a;f.zoom(Math.exp(1*a/f.zoomExpt))},!1);a.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);f.makeTooltip(a,"Favourite regions");e.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();f.openExportPanel()},
!1);f.makeTooltip(e,"Export publication-quality SVG. (X)");p.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();f.toggleOptsPopup(a)},!1);f.makeTooltip(p,"Configure options.");x.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();f.toggleHelpPopup(a)});f.makeTooltip(x,"Help; Keyboard shortcuts. (H)");J.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==f.selectedTiers.length&&f.openTierPanel(f.tiers[f.selectedTiers[0]])},
!1);n.addEventListener("click",function(a){f.leap(f.reverseKeyScrolling?-1:1,!1)},!1);f.makeTooltip(n,function(a){a=f.getSelectedTier();var b;0<=a&&(b=f.tiers[a]);return b&&b.featureSource&&f.sourceAdapterIsCapable(b.featureSource,"quantLeap")&&"number"==typeof b.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(b.config.name||b.dasSource.name)+'"" (ctrl+LEFT)':b&&b.featureSource&&f.sourceAdapterIsCapable(b.featureSource,"leap")?'Jump to the next feature in the selected track "'+
(b.config.name||b.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});E.addEventListener("click",function(a){f.leap(f.reverseKeyScrolling?1:-1,!1)},!1);f.makeTooltip(E,function(a){a=f.getSelectedTier();var b;0<=a&&(b=f.tiers[a]);return b&&b.featureSource&&f.sourceAdapterIsCapable(b.featureSource,"quantLeap")&&"number"==typeof b.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(b.config.name||b.dasSource.name)+'"" (ctrl+RIGHT)':b&&b.featureSource&&
f.sourceAdapterIsCapable(b.featureSource,"leap")?'Jump to the next feature in the selected track "'+(b.config.name||b.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});f.addTierSelectionListener(function(){var a=f.getSelectedTier(),b;0<=a&&(b=f.tiers[a]);a=!1;b&&b.featureSource&&(f.sourceAdapterIsCapable(b.featureSource,"quantLeap")&&"number"==typeof b.quantLeapThreshold?a=!0:f.sourceAdapterIsCapable(b.featureSource,"leap")&&(a=!0));n.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";
E.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});g.addEventListener("click",function(a){f.clearHighlights()},!1);f.makeTooltip(g,"Clear highlights (C)");f.addTierSelectionWrapListener(function(a){0>a&&(f.setSelectedTier(null),q.focus())});f.addTierSelectionListener(function(a){"tier"===f.uiMode&&(0==a.length?(f.hideToolPanel(),f.manipulatingTier=null,f.uiMode="none"):(a=f.tiers[a[0]],a!=f.manipulatingTier&&f.openTierPanel(a)))});var G=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),
a.stopPropagation(),f.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),f.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==f.selectedTiers.length&&f.openTierPanel(f.tiers[f.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),f.openExportPanel();else if(67==a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),f.clearHighlights()};c.addEventListener("focus",
function(a){c.addEventListener("keydown",G,!1)},!1);c.addEventListener("blur",function(a){c.removeEventListener("keydown",G,!1)},!1);c.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==f.uiMode&&(a.preventDefault(),a.stopPropagation(),f.setUiMode("none"),f.hideToolPanel(),f.selectedTiers&&0<f.selectedTiers.length&&f.browserHolder.focus())},!1)};k.prototype.showToolPanel=function(c,B){var f=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);
c=B?c:h("div",c,{},{overflowY:"auto",width:"100%"});B=h("div",h("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});B.addEventListener("click",function(b){f.hideToolPanel();f.setUiMode("none")},!1);this.makeTooltip(B,"Close tool panel (ESC)");this.activeToolPanel=h("div",[B,c],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();f=this};k.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);
this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};k.prototype.toggleHelpPopup=function(c){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(c=h("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(c,!1),this.setUiMode("help"))};k.prototype.toggleOptsPopup=function(c){var B=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{c=h("div",null,{className:"form-horizontal"},
{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var f=h("table");f.cellPadding=5;var b=h("input","",{type:"checkbox",checked:B.reverseScrolling});b.addEventListener("change",function(d){B.reverseScrolling=b.checked;B.storeStatus()},!1);f.appendChild(h("tr",[h("td","Reverse trackpad scrolling",{align:"right"}),h("td",b)]));var d=h("input","",{type:"checkbox",checked:B.reverseKeyScrolling});d.addEventListener("change",function(b){B.reverseKeyScrolling=
d.checked;B.storeStatus()},!1);f.appendChild(h("tr",[h("td","Reverse scrolling buttons and keys",{align:"right"}),h("td",d)]));var q=h("select");q.appendChild(h("option","Left",{value:"left"}));q.appendChild(h("option","Center",{value:"center"}));q.appendChild(h("option","Right",{value:"right"}));q.appendChild(h("option","None",{value:"none"}));q.value=B.rulerLocation;q.addEventListener("change",function(b){B.rulerLocation=q.value;B.positionRuler();for(b=0;b<B.tiers.length;++b)B.tiers[b].paintQuant();
B.storeStatus()},!1);f.appendChild(h("tr",[h("td","Vertical guideline",{align:"right"}),h("td",q)]));var z=h("input","",{type:"checkbox",checked:B.singleBaseHighlight});z.addEventListener("change",function(b){B.singleBaseHighlight=z.checked;B.positionRuler();B.storeStatus()},!1);z.setAttribute("id","singleBaseHightlightButton");f.appendChild(h("tr",[h("td","Display and highlight current genome location",{align:"right"}),h("td",z)]));c.appendChild(f);f=h("button","Reset browser",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});f.addEventListener("click",function(b){B.reset()},!1);c.appendChild(f);this.showToolPanel(c);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":27,"./session":33,"./svg-export":39,"./tier-edit":45,"./utils":50,"./zoomslider":53}],6:[function(c,v,u){function m(a,b,g){this.min=b;this.max=g;this.chr=a}function k(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=
[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=
null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=.3;this.singleBaseHighlight=this.exportRegion=this.exportBanner=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new f;this.defaultSources=[];this.mappableSources=
{};this.registry=null;this.noRegistryTabs=!0;this.hubs=[];this.hubObjects=[];this.sourceCache=new B;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.defaultSearchRegionPadding=1E4;this.httpCanaryURL="http://www.biodalliance.org/http-canary.txt";this.httpWarningURL="//www.biodalliance.org/https.html";this.initListeners=[];this.baseColors=a.baseColors?a.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",
I:"red"};if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");for(var b in a)this[b]=a[b];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&(this.prefix=a.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(a=window.location.hostname,window.location.port&&(a+=":"+window.location.port),this.prefix="//"+a+this.prefix);0===this.prefix.indexOf("//")&&
(a=window.location.protocol,"http:"!=a&&"https:"!=a&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var g=this;if("complete"===document.readyState)g.realInit();
else{var e=function(a){window.removeEventListener("load",e,!1);g.realInit()};window.addEventListener("load",e,!1)}}function h(a,b,g){if(g)for(var e=0;e<b.length;++e)b[e].mapping=g;a.set(b)}function r(a,b,g,e){e=e||[];for(var d=a.length-1;0<=d;--d){var f=a[d];if(!f.notSelectable&&f.min()<=b&&f.max()>=b&&(!f.minY||!(g<f.minY()||g>f.maxY()))){f.feature?e.push(f.feature):f.group&&e.push(f.group);if(f.glyphs)return r(f.glyphs,b,g,e);if(f.glyph)return r([f.glyph],b,g,e);break}}return e}function A(a,b){var g=
this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=b;this.worker.onmessage=function(a){var b=g.callbacks[a.data.tag];b&&(b(a.data.result,a.data.error),delete g.callbacks[a.data.tag])}}function w(a){var b=a.resolveURL(a.workerPath);0==b.indexOf("//")&&(b="https:"==window.location.protocol?"https:"+b:"http:"+b);var g=new Blob(['importScripts("'+b+"?version="+F+'");'],{type:"application/javascript"});return new x(function(b,e){var d=new Worker(URL.createObjectURL(g));d.onmessage=function(g){"init"===
g.data.tag&&(console.log("Worker initialized"),b(new A(a,d)))};d.onerror=function(a){e(a.message)}})}function B(){this.sourcesByURI={}}if("undefined"!==typeof c){u=c("./utils");var f=u.Observed;var b=u.makeElement;var d=u.removeChildren;var q=u.miniJSONify;var z=u.shallowCopy;var C=u.textXHR;var l=c("./tier").DasTier;var t=c("./sha1").hex_sha1;var g=c("./thub").connectTrackHub;var F=c("./version");u=c("./numformats");var a=u.formatQuantLabel;var e=u.formatLongInt;var p=c("./chainset").Chainset;var x=
c("es6-promise").Promise;u=c("./sourcecompare");var J=u.sourcesAreEqual;var n=u.sourcesAreEqualModuloStyle;var E=u.sourceDataURI}k.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};k.prototype.destroy=function(){window.removeEventListener("resize",this.resizeListener,!1)};k.prototype.realInit=function(){var a=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var g=navigator.userAgent||"dummy";
0<=g.indexOf("Trident")&&0<=g.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(g=0;g<this.sources.length;++g){var f=this.sources[g];f&&this.defaultSources.push(f)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var n=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=b("div",
null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);d(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=b("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=b("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=b("div",this.makeLoader(24),
{className:"tier-holder tier-holder-rest"});this.locSingleBase=b("span","",{className:"loc-single-base"});g=b("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(b,g,d,f,D,y,n){a.locSingleBase.appendChild(document.createTextNode(b+":"+e(Math.round((n+y)/2))));a.locSingleBase.removeChild(a.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=b("div",[g,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),
this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=b("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(b("span",["Powered by ",b("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+F],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);this.resizeListener=function(a){n.resizeViewer()};window.addEventListener("resize",this.resizeListener,!1);this.ruler=b("div",null,{className:"guideline"});this.ruler2=
b("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var y in this.chainConfigs)g=this.chainConfigs[y],g instanceof p&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[y]=new p(g);if(0<this.maxWorkers){y=[];for(g=0;g<this.maxWorkers;++g)y.push(w(this));y=x.all(y)}else y=x.resolve([]);this.fetchWorkers=
null;this.nextWorker=0;y.then(function(a){console.log("Booted "+a.length+" workers");n.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if("none"!=window.getComputedStyle(n.browserHolderHolder).display&&0<n.tierHolder.getBoundingClientRect().width)setTimeout(function(){n.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(n.browserHolderHolder).display&&0<n.tierHolder.getBoundingClientRect().width&&(clearInterval(a),n.realInit2())},
300)})}};k.prototype.realInit2=function(){var e=this;d(this.tierHolder);d(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);
this.tierHolderHolder.addEventListener("mousewheel",function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var b=a.wheelDeltaX/5;e.reverseScrolling||(b=-b);e.move(b)}a.wheelDeltaY&&(b=a.wheelDeltaY,e.reverseScrolling&&(b=-b),e.tierHolder.scrollTop+=b)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(a){a.stopPropagation();a.preventDefault();1==a.axis?0!=a.detail&&(a=a.detail/4,e.reverseScrolling&&(a=-a),e.move(a)):(a=a.detail,e.reverseScrolling||(a=-a),e.tierHolder.scrollTop+=
a)},!1);this.tierHolderHolder.addEventListener("touchstart",function(a){return e.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return e.touchMoveHandler(a)},!1);this.tierHolderHolder.addEventListener("touchend",function(a){return e.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(a){return e.touchCancelHandler(a)},!1);var f=function(b){var g;if(13==b.keyCode){var d=!1;for(b=0;b<e.tiers.length;++b){var f=e.tiers[b];f.wantedLayoutHeight&&
f.wantedLayoutHeight!=f.layoutHeight&&(f.layoutHeight=f.wantedLayoutHeight,f.clipTier(),d=!0)}d&&e.arrangeTiers()}else if(32==b.keyCode||32==b.charCode)e.isSnapZooming?(e.isSnapZooming=!1,d=(e.savedZoom||20)+e.zoomMin):(e.isSnapZooming=!0,d=(e.savedZoom||0)+e.zoomMin),e.savedZoom=e.zoomSliderValue-e.zoomMin,e.zoomSliderValue=d,e.zoom(Math.exp(1*d/e.zoomExpt)),b.stopPropagation(),b.preventDefault();else if(85==b.keyCode)"opts"===e.uiMode&&(d=document.getElementById("singleBaseHightlightButton").checked,
document.getElementById("singleBaseHightlightButton").checked=!d),e.singleBaseHighlight=!e.singleBaseHighlight,e.positionRuler(),b.stopPropagation(),b.preventDefault();else if(39==b.keyCode)b.stopPropagation(),b.preventDefault(),e.scrollArrowKey(b,-1);else if(37==b.keyCode)b.stopPropagation(),b.preventDefault(),e.scrollArrowKey(b,1);else if(38==b.keyCode||87==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=e.getSelectedTier(),0>b||(d=e.tiers[b],b=d.forceHeight||d.subtiers[0].height,
40<=b&&d.mergeConfig({height:b-10}));else if(b.ctrlKey||b.metaKey){if(b=e.getSelectedTier(),!(0>b)&&(d=e.tiers[b],d.quantLeapThreshold&&(f=d.subtiers[0].height,g=d.subtiers[0].quant)))b=1*g.min,g=1*g.max,f=(g-b)/f,d.mergeConfig({quantLeapThreshold:b+((Math.round((d.quantLeapThreshold-b)/f)|0)+1)*f}),d.notify("Threshold: "+a(d.quantLeapThreshold))}else if(b.altKey){var y=e.selectedTiers.length;if(0!=y){b=e.selectedTiers[0];g=!0;d=[];for(f=0;f<e.selectedTiers.length;++f)d.push(e.tiers[e.selectedTiers[f]]),
0<f&&1!=e.selectedTiers[f]-e.selectedTiers[f-1]&&(g=!1);if(!(g&&0>=b)){for(f=e.selectedTiers.length-1;0<=f;--f)e.tiers.splice(e.selectedTiers[f],1);e.selectedTiers.splice(0,y);b=g?b-1:b;for(f=0;f<d.length;++f)e.tiers.splice(b+f,0,d[f]),e.selectedTiers.push(b+f);e.withPreservedSelection(e._ensureTiersGrouped);e.markSelectedTiers();e.notifyTierSelection();e.reorderTiers();e.notifyTier()}}}else if(b=e.getSelectedTier(),0<b){if(e.setSelectedTier(b-1),b=e.tiers[e.getSelectedTier()],d=b.row.offsetTop,b=
d+b.row.offsetHeight,d<e.tierHolder.scrollTop||b>e.tierHolder.scrollTop+e.tierHolder.offsetHeight)e.tierHolder.scrollTop=d}else e.notifyTierSelectionWrap(-1);else if(40==b.keyCode||83==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=e.getSelectedTier(),0>b||(d=e.tiers[b],b=d.forceHeight||d.subtiers[0].height,d.mergeConfig({height:b+10}));else if(b.ctrlKey||b.metaKey){if(b=e.getSelectedTier(),!(0>b)&&(d=e.tiers[b],d.quantLeapThreshold&&(f=d.subtiers[0].height,g=d.subtiers[0].quant)))b=
1*g.min,g=1*g.max,f=(g-b)/f,g=Math.round((d.quantLeapThreshold-b)/f)|0,1<g&&(d.mergeConfig({quantLeapThreshold:b+(g-1)*f}),d.notify("Threshold: "+a(d.quantLeapThreshold)))}else if(b.altKey){if(y=e.selectedTiers.length,0!=y){b=e.selectedTiers[0];var n=0;d=[];for(f=0;f<e.selectedTiers.length;++f)d.push(e.tiers[e.selectedTiers[f]]),0<f&&(n+=e.selectedTiers[f]-e.selectedTiers[f-1]-1);g=0==n;if(!(g&&b+y>=e.tiers.length)){for(f=e.selectedTiers.length-1;0<=f;--f)e.tiers.splice(e.selectedTiers[f],1);e.selectedTiers.splice(0,
y);b=g?b+1:b+n;for(f=0;f<d.length;++f)e.tiers.splice(b+f,0,d[f]),e.selectedTiers.push(b+f);e.withPreservedSelection(function(){e._ensureTiersGrouped(!0)});e.markSelectedTiers();e.notifyTierSelection();e.reorderTiers();e.notifyTier()}}}else{if(b=e.getSelectedTier(),b<e.tiers.length-1&&(e.setSelectedTier(b+1),b=e.tiers[e.getSelectedTier()],d=b.row.offsetTop,b=d+b.row.offsetHeight,d<e.tierHolder.scrollTop||b>e.tierHolder.scrollTop+e.tierHolder.offsetHeight))e.tierHolder.scrollTop=Math.min(d,b-e.tierHolder.offsetHeight)}else if(187==
b.keyCode||61==b.keyCode)b.stopPropagation(),b.preventDefault(),e.zoomStep(-10);else if(189==b.keyCode||173==b.keyCode)b.stopPropagation(),b.preventDefault(),e.zoomStep(10);else if(73==b.keyCode||105==b.keyCode)b.stopPropagation(),b.preventDefault(),b=e.getSelectedTier(),0>b||(f=e.tiers[b],f.infoVisible?(f.infoElement.style.display="none",f.updateHeight(),f.infoVisible=!1):(f.infoElement.style.display="block",f.updateHeight(),f.infoVisible=!0));else if(84==b.keyCode||116==b.keyCode)if(b.shiftKey)for(b.stopPropagation(),
b.preventDefault(),b=0;b<e.tiers.length;++b)f=e.tiers[b],f.dasSource.collapseSuperGroups&&(void 0===d&&(d=!f.bumped),f.mergeConfig({bumped:d}));else b.ctrlKey||b.metaKey||(b.stopPropagation(),b.preventDefault(),b=e.getSelectedTier(),0>b||(f=e.tiers[b],f.dasSource.collapseSuperGroups&&(void 0===d&&(d=!f.bumped),f.mergeConfig({bumped:d}))));else if(77==b.keyCode||109==b.keyCode)b.stopPropagation(),b.preventDefault(),(b.ctrlKey||b.metaKey)&&1<e.selectedTiers.length&&e.mergeSelectedTiers();else if(68==
b.keyCode||100==b.keyCode){if(b.stopPropagation(),b.preventDefault(),b.ctrlKey||b.metaKey)b=e.getSelectedTier(),0>b||e.addTier(e.tiers[b].dasSource)}else if(80==b.keyCode||112==b.keyCode)if(b.ctrlKey||b.metaKey){d=[];for(b=0;b<e.selectedTiers.length;++b)d.push(e.tiers[e.selectedTiers[b]]);for(b=0;b<d.length;++b)d[b].mergeConfig({pinned:!d[b].pinned})}};this.browserHolder.addEventListener("focus",function(a){e.browserHolder.addEventListener("keydown",f,!1)},!1);this.browserHolder.addEventListener("blur",
function(a){e.browserHolder.removeEventListener("keydown",f,!1)},!1);this.hPopupHolder=b("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var n=0;n<this.sources.length;++n){var p=this.sources[n];if(p){var y={};this.restoredConfigs&&(y=this.restoredConfigs[n]);p.disabled||this.makeTier(p,y)}}e._ensureTiersGrouped();e.arrangeTiers();e.reorderTiers();e.refresh();
e.setSelectedTier(1);e.positionRuler();(n=this.getSequenceSource())&&n.getSeqInfo(this.chr,function(a){e.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var l in this.chains)this.queryRegistry(l,!0);if(this.hubs)for(l=0;l<this.hubs.length;++l)n=this.hubs[l],"string"==typeof n&&(n={url:n}),function(a){g(a.url,function(b,g){if(g)console.log(g);else if(b=a.genome?b.genomes[a.genome]:b.genomes[e.coordSystem.ucscName])a.mapping&&(b.mapping=a.mapping),a.label&&(b.hub.altLabel=a.label),e.hubObjects.push(b)},
a)}(n);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(l=0;l<this.initListeners.length;++l)try{this.initListeners[l].call(this)}catch(N){console.log(N)}};k.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};k.prototype.touchMoveHandler=
function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var b=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=b;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){b=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var e=this.viewStart+
a/this.scale|0;this.scale=b/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=e-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};k.prototype.touchEndHandler=function(a){};k.prototype.touchCancelHandler=function(a){};k.prototype.makeTier=function(a,b){try{return this.realMakeTier(a,b)}catch(G){console.log("Error initializing",a),console.log(G.stack||G)}};k.prototype.realMakeTier=function(a,b){var e=this,g=null;this.tierBackgroundColors&&(g=this.tierBackgroundColors[this.tiers.length%
this.tierBackgroundColors.length]);var d=new l(this,a,b,g);d.oorigin=this.viewStart;var f=!1,n,p,D,q=function(a,b){var g=d.subtiers;if(g){var f=0;for(b-=d.padding;f<g.length&&b>g[f].height&&f<g.length-1;)b=b-g[f].height-d.padding,++f;if(!(f>=g.length))return r(g[f].glyphs,a-(d.glyphCacheOrigin-e.viewStart)*e.scale,b)}},x=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=p&&(e.move(a-p,!0),p=a);e.isDragging=!0},c=function(a){window.removeEventListener("mousemove",x,!0);window.removeEventListener("mouseup",
c,!0);e.move(a.clientX-p)};d.viewport.addEventListener("mousedown",function(a){e.browserHolder.focus();a.preventDefault();d.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",x,!0);window.addEventListener("mouseup",c,!0);n=p=a;e.isDragging=!1},!1);d.viewport.addEventListener("mousemove",function(a){var b=d.row.getBoundingClientRect(),g=a.clientX-b.left,y=a.clientY-b.top;b=q(g,y);d.row.style.cursor=b&&0<b.length?"pointer":"default";D&&clearTimeout(D);f||(D=setTimeout(function(){var b=
q(g,y);b&&0<b.length&&e.notifyFeatureHover(a,b[b.length-1],b,d)},1E3))});var h=null;d.viewport.addEventListener("mouseup",function(a){var b=d.row.getBoundingClientRect(),g=a.clientX-b.left;b=a.clientY-b.top;var f=q(g,b);f&&0<f.length&&!e.isDragging&&(h?(clearTimeout(h),h=null,e.featureDoubleClick(f,g,b)):h=setTimeout(function(){h=null;e.notifyFeature(a,f[f.length-1],f,d)},500));if(e.isDragging&&g!=n&&d.sequenceSource){b=e.viewStart+g/e.scale;var y=e.viewStart+n/e.scale;b<y?(g=b|0,b=y|0):(g=y|0,b|=
0);e.notifyRegionSelect(e.chr,g,b)}e.isDragging=!1},!1);d.viewport.addEventListener("mouseout",function(a){f=!1});d.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<e.tiers.length;++a)if(e.tiers[a]===d){e.removeTier({index:a});break}},!1);d.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=-1;for(var b=0;b<e.tiers.length;++b)if(e.tiers[b]===d){a=b;break}0<=a&&(b=e.selectedTiers.indexOf(a),0<=b?
e.selectedTiers.splice(b,1):(e.selectedTiers.push(a),e.selectedTiers.sort()),e.markSelectedTiers(),e.notifyTierSelection(),0<e.selectedTiers.length?e.browserHolder.focus():e.notifyTierSelectionWrap(-1))}else{for(b=0;b<e.tiers.length;++b)if(e.tiers[b]===d&&(e.browserHolder.focus(),1!=e.selectedTiers.length||e.selectedTiers[0]!=b)){e.setSelectedTier(b);return}d.infoVisible?(d.infoElement.style.display="none",d.updateHeight(),d.infoVisible=!1):(d.infoElement.style.display="block",d.updateHeight(),d.infoVisible=
!0)}},!1);d.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var b;d.dasSource.collapseSuperGroups&&(void 0===b&&(b=!d.bumped),d.mergeConfig({bumped:b}))},!1);var E,z,F,C,t,B=!1,J=function(a){var b=d.label;a.stopPropagation();a.preventDefault();if(!E){z=d.pinned?e.pinnedTierHolder:e.tierHolder;F=z.scrollHeight-z.offsetHeight;E=b.cloneNode(!0);E.style.cursor="pointer";z.appendChild(E);b.style.visibility="hidden";for(var g=0;g<e.tiers.length;++g)if(e.tiers[g]===
d){C=g;break}t=a.clientY}var f=z.getBoundingClientRect();E.style.left=b.getBoundingClientRect().left-f.left+"px";E.style.top=a.clientY-f.top+z.scrollTop-10+"px";b=a.clientY-f.top+z.scrollTop;for(g=0;g<e.tiers.length;++g)if(f=e.tiers[g],!(f.pinned^d.pinned)&&(f=f.row.getBoundingClientRect(),b-=f.bottom-f.top,0>b)){if(g<C&&a.clientY<t||g>C&&a.clientY>t){e.withPreservedSelection(function(){e.tiers.splice(C,1);e.tiers.splice(g,0,d);e._ensureTiersGrouped(g>C)});for(b=0;b<e.tiers.length;++b)e.tiers[b]==
d&&(C=b);t=a.clientY;e.reorderTiers();z.appendChild(E);B=!0}break}E.offsetTop<z.scrollTop?z.scrollTop-=z.scrollTop-E.offsetTop:E.offsetTop+E.offsetHeight>z.scrollTop+z.offsetHeight&&(z.scrollTop=Math.min(z.scrollTop+(E.offsetTop+E.offsetHeight)-(z.scrollTop+z.offsetHeight),F))},k=function(a){var b=d.label;a.stopPropagation();a.preventDefault();E&&(E.style.cursor="auto",z.removeChild(E),E=null,b.style.visibility="visible");document.removeEventListener("mousemove",J,!1);document.removeEventListener("mouseup",
k,!1);if(B){for(a=0;a<e.tiers.length;++a)if(e.tiers[a]==d){e.setSelectedTier(a);break}e.notifyTier()}};d.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();B=!1;document.addEventListener("mousemove",J,!1);document.addEventListener("mouseup",k,!1)},!1);this.tiers.push(d);d.init();d.currentlyHeight=50;this.updateHeight();d.updateLabel();this.withPreservedSelection(e._ensureTiersGrouped);d._updateFromConfig();this.reorderTiers();return d};k.prototype.reorderTiers=function(){d(this.tierHolder);
d(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,b=[],e=[],g=0;g<this.tiers.length;++g){var f=this.tiers[g];f.pinned&&!this.disablePinning?(b.push(f),this.pinnedTierHolder.appendChild(this.tiers[g].row),a=!0):(e.push(f),this.tierHolder.appendChild(this.tiers[g].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<b.length;++a)this.tiers.push(b[a]);for(a=0;a<e.length;++a)this.tiers.push(e[a])});
a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};k.prototype.withPreservedSelection=function(a){for(var b=[],e=0;e<this.selectedTiers.length;++e)b.push(this.tiers[this.selectedTiers[e]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=b.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};k.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};k.prototype._ensureTiersGrouped=
function(a){for(var b,e={},g=0;g<this.tiers.length;++g)b=this.tiers[g],b.dasSource.tierGroup&&pusho(e,b.dasSource.tierGroup,b);var d=[];a&&this.tiers.reverse();for(g=0;g<this.tiers.length;++g)if(b=this.tiers[g],b.dasSource.tierGroup){var f=e[b.dasSource.tierGroup];if(f){a&&f.reverse();for(var n=0;n<f.length;++n)d.push(f[n]);e[b.dasSource.tierGroup]=null}}else d.push(b);a&&d.reverse();this.tiers.splice(0,this.tiers.length);for(n=0;n<d.length;++n)this.tiers.push(d[n])};k.prototype.arrangeTiers=function(){for(var a,
e=[],g={},d=0;d<this.tiers.length;++d)a=this.tiers[d],a.pinned&&(e.push(a),a.dasSource.tierGroup&&pusho(g,a.dasSource.tierGroup,a));for(d=0;d<this.tiers.length;++d)a=this.tiers[d],a.pinned||(e.push(a),a.dasSource.tierGroup&&pusho(g,a.dasSource.tierGroup,a));for(var f in g){a=g[f];var n=this.tierGroups[f];n||(n={element:b("div",b("span",f,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[f]=n);n.element.parentNode&&n.element.parentNode.removeChild(n.element);var p=a[0].pinned?
this.pinnedTierHolder:this.tierHolder,l=1E7,q=0;for(d=0;d<a.length;++d){var x=a[d].row;l=Math.min(l,x.offsetTop);q=Math.max(q,x.offsetTop+x.offsetHeight)}n.element.style.top=l+"px";n.element.style.left="0px";n.element.style.height=q-l+"px";p.appendChild(n.element)}if(this.tierBackgroundColors)for(d=0;d<e.length;++d)a=e[d],a.setBackground(this.tierBackgroundColors[d%this.tierBackgroundColors.length]),a.label.style.left=a.dasSource.tierGroup?"18px":"2px",a.background=this.tierBackgroundColors[d%this.tierBackgroundColors.length]};
k.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,e=(this.viewStart+this.viewEnd)/2,g=e-this.origin;this.origin=e;this.scaleAtLastRedraw=this.scale;for(e=0;e<this.tiers.length;++e){var d=g;this.tiers[e].originHaxx&&(d+=this.tiers[e].originHaxx);this.tiers[e].originHaxx=d}g=this.targetQuantRes/this.scale;e=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);d=Math.max(1,(this.viewStart|0)-b);
b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var f=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new S(this.tiers,this.chr,d,b,g,f)}(f=this.knownSpace.bestCacheOverlapping(this.chr,e,a))&&f.min<=e&&f.max>=a?(this.drawnStart=Math.max(f.min,d),this.drawnEnd=Math.min(f.max,b)):(this.drawnStart=d,this.drawnEnd=b);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,
g);this.drawOverlays();this.positionRuler()};k.prototype.queryRegistry=function(a,b){if(this.registry){if(a){var e=this.chains[a].coords;this.mappableSources[a]||(this.mappableSources[a]=new f);var g=this.mappableSources[a]}else e=this.coordSystem,g=this.availableSources;var d=t(q(e));if(b&&(b=localStorage["dalliance.registry."+d+".last_queried"]))try{if(h(g,JSON.parse(localStorage["dalliance.registry."+d+".sources"]),a),432E5>(Date.now()|0)-(b|0))return}catch(N){console.log("Bad registry cache: "+
N)}b=this.registry;if(0==b.indexOf("//")){var n=window.location.protocol;"https:"!=n&&"http:"!=n&&(b="http:"+b)}(new W(b)).sources(function(b){for(var f=[],n=0;n<b.length;++n){var y=b[n];if(y.coords&&0!=y.coords.length){var p=y.coords[0];p.taxon==e.taxon&&p.auth==e.auth&&p.version==e.version&&f.push(y)}}localStorage["dalliance.registry."+d+".sources"]=JSON.stringify(f);localStorage["dalliance.registry."+d+".last_queried"]=""+Date.now();h(g,f,a)},function(a){},e)}};k.prototype.move=function(a,b){var e=
this.viewEnd-this.viewStart;a=this.viewStart-1*a/this.scale;var g=a+e;b||(0<this.currentSeqMax&&g>this.currentSeqMax&&(g=this.currentSeqMax,a=this.viewEnd-e),1>a&&(a=1,g=a+e));this.setLocation(null,a,g,null,b)};k.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue;a=b+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=b&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};k.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/
2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};k.prototype.spaceCheck=function(a){this.knownSpace&&
this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};k.prototype.resizeViewer=function(a){var b=this.tierHolder.getBoundingClientRect().width|0;if(0!=b){var e=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=b|0;e!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),
this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/e,b=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.positionRuler(),
a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};k.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};k.prototype.addTier=function(a){a=z(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();return a};k.prototype.removeTier=function(a,b){b=-1;if("undefined"!==typeof a.index&&0<=a.index&&
a.index<this.tiers.length)b=a.index;else for(var e=0;e<this.tiers.length;++e)if(J(a,this.tiers[e].dasSource)){b=e;break}if(0>b)throw"Couldn't find requested tier";a=this.tiers[b];this.tiers.splice(b,1);e=[];for(var g=0;g<this.selectedTiers.length;++g){var d=this.selectedTiers[g];d<b?e.push(d):d>b&&e.push(d-1)}this.selectedTiers=e;this.markSelectedTiers();a.destroy();this.knownSpace&&(this.knownSpace.featureCache[a]=null);this.reorderTiers();this.notifyTier()};k.prototype.removeAllTiers=function(){var a=
this;this.selectedTiers=[];this.markSelectedTiers();this.tiers.forEach(function(b){b.destroy();a.knownSpace&&(a.knownSpace.featureCache[b]=null)});this.tiers.length=0;this.reorderTiers();this.notifyTier()};k.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};k.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;
for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||b.twoBitURI||b.twoBitBlob)return b.twoBitURI||b.twoBitBlob?new T(b):new U(b)}};k.prototype.setLocation=function(a,b,e,g,d){if("number"!==typeof b)throw Error("minimum must be a number (got "+JSON.stringify(b)+")");if("number"!==typeof e)throw Error("maximum must be a number (got "+JSON.stringify(e)+")");if(b>e){var f=b;b=e;e=f}else b===e&&(e+=1);g||(g=function(a){if(a)throw a;
});var n=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,b,e,null,g,d);var y=this.getSequenceSource();if(!y)return g("Need a sequence source");var p=a||this.chr;y.getSeqInfo(p,function(f){if(f)return n._setLocation(a,b,e,f,g,d);var l=0==p.indexOf("chr")?p.substr(3):"chr"+p;y.getSeqInfo(l,function(f){return!f&&a?g("Couldn't find sequence '"+a+"'"):f?n._setLocation(l,b,e,f,g,d):n._setLocation(null,b,e,null,g,d)})})};k.prototype._setLocation=function(a,b,e,g,d,f){var n=
!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(n=!0),this.chr=a,this.currentSeqMax=g.length);b=parseFloat(b);e=parseFloat(e);a=Math.max(10,e-b+1);f||(f=this.currentSeqMax,0>=f&&(f=1E12),1>b&&(b=1,e=b+a-1),e>f&&(e=f,b=Math.max(1,e-a+1)));this.viewStart=b;this.viewEnd=e;e=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);b=1E-6<Math.abs(e-this.scale);this.scale=e;f=this.zoomSliderValue;this.zoomSliderValue=e=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);
if(b||n){for(n=0;n<this.tiers.length;++n)this.tiers[n].viewportHolder.style.left="5000px",this.tiers[n].overlay.style.left="5000px";this.refresh();this.savedZoom?(e-=this.zoomMin,f-=this.zoomMin,Math.abs(e-f)>Math.abs(e-this.savedZoom)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=f)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(n=0;n<this.tiers.length;++n)this.tiers[n].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[n].norigin)*this.scale)|0)-1E3)+"px",this.tiers[n].drawOverlay();
this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return d()};k.prototype.setCenterLocation=function(a,b){var e=(this.viewEnd-this.viewStart)/2;this.setLocation(a,b-e,b+e)};k.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,b=0;b<this.tiers.length;++b)"none"!==this.tiers[b].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=
null)}};k.prototype.addInitListener=function(a){this.initListeners.push(a)};k.prototype.addFeatureListener=function(a,b){this.featureListeners.push(a)};k.prototype.removeFeatureListener=function(a,b){a=arrayIndexOf(this.featureListeners,a);0<=a&&this.featureListeners.splice(a,1)};k.prototype.notifyFeature=function(a,b,e,g){for(var d=0;d<this.featureListeners.length;++d)try{if(this.featureListeners[d](a,b,e,g))break}catch(H){console.log(H.stack)}};k.prototype.addFeatureHoverListener=function(a,b){this.featureHoverListeners.push(a)};
k.prototype.removeFeatureHoverListener=function(a,b){a=arrayIndexOf(this.featureHoverListeners,a);0<=a&&this.featureHoverListeners.splice(a,1)};k.prototype.notifyFeatureHover=function(a,b,e,g){for(var d=0;d<this.featureHoverListeners.length;++d)try{this.featureHoverListeners[d](a,b,e,g)}catch(H){console.log(H.stack)}};k.prototype.addViewListener=function(a,b){this.viewListeners.push(a)};k.prototype.removeViewListener=function(a,b){a=arrayIndexOf(this.viewListeners,a);0<=a&&this.viewListeners.splice(a,
1)};k.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),b=this.viewEnd|0;0<this.currentSeqMax&&b>this.currentSeqMax&&(b=this.currentSeqMax);for(var e=0;e<this.viewListeners.length;++e)try{this.viewListeners[e](this.chr,a,b,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(P){console.log(P.stack)}};k.prototype.addTierListener=
function(a){this.tierListeners.push(a)};k.prototype.removeTierListener=function(a){a=arrayIndexOf(this.tierListeners,a);0<=a&&this.tierListeners.splice(a,1)};k.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(I){console.log(I.stack)}};k.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};k.prototype.removeRegionSelectListener=function(a){a=arrayIndexOf(this.regionSelectListeners,a);0<=a&&this.regionSelectListeners.splice(a,
1)};k.prototype.notifyRegionSelect=function(a,b,e){for(var g=0;g<this.regionSelectListeners.length;++g)try{this.regionSelectListeners[g](a,b,e)}catch(y){console.log(y.stack)}};k.prototype.highlightRegion=function(a,b,e){var g=this;if(a==this.chr)return this._highlightRegion(a,b,e);var d=this.getSequenceSource();if(!d)throw"Need a sequence source";d.getSeqInfo(a,function(f){if(f)return g._highlightRegion(a,b,e);var n=0==a.indexOf("chr")?a.substr(3):"chr"+a;d.getSeqInfo(n,function(a){if(a)return g._highlightRegion(n,
b,e)})})};k.prototype._highlightRegion=function(a,b,e){for(var g=0;g<this.highlights.length;++g){var d=this.highlights[g];if(d.chr==a&&d.min==b&&d.max==e)return}this.highlights.push(new m(a,b,e));g=this.viewStart-1E3/this.scale;d=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&b<d&&e>g&&this.drawOverlays();this.notifyLocation()};k.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};k.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};
k.prototype.featuresInRegion=function(a,b,e){var g=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var d=this.tiers[a].currentFeatures||[],f=0;f<d.length;++f){var n=d[f];n.min<=e&&n.max>=b&&g.push(n)}return g};k.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};k.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};k.prototype.markSelectedTiers=function(){for(var a=
0;a<this.tiers.length;++a){var b=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?b.classList.add("active"):b.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};k.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};k.prototype.removeTierSelectionListener=function(a){a=arrayIndexOf(this.tierSelectionListeners,
a);0<=a&&this.tierSelectionListeners.splice(a,1)};k.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(I){console.log(I.stack)}};k.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};k.prototype.removeTierSelectionWrapListener=function(a){a=arrayIndexOf(this.tierSelectionWrapListeners,a);0<=a&&this.tierSelectionWrapListeners.splice(a,1)};k.prototype.notifyTierSelectionWrap=
function(a){for(var b=0;b<this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(G){console.log(G.stack)}};k.prototype.positionRuler=function(){var a="",b="";if("center"==this.rulerLocation){var e="block";a=""+(this.featurePanelWidth/2|0)+"px"}else"left"==this.rulerLocation?(e="block",a="0px"):"right"==this.rulerLocation?(e="block",b="0px"):e="none";this.ruler.style.display=e;this.ruler.style.left=a;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display=
"block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display=
"center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var g=0;g<this.tiers.length;++g){var d=this.tiers[g],f=d.quantOverlay;if(d.subtiers&&0<d.subtiers.length)var n=d.subtiers[0].quant;f&&(f.style.display=n?e:"none",f.style.left=a,f.style.right=b)}};k.prototype.featureDoubleClick=function(a,b,e){if(a&&0!=a.length&&(e=a[a.length-1],e.min&&e.max)){var g=((e.min|0)-(this.viewStart|0))*this.scale,d=(e.max-e.min+1)*this.scale;a=((e.min|0)+(e.max|0))/
2;10<d&&(b=1*(b-g)/d,.3>b?a=e.min|0:.7<b&&(a=(e.max|0)+1));b=this.viewEnd-this.viewStart;this.setLocation(null,a-b/2,a+b/2)}};k.prototype.zoomForScale=function(a){return.2<a?"high":.01<a?"medium":"low"};k.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};k.prototype.updateHeight=function(){for(var a=0,b=0;b<this.tiers.length;++b)a+=this.tiers[b].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";
this.browserHolder.style.display="-webkit-flex";this.browserHolder.style.display="flex"};k.prototype.scrollArrowKey=function(a,b){this.reverseKeyScrolling&&(b=-b);if(a.ctrlKey||a.metaKey){var e=!1;a.shiftKey&&(e=!0);this.leap(b,e)}else if(1<this.scale){e=(this.viewStart+this.viewEnd)/2;e-=Math.round(e);var g=1;a.shiftKey&&(g*=10);0<b?(g=-g-e,0<e&&(g+=1)):(g-=e,0>e&&--g);this.setLocation(null,this.viewStart+g,this.viewEnd+g)}else this.move(a.shiftKey?100*b:25*b)};k.prototype.leap=function(a,b){var e=
this,g=(e.viewStart+e.viewEnd+1)/2|0;0<a&&1>=e.viewStart?g-=1E8:0>a&&e.viewEnd>=e.currentSeqMax&&(g+=1E8);var d=e.getSelectedTier();0>d||((d=e.tiers[d])&&(d.featureSource&&this.sourceAdapterIsCapable(d.featureSource,"quantLeap")&&"number"==typeof d.quantLeapThreshold||d.featureSource&&this.sourceAdapterIsCapable(d.featureSource,"leap"))?d.findNextFeature(e.chr,g,-a,b,function(d){if(d){var f=d.min,n=d.max;b&&(0<a?f>g+1?n=f:(n++,f=n):n<g-1?(n++,f=n):n=f);var y=e.viewEnd-e.viewStart+1;parseFloat(y/2)==
parseInt(y/2)&&y--;f=(f+n-y)/2+1;e.setLocation(d.segment,f,f+y-1)}else alert("no next feature")}):this.move(100*a))};k.prototype.nameForCoordSystem=function(a){var b=null,e=null;this.assemblyNamePrimary&&(b=""+a.auth,"undefined"!==typeof a.version&&(b+=a.version));this.assemblyNameUcsc&&(e=a.ucscName);return null!=b&&null!=e?b+"/"+e:b||e||"unknown"};k.prototype.makeLoader=function(a){var e=1<window.devicePixelRatio;return 20>(a||16)?b("img",null,{src:this.resolveURL("$$img/spinner_"+(e?16:32)+".gif"),
width:"16",height:"16"}):b("img",null,{src:this.resolveURL("$$img/spinner_"+(e?24:48)+".gif"),width:"24",height:"24"})};k.prototype.canFetchPlainHTTP=function(){var a=this;if(!this._plainHTTPPromise){var b=this.getWorker();this._plainHTTPPromise=b?new x(function(e,g){b.postCommand({command:"textxhr",uri:a.httpCanaryURL},function(a,b){a?e(!0):e(!1)})}):new x(function(b,e){C(a.httpCanaryURL,function(a,e){a?b(!0):b(!1)},{timeout:2E3})})}return this._plainHTTPPromise};k.prototype.getWorker=function(){if(!this.useFetchWorkers||
!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};A.prototype.postCommand=function(a,b,e){var g="x"+ ++this.tagSeed;a.tag=g;this.callbacks[g]=b;this.worker.postMessage(a,e)};if("undefined"!==typeof v){v.exports={Browser:k};c("./browser-ui");c("./track-adder");c("./feature-popup");c("./tier-actions");c("./domui");c("./search");v=c("./sourceadapters");var T=v.TwoBitSequenceSource;var U=
v.DASSequenceSource;var S=c("./kspace").KnownSpace;var W=c("./das").DASRegistry}B.prototype.get=function(a){var b=this.sourcesByURI[E(a)];if(b)for(var e=0;e<b.configs.length;++e)if(n(b.configs[e],a))return b.sources[e]};B.prototype.put=function(a,b){var e=E(a),g=this.sourcesByURI[e];g||(g={configs:[],sources:[]},this.sourcesByURI[e]=g);g.configs.push(a);g.sources.push(b)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":27,"./search":31,"./sha1":34,
"./sourceadapters":35,"./sourcecompare":36,"./thub":43,"./tier":46,"./tier-actions":44,"./track-adder":47,"./utils":50,"./version":52,"es6-promise":54}],7:[function(c,v,u){function m(b,d,a,e){"string"==typeof b?(this.uri=b,this.srcTag=d,this.destTag=a,this.coords=e):(this.uri=b.uri,this.srcTag=b.srcTag,this.destTag=b.destTag,this.coords=q(b.coords),this.type=b.type,this.credentials=b.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=
1E6;this.chainFetcher="bigbed"==this.type?new h(this.uri,this.credentials):"alias"==this.type?new B(b):new k(this.uri,this.srcTag,this.destTag)}function k(b,d,a){this.source=new f(b);this.srcTag=d;this.destTag=a}function h(b,d){var a=this;this.uri=b;this.credentials=d;this.bwg=new t(function(b,g){l(new C(a.uri,{credentials:a.credentials}),function(a,e){a?b(a):g(e)})});this.bwg.then(function(a,b){b&&console.log(b)})}function r(b){return parseInt(b)}function A(b){return 0==b.indexOf("chr")?b.substr(3):
b}function w(b){var g={srcChr:A(b.srcChrom),srcMin:parseInt(b.srcStart),srcMax:parseInt(b.srcEnd),srcOri:b.srcOri,destChr:A(b.segment),destMin:b.min-1,destMax:b.max,destOri:b.ori,blocks:[]},a=b.srcStarts.split(",").map(r),e=b.destStarts.split(",").map(r);b=b.blockLens.split(",").map(r);for(var d=0;d<a.length;++d)g.blocks.push([a[d],e[d],b[d]]);return g}function B(b){this.conf=b;this.forwardAliases={};b=b.sequenceAliases||[];for(var g=0;g<b.length;++g){var a=b[g];if(!(2>a.length)){for(var e=[],d=0;d<
a.length-1;++d)e.push(a[d]);this.forwardAliases[a[a.length-1]]=e}}}if("undefined"!==typeof c){u=c("./das");var f=u.DASSource;var b=u.DASSegment;u=c("./utils");var d=u.pusho;var q=u.shallowCopy;var z=c("./cigar").parseCigar;var C=c("./bin").URLFetchable;var l=c("./bigwig").makeBwg;var t=c("es6-promise").Promise}m.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};m.prototype.mapPoint=function(b,
d){for(var a=this.chainsBySrc[b]||[],e=0;e<a.length;++e)if(b=a[e],d>=b.srcMin&&d<=b.srcMax){var g="-"==b.srcOri?b.srcMax-d:d-b.srcMin;for(var f=b.blocks,l=0;l<f.length;++l){var n=f[l],q=n[0],c=n[1];n=n[2];if(g>=q&&g<=q+n)return d=g-q,{seq:b.destChr,pos:"-"==b.destOri?b.destMax-c-d:d+c+b.destMin,flipped:b.srcOri!=b.destOri}}}return null};m.prototype.mapSegment=function(b,d,a){b=this.chainsBySrc[b]||[];for(var e=[],g=0;g<b.length;++g){var f=b[g];if(a>=f.srcMin&&d<=f.srcMax){if("-"==f.srcOri){var l=
f.srcMax-a;var n=f.srcMax-d}else l=d-f.srcMin,n=a-f.srcMin;for(var q=f.blocks,c=0;c<q.length;++c){var h=q[c],z=h[0],C=h[1];h=h[2];if(n>=z&&l<=z+h){var t={segment:f.destChr,flipped:"-"==f.srcOri^"-"==f.destOri};"-"==f.destOri?(l>=z?t.max=f.destMax-C-l+z:(t.max=f.destMax-C,t.partialMax=z-l),n<=z+h?t.min=f.destMax-C-n+z:(t.min=f.destMax-C-h,t.partialMin=n-z-h)):(l>=z?t.min=f.destMin+C+l-z:(t.min=f.destMin+C,t.partialMin=z-l),n<=z+h?t.max=f.destMin+C+n-z:(t.max=f.destMin+C+h,t.partialMax=n-z-h));e.push(t)}}}}return e};
m.prototype.unmapPoint=function(b,d){for(var a=this.chainsByDest[b]||[],e=0;e<a.length;++e)if(b=a[e],d>=b.destMin&&d<=b.destMax){var g="-"==b.srcOri?b.destMax-d:d-b.destMin;for(var f=b.blocks,l=0;l<f.length;++l){var n=f[l],q=n[0],c=n[1];n=n[2];if(g>=c&&g<=c+n)return d=g-c,{seq:b.srcChr,pos:"-"==b.destOri?b.srcMax-q-d:d+q+b.srcMin,flipped:b.srcOri!=b.destOri}}}return null};m.prototype.sourceBlocksForRange=function(g,f,a,e){for(var l=this,q=f/this.granularity|0,c=a/this.granularity|0,n=!1,h=q;h<=c;++h){var z=
g+"_"+h;2!=this.fetchedTiles[z]&&(n=!0,1!=this.fetchedTiles[z]&&(this.fetchedTiles[z]=1))}if(n)this.postFetchQueues[g]||this.chainFetcher.fetchChains(g,q*this.granularity,(c+1)*this.granularity-1).then(function(a){l.chainsByDest||(l.chainsByDest[g]=[]);for(var b=0;b<a.length;++b){var e=a[b],d=l.chainsBySrc[e.srcChr];if(d){var f=!1;for(var n=0;n<d.length;++n){var y=d[n];if(y.srcMin==e.srcMin&&y.srcMax==e.srcMax){f=!0;break}}f||d.push(e)}else l.chainsBySrc[e.srcChr]=[e];if(d=l.chainsByDest[e.destChr]){f=
!1;for(n=0;n<d.length;++n)if(y=d[n],y.destMin==e.destMin&&y.destMax==e.destMax){f=!0;break}f||d.push(e)}else l.chainsByDest[e.destChr]=[e]}for(a=q;a<=c;++a)l.fetchedTiles[g+"_"+a]=2;if(l.postFetchQueues[g]){a=l.postFetchQueues[g];for(y=0;y<a.length;++y)a[y]();l.postFetchQueues[g]=null}}).catch(function(a){console.log(a)}),d(this.postFetchQueues,g,function(){l.sourceBlocksForRange(g,f,a,e)});else{n=[];h=this.chainsByDest[g]||[];for(z=0;z<h.length;++z){var t=h[z];if(f<=t.destMax&&a>=t.destMin){if("-"==
t.srcOri){var C=t.destMax-a;var B=t.destMax-f}else C=f-t.destMin,B=a-t.destMin;for(var k=t.blocks,A=0;A<k.length;++A){var w=k[A],m=w[0],y=w[1],H=w[2];B>=y&&C<=y+H&&(w=Math.max(C,y)-y,y=Math.min(B,y+H)-y,"-"==t.destOri?n.push(new b(t.srcChr,t.srcMax-m-y,t.srcMax-m-w)):n.push(new b(t.srcChr,t.srcMin+w+m,t.srcMin+y+m)))}}}e(n)}};k.prototype.fetchChains=function(b,d,a){var e=this;return new t(function(a,d){e.source.alignments(b,{},function(b){for(var d=[],g=0;g<b.length;++g)for(var f=b[g],l=0;l<f.blocks.length;++l){for(var p=
f.blocks[l],q,c,h=0;h<p.segments.length;++h){var x=p.segments[h],t=f.objects[x.object];t.dbSource===e.srcTag?q=x:t.dbSource===e.destTag&&(c=x)}if(q&&c){p={srcChr:f.objects[q.object].accession,srcMin:q.min|0,srcMax:q.max|0,srcOri:q.strand,destChr:f.objects[c.object].accession,destMin:c.min|0,destMax:c.max|0,destOri:c.strand,blocks:[]};h=z(q.cigar);x=z(c.cigar);for(var y=t=0,C=0,B=0;C<h.length&&B<x.length;)if("M"==h[C].op&&"M"==x[B].op){var k=Math.min(h[C].cnt,x[B].cnt);p.blocks.push([t,y,k]);h[C].cnt==
k?++C:h[C].cnt-=k;x[B].cnt==k?++B:x[B]-=k;t+=k;y+=k}else"I"==h[C].op?y+=h[C++].cnt:"I"==x[B].op&&(t+=x[B++].cnt);d.push(p)}}a(d)})})};h.prototype.fetchChains=function(b,d,a){return this.bwg.then(function(e,g){if(!e)throw Error("No BWG");return new t(function(g,f){e.getUnzoomedView().readWigData(b,d,a,function(a){g(a.map(w))})})})};B.prototype.fetchChains=function(b,d,a){d=[];a=this.forwardAliases[b]||[];for(var e=0;e<a.length;++e)d.push({srcChr:a[e],srcMin:1,srcMax:1E9,srcOri:"+",destChr:b,destMin:1,
destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return t.resolve(d)};"undefined"!==typeof v&&(v.exports={Chainset:m})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":50,"es6-promise":54}],8:[function(c,v,u){function m(c){for(var h=[],A;null!=(A=k.exec(c));){var w=A[1];0==w.length&&(w=1);h.push({cnt:w|0,op:A[2]})}return h}var k=/([0-9]*)([MIDS])/g;"undefined"!==typeof v&&(v.exports={parseCigar:m})},{}],9:[function(c,v,u){function m(b,d,f,c){this.red=b|0;this.green=d|0;this.blue=f|0;c&&(this.name=
c)}function k(b){b="00"+b.toString(16);return b.substring(b.length-2)}function h(b){var d=w[b];d||((d=B.exec(b))?d=new m("0x"+d[1]|0,"0x"+d[2]|0,"0x"+d[3]|0,b):(d=f.exec(b))?d=new m(d[1]|0,d[2]|0,d[3]|0,b):(console.log("couldn't handle color: "+b),d=w.black),w[b]=d);return d}function r(b,d,f){for(var q=[],c=0;c<f.length;++c)q.push(h(f[c]));f=[];c=0;a:for(;c<b;++c){for(var l=d[0]+1*c/(b-1)*(d[d.length-1]-d[0]),t=0;t<d.length-1;++t)if(l>=d[t]&&l<=d[t+1]){l=(l-d[t])/(d[t+1]-d[t]);var g=q[t];t=q[t+1];
t=(new m(g.red*(1-l)+t.red*l|0,g.green*(1-l)+t.green*l|0,g.blue*(1-l)+t.blue*l|0)).toSvgString();f.push(t);continue a}throw"Bad step";}return f}function A(b,d,f,c){return c?r(b,[0,.5,1],[d,f,c]):r(b,[0,1],[d,f])}m.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};m.prototype.toHexString=function(){return"#"+k(this.red)+k(this.green)+k(this.blue)};var w={red:new m(255,0,0,"red"),green:new m(0,255,0,"green"),blue:new m(0,0,255,
"blue"),yellow:new m(255,255,0,"yellow"),white:new m(255,255,255,"white"),black:new m(0,0,0,"black"),gray:new m(180,180,180,"gray"),grey:new m(180,180,180,"grey"),lightskyblue:new m(135,206,250,"lightskyblue"),lightsalmon:new m(255,160,122,"lightsalmon"),hotpink:new m(255,105,180,"hotpink")},B=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,f=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof v&&(v.exports={makeColourSteps:r,makeGradient:A,dasColourForName:h})},{}],10:[function(c,v,u){function m(a,
b,e,d){this.name=a;this.start=b;this.end=e;this.description=d}function k(a,b){"string"==typeof a?(this.uri=a,a=b||{}):a=a||{};for(var e in a)"function"!=typeof a[e]&&(this[e]=a[e]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function h(){}function r(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}function A(a,b,e,d,g){this.name=a;this.start=b;this.end=e;this.alphabet=
d;this.seq=g}function w(){}function B(a){a&&(this.id=a)}function f(a,b){this.desc=a;this.uri=b}function b(a){this.type=a;this.objects={};this.blocks=[]}function d(){this.styles=[]}function q(){}function z(a,b){b=b||{};this.uri=a;this.opts=b}function C(a,b){a=a.getElementsByTagName(b);if(0<a.length&&a[0].firstChild){a=a[0];if(1==a.childNodes.length)return a.firstChild.nodeValue;b="";for(var e=0;e<a.childNodes.length;++e)b+=a.childNodes[e].nodeValue;return b}return null}function l(a){for(var b=[],e=
a.getElementsByTagName("LINK"),d=0;d<e.length;++d){var g=e[d];g.parentNode==a&&b.push(new f(g.firstChild?g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return b}function t(a){var b=[];a=a.getElementsByTagName("NOTE");for(var e=0;e<a.length;++e)a[e].firstChild&&b.push(a[e].firstChild.nodeValue);return b}function g(a,b,e,d){if(window.XDomainRequest){var g=new XDomainRequest;g.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(g.responseText);b(a)};g.open("get",
a);g.send("")}else try{g=new XMLHttpRequest;var f=setTimeout(function(){console.log("timing out "+a);g.abort();b(null,g)},5E3);g.timeout=5E3;g.ontimeout=function(){console.log("timeout on "+a)};g.onreadystatechange=function(){4==g.readyState&&(clearTimeout(f),(200<=g.status||0==g.status)&&b(g.responseXML,g))};g.open("get",a,!0);e&&(g.withCredentials=!0);d&&g.setRequestHeader("X-DAS-Authorisation",d);g.overrideMimeType("text/xml");g.setRequestHeader("Accept","application/xml,*/*");g.send("")}catch(D){b(null,
g,D)}}function F(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function a(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function e(a){var b=p(a);b.styles=[];for(var e=0;e<a.styles.length;++e){var d=b.styles[e]=p(a.styles[e]);d._methodRE=d._labelRE=d._typeRE=void 0;d.style=p(d.style);d.style.id=void 0;d.style._gradient=void 0}return b}if("undefined"!==typeof c){u=c("./utils");var p=u.shallowCopy;var x=u.pusho;var J=c("./color").makeColourSteps}m.prototype.toString=function(){return this.name+
":"+this.start+".."+this.end};m.prototype.isBounded=function(){return this.start&&this.end};m.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};k.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var e=[];b=b.getElementsByTagName("SEGMENT");for(var d=0;d<b.length;++d){var g=b[d],f=g.getAttribute("id"),n=g.getAttribute("size");if(n){var l=1;n|=0}else(l=g.getAttribute("start"))&&
(l|=0),(n=g.getAttribute("stop"))&&(n|=0);var p=null;g.firstChild&&(p=g.firstChild.nodeValue);e.push(new m(f,l,n,p))}a(e)})};k.prototype.sequence=function(a,b){a=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(a,function(a){if(a){var e=[];a=a.getElementsByTagName("SEQUENCE");for(var d=0;d<a.length;++d){var g=a[d],f=g.getAttribute("id"),n=g.getAttribute("start"),l=g.getAttribute("stop"),p=null;if(g.firstChild){g=g.firstChild.nodeValue;p="";for(var y=0;;){var c=g.indexOf("\n",y);
if(0<=c)p+=g.substring(y,c).toUpperCase(),y=c+1;else{p+=g.substring(y).toUpperCase();break}}}e.push(new A(f,n,l,"DNA",p))}b(e)}else b([])})};k.prototype.features=function(a,b,e){b=b||{};if(this.features_uri)var d=this.features_uri;else{var g=[];if(a)g.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)g.push("group_id="+a);else for(var f=0;f<a.length;++f)g.push("group_id="+a[f]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),f=0;f<a.length;++f)g.push("adjacent="+a[f]);
if(b.type)if("string"==typeof b.type)g.push("type="+b.type);else for(a=0;a<b.type.length;++a)g.push("type="+b.type[a]);b.maxbins&&g.push("maxbins="+b.maxbins);0<g.length?d=this.dasBaseURI+"features?"+g.join(";"):e([],"No filters specified")}this.doCrossDomainRequest(d,function(a,b){if(a){b=[];var d={};a=a.getElementsByTagName("SEGMENT");for(var g=0;g<a.length;++g){var f=a[g],n=f.getAttribute("id");d[n]={min:f.getAttribute("start"),max:f.getAttribute("stop")};f=f.getElementsByTagName("FEATURE");for(var p=
0;p<f.length;++p){var c=f[p],q=new w;q.segment=n;q.id=c.getAttribute("id");q.label=c.getAttribute("label");var h=C(c,"START");var x=C(c,"END");(h|0)>(x|0)?(q.min=x|0,q.max=h|0):(q.min=h|0,q.max=x|0);h=c.getElementsByTagName("TYPE");0<h.length&&(h=h[0],h.firstChild&&(q.type=h.firstChild.nodeValue),q.typeId=h.getAttribute("id"),q.typeCv=h.getAttribute("cvId"));q.type=C(c,"TYPE");!q.type&&q.typeId&&(q.type=q.typeId);q.method=C(c,"METHOD");(h=C(c,"ORIENTATION"))||(h="0");q.orientation=h;q.score=C(c,"SCORE");
q.links=l(c);q.notes=t(c);h=c.getElementsByTagName("GROUP");for(x=0;x<h.length;++x){var z=h[x],E=new B;E.type=z.getAttribute("type");E.id=z.getAttribute("id");E.links=l(z);E.notes=t(z);q.groups?q.groups.push(E):q.groups=Array(E)}if(q.notes)for(h=0;h<q.notes.length;++h)x=q.notes[h],0==x.indexOf("Genename=")&&(z=new B,z.type="gene",z.id=x.substring(9),q.groups?q.groups.push(z):q.groups=Array(z));h=c.getElementsByTagName("PART");if(0<h.length){z=[];for(x=0;x<h.length;++x)z.push(h[x].getAttribute("id"));
q.parts=z}h=c.getElementsByTagName("PARENT");if(0<h.length){c=[];for(x=0;x<h.length;++x)c.push(h[x].getAttribute("id"));q.parents=c}b.push(q)}}e(b,void 0,d)}else e([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){e([],a)})};k.prototype.alignments=function(a,e,d){var g=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(g,function(a){if(a){var e=[];a=a.getElementsByTagName("alignment");for(var f=0;f<a.length;++f){for(var n=a[f],l=new b(n.getAttribute("alignType")),
q=n.getElementsByTagName("alignObject"),y=0;y<q.length;++y){var p=q[y];p={id:p.getAttribute("intObjectId"),accession:p.getAttribute("dbAccessionId"),version:p.getAttribute("objectVersion"),dbSource:p.getAttribute("dbSource"),dbVersion:p.getAttribute("dbVersion")};l.objects[p.id]=p}n=n.getElementsByTagName("block");for(q=0;q<n.length;++q){p=n[q];y={order:p.getAttribute("blockOrder"),segments:[]};p=p.getElementsByTagName("segment");for(var c=0;c<p.length;++c){var h=p[c];h={object:h.getAttribute("intObjectId"),
min:h.getAttribute("start"),max:h.getAttribute("end"),strand:h.getAttribute("strand"),cigar:C(h,"cigar")};y.segments.push(h)}l.blocks.push(y)}e.push(l)}d(e)}else d([],"Failed request "+g)})};d.prototype.pushStyle=function(a,b,e){a||(a={type:"default"});a=p(a);b&&(a.zoom=b);a.style=e;this.styles.push(a)};k.prototype.stylesheet=function(a,b){var e=this.credentials;if(this.stylesheet_uri){var f=this.stylesheet_uri;e=!1}else f=this.dasBaseURI+"stylesheet";g(f,function(e){if(e){var g=new d;e=e.getElementsByTagName("TYPE");
for(var f=0;f<e.length;++f){var n=e[f],l={};l.type=n.getAttribute("id");l.label=n.getAttribute("label");l.method=n.getAttribute("method");n=n.getElementsByTagName("GLYPH");for(var p=0;p<n.length;++p){var y=n[p],c=y.getAttribute("zoom");a:{if(y.hasChildNodes()){y=y.firstChild;do{if(y.nodeType==Node.ELEMENT_NODE){var h=y;break a}y=y.nextSibling}while(null!=y)}h=null}y=new q;y.glyph=h.localName;for(h=h.firstChild;h;){if(h.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==h.localName){var x=y,z=h.localName,t=
h;var C=(C=t.getAttribute("steps"))?C|0:50;var B=[],E=[];t=t.getElementsByTagName("STOP");for(var k=0;k<t.length;++k){var w=t[k];B.push(1*w.getAttribute("score"));E.push(w.firstChild.nodeValue)}C=J(C,B,E);x[z]=C}else y[h.localName]=h.firstChild.nodeValue;h=h.nextSibling}g.pushStyle(l,c,y)}}a(g)}else b&&b()},e)};z.prototype.sources=function(a,b,e){e||(e={});var d=[];e.taxon&&d.push("organism="+e.taxon);e.auth&&d.push("authority="+e.auth);e.version&&d.push("version="+e.version);e=this.uri;0<d.length&&
(e=e+"?"+d.join("&"));g(e,function(e){if(!e&&b)b();else{var d=[];e=e.getElementsByTagName("SOURCE");for(var g=0;g<e.length;++g){var f=e[g],n=f.getElementsByTagName("VERSION");if(!(1>n.length)){var l=n[0],y=l.getElementsByTagName("COORDINATES");n=[];for(var p=0;p<y.length;++p){var q=y[p],c=new h;c.auth=q.getAttribute("authority");c.taxon=q.getAttribute("taxid");c.version=q.getAttribute("version");n.push(c)}y=[];q=l.getElementsByTagName("CAPABILITY");for(p=0;p<q.length;++p)if(c=q[p],y.push(c.getAttribute("type")),
"das1:features"==c.getAttribute("type")){var z=c.getAttribute("query_uri");z=z.substring(0,z.length-8)}p={};l=l.getElementsByTagName("PROP");for(q=0;q<l.length;++q)x(p,l[q].getAttribute("name"),l[q].getAttribute("value"));z&&(f=new k(z,{source_uri:f.getAttribute("uri"),name:f.getAttribute("title"),desc:f.getAttribute("description"),coords:n,props:p,capabilities:y}),d.push(f))}}a(d)}})};k.prototype.doCrossDomainRequest=function(a,b,e){var d;this.xUser&&(d="Basic "+btoa(this.xUser+":"+this.xPass));
try{return g(a,b,this.credentials,d)}catch(S){if(e)e(S);else throw S;}};"undefined"!==typeof v&&(v.exports={DASGroup:B,DASFeature:w,DASStylesheet:d,DASStyle:q,DASSource:k,DASSegment:m,DASRegistry:z,DASSequence:A,DASLink:f,isDasBooleanTrue:F,isDasBooleanNotFalse:a,copyStylesheet:e,coordsMatch:r})},{"./color":9,"./utils":50}],11:[function(c,v,u){function m(c,k,B){function f(){B?(b.className="fa fa-caret-down",k.style.display="table"):(b.className="fa fa-caret-right",k.style.display="none")}var b=h("i");
f();b.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();B=!B;f()},!1);c=h("h6",[b," ",c],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return h("div",[c,k],{})}if("undefined"!==typeof c){var k=c("./cbrowser").Browser;c=c("./utils");var h=c.makeElement;var r=c.removeChildren}k.prototype.removeAllPopups=function(){r(this.hPopupHolder);r(this.popupHolder)};k.prototype.makeTooltip=function(c,k){var B=!1,f=this,b=null;var d=
function(f){B=!1;b&&(clearTimeout(b),b=null);c.removeEventListener("mouseout",d,!1)};var q=function(d){var z=d.clientX+window.scrollX,l=d.clientY+window.scrollY;b||(b=setTimeout(function(){var d="function"===typeof k?k():k;var g=h("div",[h("div",null,{className:"tooltip-arrow"}),h("div",d,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(l+20)+"px",left:""+Math.max(z-30,20)+"px"});f.hPopupHolder.appendChild(g);var C=function(a){try{f.hPopupHolder.removeChild(g)}catch(e){}window.removeEventListener("mousemove",
C,!1);B&&null!=c.offsetParent&&q(a)};window.addEventListener("mousemove",C,!1);b=null},1E3))};c.addEventListener("mouseover",function(b){B=!0;c.addEventListener("mouseout",d,!1);q(b)},!1);c.addEventListener("DOMNodeRemovedFromDocument",function(d){B=!1;b&&(clearTimeout(b),b=null)},!1)};k.prototype.popit=function(c,k,B,f){var b=this;f||(f={});c||(c={});var d=f.width||200;if(c.clientX){var q=c.clientX;f=c.clientY}else q=500,f=50;q+=document.documentElement.scrollLeft||document.body.scrollLeft;f+=document.documentElement.scrollTop||
document.body.scrollTop;var z=window.innerWidth,C=f,l=Math.min(q-d/2-4,z-d-30),t=h("div");t.className="popover fade "+(c.clientX?"bottom ":"")+"in";t.style.display="block";t.style.position="absolute";t.style.top=""+C+"px";t.style.left=""+l+"px";t.style.width=d+"px";276<d&&(t.style.maxWidth=d+"px");t.appendChild(h("div",null,{className:"arrow"}));if(k){var g=h("button","",{className:"close"});g.innerHTML="&times;";g.addEventListener("mouseover",function(a){g.style.color="red"},!1);g.addEventListener("mouseout",
function(a){g.style.color="black"},!1);g.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();b.removeAllPopups()},!1);c=h("h4",[h("span",k,null,{maxWidth:"200px"}),g],{},{paddingLeft:"10px",paddingRight:"10px"});var m,a;var e=function(b){b.stopPropagation();b.preventDefault();l+=b.clientX-m;8>l&&(l=8);l>z-d-32&&(l=z-d-26);C+=b.clientY-a;C=Math.max(10,C);t.style.top=""+C+"px";t.style.left=""+Math.min(l,z-d-10)+"px";m=b.clientX;a=b.clientY};var p=function(a){a.stopPropagation();
a.preventDefault();window.removeEventListener("mousemove",e,!1);window.removeEventListener("mouseup",p,!1)};c.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();m=b.clientX;a=b.clientY;window.addEventListener("mousemove",e,!1);window.addEventListener("mouseup",p,!1)},!1);t.appendChild(c)}t.appendChild(h("div",B,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(t);var x={node:t,displayed:!0};t.addEventListener("DOMNodeRemoved",function(a){a.target==
t&&(x.displayed=!1)},!1);return x};"undefined"!==typeof v&&(v.exports={makeTreeTableSection:m})},{"./cbrowser":6,"./utils":50}],12:[function(c,v,u){function m(c,h){0>c.indexOf("?")&&(c+="?soft=true");return new r(function(B,f){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState)if(300<=b.status)f("Error code "+b.status);else{var d=JSON.parse(b.response);B(h?d:d.location)}};b.open("GET",c,!0);b.setRequestHeader("Accept","application/json");b.responseType="text";b.send("")})}
function k(c){this.rawurl=c}function h(c,h,B,f){f||("object"===typeof h?(f=h,h=void 0):f={});this.url="string"===typeof c?new k(c):c;this.start=h||0;B&&(this.end=B);this.opts=f}if("undefined"!==typeof c)var r=c("es6-promise").Promise;k.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=m(this.rawurl,!0).then(function(c){return c.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};h.prototype.slice=function(c,k){if(0>c)throw"Bad slice "+
c;var B=this.start,f=this.end;B=B&&c?B+c:c||B;return new h(this.url,B,k&&B?B+k-1:f||k-1,this.opts)};h.prototype.fetchAsText=function(c){var h=this,B=new XMLHttpRequest;h.url.getURLPromise().then(function(f){B.open("GET",f,!0);if(h.end){if(1E8<h.end-h.start)throw"Monster fetch!";B.setRequestHeader("Range","bytes="+h.start+"-"+h.end)}B.onreadystatechange=function(){if(4==B.readyState)return 200==B.status||206==B.status?c(B.responseText):c(null)};h.opts.credentials&&(B.withCredentials=!0);B.send("")}).catch(function(f){console.log(f);
return c(null)})};h.prototype.salted=function(){return this};h.prototype.fetch=function(c,h,B){var f=this;h=h||1;if(3<h)return c(null);f.url.getURLPromise().then(function(b){var d=new XMLHttpRequest;d.open("GET",b,!0);d.overrideMimeType("text/plain; charset=x-user-defined");if(f.end){if(1E8<f.end-f.start)throw"Monster fetch!";d.setRequestHeader("Range","bytes="+f.start+"-"+f.end);var q=f.end-f.start+1}d.responseType="arraybuffer";d.onreadystatechange=function(){if(4==d.readyState){if(200==d.status||
206==d.status){if(d.response){var b=d.response.byteLength;return!q||q==b||B&&b==B?c(d.response):f.fetch(c,h+1,b)}if(d.mozResponseArrayBuffer)return c(d.mozResponseArrayBuffer);b=d.responseText;if(!q||q==b.length||B&&b.length==B){if(b=d.responseText){for(var C=new Uint8Array(b.length),l=0;l<C.length;++l)C[l]=b.charCodeAt(l);b=C.buffer}else b=null;return c(b)}return f.fetch(c,h+1,b.length)}return f.fetch(c,h+1)}};f.opts.credentials&&(d.withCredentials=!0);d.send("")}).catch(function(b){console.log(b)})};
"undefined"!==typeof v&&(v.exports={lookupEncodeURI:m,EncodeFetchable:h})},{"es6-promise":54}],13:[function(c,v,u){function m(f){h.call(this);this.source=f;this.base=f.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var b=window.location.protocol;"http:"!=b&&"https:"!=b&&(this.base="http:"+this.base)}this.species=f.species||"human";this.type="string"===typeof f.type?[f.type]:f.type||["regulatory"]}if("undefined"!==typeof c){v=c("./sourceadapters");var k=v.registerSourceAdapterFactory;var h=
v.FeatureSourceBase;c=c("./das");var r=c.DASStylesheet;var A=c.DASStyle;var w=c.DASFeature;var B=c.DASGroup}m.prototype=Object.create(h.prototype);m.prototype.constructor=m;m.prototype.getStyleSheet=function(f){var b=new r;var d=new A;d.glyph="__NONE";0<=this.type.indexOf("exon")&&b.pushStyle({type:"transcript"},null,d);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&b.pushStyle({type:"gene"},null,d);d=new A;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=8;d.BUMP=!0;
d.LABEL=!0;d.ZINDEX=10;b.pushStyle({type:"cds"},null,d);d=new A;d.glyph="SQUARE";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="blue";b.pushStyle({type:"variation",method:".+_UTR_variant"},null,d);d=new A;d.glyph="TRIANGLE";d.DIRECTION="S";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="blue";b.pushStyle({type:"variation",method:"missense_variant"},null,d);d=new A;d.glyph="TRIANGLE";d.DIRECTION="N";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="blue";b.pushStyle({type:"variation",method:"splice_.+_variant"},null,d);d=new A;d.glyph=
"STAR";d.POINTS=6;d.BUMP="yes";d.LABEL="no";d.FGCOLOR="blue";b.pushStyle({type:"variation",method:"regulatory_region_variant"},null,d);d=new A;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.STROKECOLOR="black";b.pushStyle({type:"variation"},null,d);d=new A;d.glyph="SQUARE";d.BUMP="yes";d.LABEL="no";d.BGCOLOR="#888888";d.FGCOLOR="red";b.pushStyle({type:"indel",method:".+_UTR_variant"},null,d);d=new A;d.glyph="TRIANGLE";d.DIRECTION="S";d.BUMP="yes";d.LABEL="no";d.BGCOLOR=
"#888888";d.FGCOLOR="red";b.pushStyle({type:"indel",method:"missense_variant"},null,d);d=new A;d.glyph="TRIANGLE";d.DIRECTION="N";d.BUMP="yes";d.LABEL="no";d.BGCOLOR="#888888";d.FGCOLOR="red";b.pushStyle({type:"indel",method:"splice_.+_variant"},null,d);d=new A;d.glyph="STAR";d.POINTS=6;d.BUMP="yes";d.LABEL="no";d.BGCOLOR="#888888";d.FGCOLOR="red";b.pushStyle({type:"indel",method:"regulatory_region_variant"},null,d);d=new A;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.BGCOLOR="#888888";d.FGCOLOR=
"red";d.STROKECOLOR="black";b.pushStyle({type:"indel"},null,d);d=new A;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="orange";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;b.pushStyle({type:"default"},null,d);return f(b)};m.prototype.getScales=function(){return[]};m.prototype.fetch=function(f,b,d,c,h,C,l){var q=this;b=this.base+"/overlap/region/"+this.species+"/"+f+":"+b+"-"+d;d=[];for(c=0;c<this.type.length;++c)d.push("feature="+this.type[c]);d.push("content-type=application/json");b=b+"?"+d.join(";");
var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4==g.readyState)if(q.busy--,q.notifyActivity(),300<=g.status){var b="Error code "+g.status;try{var a=JSON.parse(g.response);a.error&&(b=a.error)}catch(E){}l(b,null)}else{b=JSON.parse(g.response);a=[];for(var e=0;e<b.length;++e){var d=b[e],c=[],h=new w;h.segment=f;h.min=d.start|0;h.max=d.end|0;h.type=d.feature_type||"unknown";h.id=d.ID;if(d.Parent){var n=new B;n.id=d.Parent;h.groups=[n]}d.strand&&(0>d.strand?h.orientation="-":0<d.strand&&
(h.orientation="+"));d.consequence_type&&(h.method=d.consequence_type);d.alt_alleles&&(c.push("Alleles="+d.alt_alleles.join("/")),1<d.alt_alleles.length&&(d.alt_alleles[1].length!=d.alt_alleles[0].length||"-"==d.alt_alleles[1])&&(h.type="indel"));0<c.length&&(h.notes=c);a.push(h)}l(null,a)}};q.busy++;q.notifyActivity();g.open("GET",b,!0);g.responseType="text";g.send("")};k("ensembl",function(f){return{features:new m(f)}})},{"./das":10,"./sourceadapters":35}],14:[function(c,v,u){if("undefined"!==typeof c){var m=
c("./cbrowser").Browser;var k=c("./utils").shallowCopy;var h=c("./sha1").hex_sha1;var r=c("./das").copyStylesheet}m.prototype.exportFullConfig=function(c){c={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+h(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(c.prefix=this.prefix);return c};m.prototype.exportChains=function(){var c={},h=this.chains||{},B;for(B in h)c[B]=h[B].exportConfig();return c};
m.prototype.exportSourceConfig=function(c){c=[];for(var h=0;h<this.tiers.length;++h){var B=this.tiers[h],f=k(B.dasSource);f.noPersist||(f.coords=void 0,f.props=void 0,f.disabled||(f.disabled=void 0),B.config.stylesheet?(f.style=r(B.config.stylesheet).styles,f.stylesheet_uri=void 0):f.style&&(f.style=r({styles:f.style}).styles),"string"===typeof B.config.name&&(f.name=B.config.name),void 0!==B.config.height&&(f.forceHeight=B.config.height),void 0!==B.config.forceMin&&(f.forceMin=B.config.forceMin),
B.config.forceMinDynamic&&(f.forceMinDynamic=B.config.forceMinDynamic),void 0!==B.config.forceMax&&(f.forceMax=B.config.forceMax),void 0!==B.config.bumped&&(f.bumped=B.config.bumped),B.config.forceMaxDynamic&&(f.forceMaxDynamic=B.config.forceMaxDynamic),c.push(f))}return c};m.prototype.exportPageTemplate=function(c){c=c||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+
JSON.stringify(this.exportFullConfig(c),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":34,"./utils":50}],15:[function(c,v,u){if("undefined"!==typeof c){var m=c("./cbrowser").Browser;var k=c("./glyphs").OverlayLabelCanvas;v=c("./numformats");var h=v.formatQuantLabel;var r=v.formatLongInt;var A=c("./version");var w=c("./sequence-draw").drawSeqTierGC;var B=c("./feature-draw").drawFeatureTier}m.prototype.exportImage=
function(f){f=f||{};var b=f.width||this.featurePanelWidth,d=0;if(f.banner||f.region)d=40;var c=this.featurePanelWidth,z=this.scale;this.featurePanelWidth=b;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);for(var C=d,l=0;l<this.tiers.length;++l){0<l&&(C+=3);var t=this.tiers[l];t.backupSubtiers=t.subtiers;t.backupOriginHaxx=t.originHaxx;t.backupLayoutHeight=t.layoutHeight;if(t.subtiers&&(B(t,t.sequenceSource?t.currentSequence:null),t.subtiers)){for(var g=t.padding,m=0;m<t.subtiers.length;++m)g=
g+t.subtiers[m].height+t.padding;g+=6;t.layoutHeight=Math.max(g,this.minTierHeight)}void 0!==t.layoutHeight&&(C+=t.layoutHeight)}t=f.resolutionMultiplier||1;l=(b+200)*t|0;m=C*t|0;C=makeElement("canvas",null,{width:l,height:m});g=C.getContext("2d");g.fillStyle="white";g.fillRect(0,0,l,m);g.scale(t,t);f.region&&(g.save(),g.fillStyle="black",g.font="12pt sans-serif",g.fillText(this.chr+":"+r(this.viewStart)+".."+r(this.viewEnd),300,28),g.restore());f.banner&&(g.save(),g.fillStyle="black",g.font="12pt sans-serif",
t="Graphics from Biodalliance "+A,g.fillText(t,200+b-100-g.measureText(t).width,28),g.restore());g.font="10px sans-serif";for(l=0;l<this.tiers.length;++l){t=this.tiers[l];var a=(t.glyphCacheOrigin-this.viewStart)*this.scale;m=new k;g.save();g.translate(0,d);g.save();g.beginPath();g.moveTo(200,0);g.lineTo(200+b,0);g.lineTo(200+b,t.layoutHeight);g.lineTo(200,t.layoutHeight);g.closePath();g.clip();g.translate(200,0);g.save();g.translate(a,0);t.subtiers?t.paintToContext(g,m,a+1E3):w(t,t.currentSequence,
g);g.restore();g.save();g.translate(a,0);m.draw(g,-a,b-a);g.restore();g.restore();m=!1;for(var e=0,p=t.subtiers||[],x=0;x<p.length;++x){var J=p[x];if(J.quant){m=!0;var n=J.quant;var E=J.height;var T=2;40<E&&(T=1+(E/20|0));E/=T-1;var U=(n.max-n.min)/(T-1);g.beginPath();g.moveTo(205,e);g.lineTo(200,e);g.lineTo(200,e+J.height);g.lineTo(205,e+J.height);for(var u=1;u<T-1;++u){var v=u*E;g.moveTo(200,e+v);g.lineTo(203,e+v)}g.strokeStyle="black";g.strokeWidth=2;g.stroke();g.fillStyle="black";u=h(n.max);var D=
e+7;g.fillText(u,197-g.measureText(u).width,D);u=h(n.min);D=e+J.height;g.fillText(u,197-g.measureText(u).width,D);for(u=1;u<T-1;++u)v=u*E,D=h(1*n.max-u*U),v=e+v+3,g.fillText(D,197-g.measureText(D).width,v)}e+=J.height+3}e="string"===typeof t.config.name?t.config.name:t.dasSource.name;p=g.measureText(e).width;g.fillStyle="black";g.fillText(e,200-(m?28:12)-p,(t.layoutHeight+3)/2);g.restore();d+=t.layoutHeight+3;t.subtiers=t.backupSubtiers;t.originHaxx=t.backupOriginHaxx;t.layoutHeight=t.backupLayoutHeight}if(f.highlights){g.save();
g.beginPath();g.moveTo(200,0);g.lineTo(200+b,0);g.lineTo(200+b,d);g.lineTo(200,d);g.closePath();g.clip();g.translate(200+a,0);b=a=this.viewStart;t=this.viewEnd;for(l=0;l<this.highlights.length;++l)E=this.highlights[l],(E.chr===this.chr||E.chr==="chr"+this.chr)&&E.min<t&&E.max>b&&(g.globalAlpha=this.defaultHighlightAlpha,g.fillStyle=this.defaultHighlightFill,g.fillRect((E.min-a)*this.scale,0,(E.max-E.min)*this.scale,d));g.restore()}a=-1;"center"==f.ruler?a=200+(this.viewEnd-this.viewStart+1)*this.scale/
2:"left"==f.ruler?a=200:"right"==f.ruler&&(a=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=a&&(g.strokeStyle="blue",g.beginPath(),g.moveTo(a,0),g.lineTo(a,d),g.stroke());this.featurePanelWidth=c;this.scale=z;return C.toDataURL("image/png")}},{"./cbrowser":6,"./feature-draw":18,"./glyphs":21,"./numformats":27,"./sequence-draw":32,"./version":52}],16:[function(c,v,u){if("undefined"!==typeof c){var m=c("./cbrowser").Browser;c=c("./utils");var k=c.makeElement;var h=c.removeChildren}m.prototype.openExportPanel=
function(){var c=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var m=k("div",null,{className:"export-form"}),w=k("select");w.appendChild(k("option","SVG",{value:"svg"}));w.appendChild(k("option","Image",{value:"png"}));w.appendChild(k("option","Dalliance config",{value:"config"}));w.appendChild(k("option","Dalliance sources",{value:"sources"}));w.appendChild(k("option","Dalliance page",{value:"page"}));w.value="svg";w.addEventListener("change",function(a){h(l);J()},
!1);m.appendChild(k("p",["Export as: ",w]));var B=k("input",null,{type:"checkbox",checked:this.exportHighlights});B.addEventListener("change",function(a){c.exportHighlights=B.checked;c.storeStatus()},!1);var f=k("input",null,{type:"checkbox",checked:this.exportRuler});f.addEventListener("change",function(a){c.exportRuler=f.checked;c.storeStatus()},!1);var b=k("input",null,{type:"checkbox",checked:this.exportRegion});b.addEventListener("change",function(a){c.exportRegion=b.checked;c.storeStatus()},
!1);var d=k("input",null,{type:"checkbox",checked:this.exportBanner});d.addEventListener("change",function(a){c.exportBanner=d.checked;c.storeStatus()},!1);var q=k("input",null,{type:"text",value:"1.0"}),z=k("input",null,{type:"text",value:"800"}),C=k("button","Export",{className:"btn btn-primary"});C.addEventListener("click",function(a){h(l);if("svg"===w.value){var b=URL.createObjectURL(c.makeSVG({highlights:B.checked,banner:c.exportBanner,region:c.exportRegion,ruler:f.checked?c.rulerLocation:"none",
width:parseInt(z.value)||800}));var e="SVG";var d="image/svg";var g="dalliance-view.svg"}else if("png"===w.value){d=parseFloat(q.value);if(.1>d||10<d){alert("bad scale "+d);return}b=c.exportImage({highlights:B.checked,banner:c.exportBanner,region:c.exportRegion,ruler:f.checked?c.rulerLocation:"none",resolutionMultiplier:d,width:parseInt(z.value)||800});e="Image";d="image/png";g="dalliance-view.png"}else"config"===w.value?(d=JSON.stringify(c.exportFullConfig(),null,2),e=new Blob([d],{type:"text/plain"}),
b=URL.createObjectURL(e),e="Configuration",d="text/plain",g="dalliance-config.json"):"sources"===w.value?(d=JSON.stringify(c.exportSourceConfig(),null,2),e=new Blob([d],{type:"text/plain"}),b=URL.createObjectURL(e),e="Source array",d="text/plain",g="dalliance-sources.json"):"page"===w.value&&(e=c.exportPageTemplate(),d="text/html",e=new Blob([e],{type:d}),b=URL.createObjectURL(e),e="Page template",g="dalliance-view.html");b&&(a=k("a","[Download]",{href:b,download:g,type:d}),d=k("a","[Preview in browser]",
{href:b,type:d,target:"_new"}),l.appendChild(k("p",[""+e+" created: ",a,d])))},!1);c.addViewListener(function(){h(l)});c.addTierListener(function(){h(l)});var l=k("p",""),t=k("tr",[k("th","Include highlights",{},{width:"400px",textAlign:"right"}),k("td",B)]),g=k("tr",[k("th","Include vertical guideline",{},{textAlign:"right"}),k("td",f)]),F=k("tr",[k("th","Scale multiplier",{},{textAlign:"right"}),k("td",q)]),a=k("tr",[k("th","Width (logical px)",{},{textAlign:"right"}),k("td",z)]),e=k("tr",[k("th",
"Label with genomic coordinates",{},{textAlign:"right"}),k("td",b)]),p=k("tr",[k("th","Include banner",{},{textAlign:"right"}),k("td",d)]),x=k("table",[t,g,a,F,e],null,{width:"500px"}),J=function(){var b=w.value;t.style.display="svg"==b||"png"==b?"table-row":"none";g.style.display="svg"==b||"png"==b?"table-row":"none";F.style.display="png"==b?"table-row":"none";a.style.display="svg"==b||"png"==b?"table-row":"none";e.style.display="svg"==b||"png"==b?"table-row":"none";p.style.display="svg"==b||"png"==
b?"table-row":"none"};J();m.appendChild(x);m.appendChild(C);m.appendChild(l);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(m,this.svgHolder);this.activeToolPanel=m;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":50}],17:[function(c,v,u){v=c("./cbrowser");u=c("./chainset");var m=c("./sourceadapters"),k=c("./utils"),h=c("./das");c=c("./sourcecompare");window.Browser=v.Browser;window.sourcesAreEqual=c.sourcesAreEqual;window.Chainset=u.Chainset;window.makeElement=k.makeElement;
window.dalliance_registerSourceAdapterFactory=m.registerSourceAdapterFactory;window.dalliance_registerParserFactory=m.registerParserFactory;window.dalliance_makeParser=m.makeParser;window.DASSequence=h.DASSequence;window.DASFeature=h.DASFeature;window.DASGroup=h.DASGroup;window.DASStylesheet=h.DASStylesheet;window.DASStyle=h.DASStyle;window.DASSource=h.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":35,"./sourcecompare":36,"./utils":50}],18:[function(c,v,u){function m(){this.glyphs=
[];this.height=0;this.quant=null}function k(e){var d,g;Date.now();ea=e.viewport.getContext("2d");b(e);e.padding="number"===typeof e.dasSource.padding?e.dasSource.padding:3;var c=[],y={},n={};for(x in e.ungroupedFeatures){var l=e.ungroupedFeatures[x];for(var q=0;q<l.length;++q){var p=l[q];!p.parts&&(g=e.styleForFeature(p))&&("LINEPLOT"==g.glyph?(f(y,g.id,p),n[g.id]=g):(d=r(p,0,g,e))&&c.push(d))}}for(z in y)l=y[z],g=n[z],"LINEPLOT"==g.glyph&&c.push(A(l,g,e));if(e.dasSource.collapseSuperGroups&&!e.bumped)for(J in e.superGroups){g=
e.superGroups[J];e.groups[J]=B(e.groups[J]);e.groups[J].isSuperGroup=!0;y={};var x=1E10;var z=-1E10;q=null;for(d=0;d<g.length;++d)if(l=e.groupedFeatures[g[d]]){for(n=0;n<l.length;++n)p=l[n],f(y,p.type,p),x=Math.min(p.min,x),z=Math.max(p.max,z),p.segment&&!q&&(q=p.segment);if(e.groups[J]&&!e.groups[J].links||0==e.groups[J].links.length)e.groups[J].links=e.groups[g[0]].links;delete e.groupedFeatures[g[d]]}e.groups[J].max=z;e.groups[J].min=x;e.groups[J].segment=q;for(var t in y){z=y[t];x=z[0];l=null;
for(n=0;n<z.length;++n)p=z[n],p=new N(p.min,p.max),l=l?Q(l,p):p;l=l.ranges();for(q=0;q<l.length;++q){var C=l[q],k=((C.max()|0)-(C.min()|0)+1)*g.length,E=0;for(n=0;n<z.length;++n)if(p=z[n],(p.min|0)<=C.max()&&(p.max|0)>=C.min()){var w=Math.max(p.min|0,C.min());p=Math.min(p.max|0,C.max());E+=p-w+1}p=new O;for(var F in x)p[F]=x[F];p.min=C.min();p.max=C.max();p.label&&1<g.length&&(p.label+=" ("+g.length+" vars)");p.visualWeight=1*E/k;f(e.groupedFeatures,J,p)}}delete e.superGroups[J]}F=[];for(H in e.groupedFeatures)F.push(H);
F.sort(function(a,b){a=e.groupedFeatures[a][0].score-e.groupedFeatures[b][0].score;return 0<a?-1:0==a?0:1});t={};for(g=0;g<F.length;++g){var H=F[g];if(d=h(e.groupedFeatures[H],0,e.groups[H],e,e.dasSource.collapseSuperGroups&&!e.bumped?"collapsed_gene":"tent"))d.group=e.groups[H],t[H]=d}for(J in e.superGroups){g=e.superGroups[J];F=[];x=1E10;z=-1E10;for(p=0;p<g.length;++p)H=t[g[p]],t[g[p]]=null,H&&(F.push(H),x=Math.min(x,H.min()),z=Math.max(z,H.max()));for(p=0;p<F.length;++p)H=F[p],c.push(new a(H,x,
z))}for(d in t)(H=t[d])&&c.push(H);H=new m;t=[];F=e.subtierMax||e.dasSource.subtierMax||e.browser.defaultSubtierMax;g=!1;p=0;a:for(;p<c.length;++p)if(d=c[p],d.bump&&(e.bumped||e.dasSource.collapseSuperGroups)){for(y=0;y<t.length;++y){var J=t[y];if(J.hasSpaceFor(d)){J.add(d);continue a}}t.length>=F?g=!0:(J=new m,J.add(d),t.push(J))}else H.add(d);0<H.glyphs.length&&(t=[H].concat(t));for(y=0;y<t.length;++y)J=t[y],J.quant&&J.glyphs.unshift(new I(J.height));for(y=0;y<t.length;++y)J=t[y],J.glyphs.sort(function(a,
b){return(a.zindex||0)-(b.zindex||0)});e.subtiers=t;e.glyphCacheOrigin=e.browser.viewStart;g?e.updateStatus("Bumping limit exceeded, use the track editor to see more features"):e.updateStatus()}function h(a,b,e,d,g){g=d.styleForFeature(e);var f=!1,c=[];b=null;for(var y=0;y<a.length;++y){var n=a[y];n.orientation&&null==b&&(b=n.orientation);if(!l&&n.label)var l=n.label;var p=d.styleForFeature(n);p&&!n.parts&&(Z(p.LABEL)&&(f=!0),(n=r(n,0,p,d,null,!0))&&c.push(n))}if(0==c.length)return null;a="flat";
g&&"LINE"===g.glyph||(d.dasSource.collapseSuperGroups&&!d.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-"));d=null;if(l&&f||g&&(Z(g.LABEL)||Z(g.LABELS)))d=e.label||l;e=new q(c,a);d&&("+"===b?d=">"+d:"-"===b&&(d="<"+d),e=new C(ea,e,d,!1));e.bump=!0;return e}function r(b,f,c,y,h,z){function B(a,b,e){var d=null;if(a.currentSequence){var g=a.currentSequence.start|0,f=a.currentSequence.end|0;if(g<=e&&f>=b){var c=Math.max(b,g);f=Math.min(e,f);for(d=a.currentSequence.seq.substr(c-
g,f-c+1);b<c;)d="N"+d,c--;for(;e>f;)d+="N",f++}}return d}var k=y.browser.scale;var m=y.browser.viewStart;var w=c.glyph||"BOX";var K=b.min;var r=b.max;var A=b.orientation;var u=b.score;var N=b.label||b.id,v=(K-m)*k,Q=Math.max((r-m+1)*k,v+1);var O=y.forceHeight||c.HEIGHT||h||12;var I=O*=1;m=c.BUMP&&Z(c.BUMP);if("CROSS"===w||"EX"===w||"TRIANGLE"===w||"DOT"===w||"SQUARE"===w||"STAR"===w||"PLIMSOLL"===w){var R=c.FGCOLOR||"black";var L=c.BGCOLOR||"none";K=c.STROKECOLOR;c.BGITEM&&b.itemRgb?R=b.itemRgb:Z(c.COLOR_BY_SCORE2)&&
(k=c.BGGRAD||c._gradient,k||(k=H(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=k),O=b.score2,void 0==O&&R||(I=c.MIN2?1*c.MIN2:0,r=(1*(O||0)-I)/((c.MAX2?1*c.MAX2:1)-I)*k.length|0,0>r&&(r=0),r>=k.length&&(r=k.length-1),R=k[r]));O=y.forceHeight||c.HEIGHT||h||12;I=O*=1;r=c.SIZE||O;c.RSIZE&&(r=1*c.RSIZE*O);c.STROKETHRESHOLD&&r<1*c.STROKETHRESHOLD&&(K=null);r*=1;O=(v+Q)/2;k=r/2;"EX"===w?K=new t(O,r,R):"TRIANGLE"===w?K=new g(O,r,c.DIRECTION||"N",c.LINEWIDTH||r,R,K):"DOT"===w?K=new F(O,r,R,K):"PLIMSOLL"===w?
K=new P(O,r,.2*r,R,K):"SQUARE"===w?K=new d(O-k,0,r,r,R,K):"STAR"===w?(w=5,c.POINTS&&(w=c.POINTS|0),K=new G(O,k,w,R,K)):K=new l(O,r,R);L&&"none"!=L&&5<Q-v&&(v=new d(v,0,Q-v,r,L),K=new q([v,K]));if(Z(c.SCATTER)){L=y.quantMin(c);(r=y.quantMax(c))||(r=0>L?0:10);L||(L=0);y=(1*u-L)/(r-L);u=-1*L/(r-L);if(0>y||1<y)return null;y>=u?(O=Math.max(1,(y-u)*I),f=f+(1-u)*I-O):(console.log("relScore="+y+"; origin="+u),f=f+(1-u)*I-(y-u)*I);var ha={min:L,max:r};v=0;Q="undefined"!==typeof b.forceLabel?b.forceLabel:c.LABEL;
Y(Q)&&N&&!z&&(K=new C(ea,K,N,!0,null,"above"==Q?"above":"below"),"above"==Q&&(v=K.textHeight+2),z=!0);K=new W(K,0,f-k-v,I)}}else if("HISTOGRAM"===w||"GRADIENT"===w&&"undefined"!==u)L=y.quantMin(c),(r=y.quantMax(c))||(r=0>L?0:10),L||(L=0),1*u<1*L&&(u=L),1*u>1*r&&(u=r),y=(1*u-L)/(r-L),u=-1*L/(r-L),"HISTOGRAM"===w&&(y>=u?(O=(y-Math.max(0,u))*I,f=f+(1-Math.max(0,u))*I-O):(O=(Math.max(0,u)-y)*I,f+=(1-Math.max(0,u))*I),ha={min:L,max:r}),R=c.FGCOLOR||null,L=c.BGCOLOR||c.COLOR1||"green",c.BGITEM&&b.itemRgb&&
(L=b.itemRgb),u=c.ALPHA?1*c.ALPHA:null,c.BGGRAD&&(k=c.BGGRAD,r=y*k.length|0,0>r&&(r=0),r>=k.length&&(r=k.length-1),L=k[r]),c.COLOR2&&(k=c._gradient,k||(k=H(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=k),r=y*k.length|0,0>r&&(r=0),r>=k.length&&(r=k.length-1),L=k[r]),K=new d(v,f,Q-v,O,L,R,u),K=new W(K,0,0,I);else if("HIDDEN"===w)K=new a(null,v,Q),z=!0;else if("ARROW"===w)y=c.FGCOLOR||"purple",f=Z(c.PARALLEL),I=Z(c.SOUTHWEST),L=Z(c.NORTHEAST),K=new n(v,Q,O,y,f,I,L);else if("ANCHORED_ARROW"===w)R=c.FGCOLOR||
"none",L=c.BGCOLOR||"green",K=new e(v,Q,O,L,R,A),K.bump=!0;else if("SPAN"===w)R=c.FGCOLOR||"black",K=new p(v,Q,O,R);else if("LINE"===w)R=c.FGCOLOR||"black",K=new x(v,Q,O,c.STYLE||"solid",A,R);else if("PRIMERS"===w)R=c.FGCOLOR||"black",L=c.BGCOLOR||"red",K=new J(v,Q,O,L,R);else if("TEXT"===w)y=c.STRING||"text",L=c.FGCOLOR||"black",K=new T(ea,v,Q,O,L,y);else if("TOOMANY"===w)R=c.FGCOLOR||"gray",L=c.BGCOLOR||"orange",K=new E(v,Q,O,L,R);else if("POINT"===w)O=y.forceHeight||c.HEIGHT||30,L=y.quantMin(c),
r=y.quantMax(c),y=(1*u-L)/(r-L),f=1*O/(r-L)*(u-1*L)|0,ha={min:L,max:r},L=c.FGCOLOR||c.COLOR1||"black",c.COLOR2&&(k=c._gradient,k||(k=H(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=k),r=y*k.length|0,0>r&&(r=0),r>=k.length&&(r=k.length-1),L=k[r]),K=new D((v+Q)/2,O-f,O,L);else if("__SEQUENCE"===w){L=R=b.seq;u=h=b.quals;f=Z(c.__INSERTIONS);I=[];if(b.cigar){A=na(b.cigar);u=L="";for(var ba=0,fa=0;fa<A.length;++fa){var X=A[fa];if("M"==X.op)L+=R.substr(ba,X.cnt),u+=h.substr(ba,X.cnt),ba+=X.cnt;else if("D"==
X.op)for(w=0;w<X.cnt;++w)L+="-",u+="Z";else if("I"==X.op){var aa=R.substr(ba,X.cnt);w=new g(v+L.length*k,5,"S",5,y.browser.baseColors.I);f&&(w=new C(ea,w,aa,!1,"center","above","7px sans-serif"));w.feature={label:"Insertion: "+aa,type:"insertion",method:"insertion"};I.push(w);ba+=X.cnt}else"S"==X.op?ba+=X.cnt:console.log("unknown cigop"+X.op)}}k=B(y,K,r);if(L&&k&&("mismatch"===c.__SEQCOLOR||"mismatch-all"===c.__SEQCOLOR)){K=[];r="-"===b.orientation?",":".";for(R=0;R<L.length;++R)K.push(L[R]==k[R]?
r:L[R]);L=K.join("")}K="-"===b.orientation?c._minusColor||"lightskyblue":c._plusColor||"lightsalmon";c.__disableQuals&&(u=!1);K=new U(y.browser.baseColors,K,v,Q,O,L,k,c.__SEQCOLOR,u,!Z(c.__CLEARBG));f&&(K=new W(K,0,7));0<I.length&&(I.splice(0,0,K),K=new q(I))}else if("__INSERTION"===w)w=new g(v,5,"S",5,y.browser.baseColors.I),K=new C(ea,w,b.insertion||b.altAlleles[0],!1,"center","above","7px sans-serif"),1<Q-v&&(L=c.BGCOLOR||c.COLOR1||"green",v=new d(v,5,Q-v,O,L,R),K=new q([v,K]));else{if("__NONE"===
w)return null;R=c.FGCOLOR||null;L=c.BGCOLOR||c.COLOR1||"green";c.BGITEM&&b.itemRgb&&(L=b.itemRgb);k=(Q-v)/(r-K);"translation"==b.type&&("protein_coding"==b.method||b.readframeExplicit)&&(!b.tags||0>b.tags.indexOf("cds_start_NF")||b.readframeExplicit)&&(!y.dasSource.collapseSuperGroups||y.bumped)&&.5<=k?(k=B(y,K,r),K=new S(v,Q,O,L,k,b.orientation,b.readframe)):K=new d(v,0,Q-v,O,L,R)}(Z(c.LABEL)||b.forceLabel)&&N&&!z&&(K=new C(ea,K,N,!1));m&&(K.bump=!0);K.feature=b;ha&&(K.quant=ha);c.ZINDEX&&(K.zindex=
c.ZINDEX|0);return K}function A(a,b,e){var d=e.browser.viewStart,g=e.browser.scale,f=e.forceHeight||b.HEIGHT||30,c=e.quantMin(b);e=e.quantMax(b);for(var y=1*f/(e-c),n=b.FGCOLOR||b.COLOR1||"black",l=[],p=0;p<a.length;++p){var q=a[p],h=f-((q.score-1*c)*y|0);l.push((((q.min|0)+(q.max|0))/2-d)*g);l.push(h)}a=new z(l,n,f);a.quant={min:c,max:e};b.ZINDEX&&(a.zindex=b.ZINDEX|0);return a}if("undefined"!==typeof c){var w=c("./utils");var B=w.shallowCopy;var f=w.pusho;w=c("./tier").DasTier;var b=c("./features").sortFeatures;
u=c("./glyphs");var d=u.BoxGlyph;var q=u.GroupGlyph;var z=u.LineGraphGlyph;var C=u.LabelledGlyph;var l=u.CrossGlyph;var t=u.ExGlyph;var g=u.TriangleGlyph;var F=u.DotGlyph;var a=u.PaddedGlyph;var e=u.AArrowGlyph;var p=u.SpanGlyph;var x=u.LineGlyph;var J=u.PrimersGlyph;var n=u.ArrowGlyph;var E=u.TooManyGlyph;var T=u.TextGlyph;var U=u.SequenceGlyph;var S=u.AminoAcidGlyph;var W=u.TranslatedGlyph;var D=u.PointGlyph;var I=u.GridGlyph;var G=u.StarGlyph;var P=u.PlimsollGlyph;var y=u.OverlayLabelCanvas;var H=
c("./color").makeGradient;u=c("./spans");var N=u.Range;var Q=u.union;u=c("./das");var O=u.DASFeature;var Z=u.isDasBooleanTrue;var Y=u.isDasBooleanNotFalse;var na=c("./cigar").parseCigar;var aa=c("./numformats").formatQuantLabel}m.prototype.indexFor=function(a){a=a.min();for(var b=0,e=this.glyphs.length;e>b;){var d=(b+e)/2|0;if(d>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[d].min()?e=d:b=d+1}return e};m.prototype.add=function(a){var b=this.indexFor(a);this.glyphs.splice(b,0,a);this.height=
Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};m.prototype.hasSpaceFor=function(a){var b=this.indexFor(a);return 0<b&&this.glyphs[b-1].max()>=a.min()||b<this.glyphs.length&&this.glyphs[b].min()<=a.max()?!1:!0};var ea;w.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,b=this.subtiers;if(b){var e=this.browser.featurePanelWidth+2E3;a&&(e*=2);var d=this.viewport.width|0;d<e-50&&(this.viewport.width=d=e);e=this.padding;for(var g=0;g<b.length;++g)e=
e+b[g].height+this.padding;g=e=Math.max(e+6,this.browser.minTierHeight);a&&(g*=2);g!=this.viewport.height&&(this.viewport.height=g);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+d/2+"px":""+d+"px";this.viewport.style.height=""+e+"px";this.layoutHeight=Math.max(e,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;b=this.viewport.getContext("2d");b.clearRect(0,0,d,g);b.save();a&&b.scale(2,2);d=this.browser.viewStart-1E3/this.browser.scale;g=
this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var f=this.knownCoverage.ranges(),c=0;c<f.length;++c){var n=f[c];0==c?n.min()>d&&a.push({min:d,max:n.min()-1}):a.push({min:f[c-1].max()+1,max:n.min()-1});c==f.length-1&&n.max()<g&&a.push({min:n.max()+1,max:g})}if(0<a.length)for(b.fillStyle="gray",d=0;d<a.length;++d)g=a[d],f=(g.min-this.browser.viewStart)*this.browser.scale+1E3,b.fillRect(f,0,(g.max-this.browser.viewStart)*this.browser.scale+1E3-f,e);e=new y;a=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale+1E3;b.translate(a,this.padding);e.translate(0,this.padding);this.paintToContext(b,e,a);this.overlayLabelCanvas=0<e.glyphs.length?e:null;b.restore();this.drawOverlay();this.paintQuant()}};w.prototype.paintToContext=function(a,b,e){var d=this.subtiers,g=this.viewport.width|0;a.save();for(var f=0;f<d.length;++f){var c=null;for(var y=d[f].glyphs,n=0;n<y.length;++n){var l=y[n];l.min()<g-e&&l.max()>-e&&(l=y[n],l.draw(a,b),l.quant&&(c=l.quant))}c&&0>c.min&&0<c.max&&
this.dasSource.zeroLine&&(l=c.max/(c.max-c.min)*d[0].height,a.save(),a.strokeStyle=this.dasSource.zeroLine,a.lineWidth=.5,a.beginPath(),a.moveTo(-1E3,l),a.lineTo(g+1E3,l),a.stroke(),a.restore());a.translate(0,d[f].height+this.padding);b.translate(0,d[f].height+this.padding)}a.restore();c&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(l=d[0].height*(1-(this.quantLeapThreshold-c.min)/(c.max-c.min)),a.save(),a.strokeStyle="red",a.lineWidth=
.3,a.beginPath(),a.moveTo(-1E3,l),a.lineTo(g+1E3,l),a.stroke(),a.restore())};w.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio;if(this.subtiers&&0<this.subtiers.length)var b=this.subtiers[0].quant;if(b){var e=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";
this.quantOverlay.style.display="block";var d=this.quantOverlay.getContext("2d");a&&d.scale(2,2);var g=2;40<e&&(g=1+(e/20|0));var f=(e+2*this.padding)/(g-1),c=(b.max-b.min)/(g-1);d.fillStyle="white";d.globalAlpha=.6;"right"==this.browser.rulerLocation?d.fillRect(20,0,30,e+2*this.padding):d.fillRect(0,0,30,e+2*this.padding);d.globalAlpha=1;d.strokeStyle="black";d.lineWidth=1;d.beginPath();if("right"==this.browser.rulerLocation){d.moveTo(42,this.padding);d.lineTo(50,this.padding);d.lineTo(50,e+this.padding);
d.lineTo(42,e+this.padding);for(var y=1;y<g-1;++y)a=y*f,d.moveTo(50,a),d.lineTo(45,a)}else for(d.moveTo(8,this.padding),d.lineTo(0,this.padding),d.lineTo(0,e+this.padding),d.lineTo(8,e+this.padding),y=1;y<g-1;++y)a=y*f,d.moveTo(0,a),d.lineTo(5,a);d.stroke();d.fillStyle="black";if("right"==this.browser.rulerLocation)for(d.textAlign="right",d.fillText(aa(b.max),41,8),d.fillText(aa(b.min),41,e+this.padding),y=1;y<g-1;++y)a=y*f,d.fillText(aa(1*b.max-y*c),41,a+3);else for(d.textAlign="left",d.fillText(aa(b.max),
9,8),d.fillText(aa(b.min),9,e+this.padding),y=1;y<g-1;++y)a=y*f,d.fillText(aa(1*b.max-y*c),9,a+3)}else this.quantOverlay.style.display="none"}};w.prototype.styleForFeature=function(a){var b=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var e=null,d=this.stylesheet.styles,g=0;g<d.length;++g){var f=d[g];if(!f.zoom||f.zoom==b)if(!f.orientation||f.orientation==a.orientation){var c=f._labelRE;c&&c.test||(c=new RegExp("^"+f.label+"$"),f._labelRE=c);if(!f.label||c.test(a.label))if(c=
f._methodRE,c&&c.test||(c=new RegExp("^"+f.method+"$"),f._methodRE=c),!f.method||c.test(a.method)){if(f.type)if("default"==f.type){e||(e=f.style);continue}else if(c=f._typeRE,c&&c.test||(c=new RegExp("^"+f.type+"$"),f._typeRE=c),!c.test(a.type))continue;return f.style}}}return e};w.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};w.prototype.quantMax=function(a){return this.forceMaxDynamic?
this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof v&&(v.exports={drawFeatureTier:k})},{"./cigar":8,"./color":9,"./das":10,"./features":20,"./glyphs":21,"./numformats":27,"./spans":37,"./tier":46,"./utils":50}],19:[function(c,v,u){function m(c,f,b){var d=r(b.type,f.type),q=r(b.label,f.label,b.id,f.id);q&&0!=q.indexOf("__dazzle")&&(d=d+": "+q);this.hit=c;this.feature=f;this.group=b;this.title=c[0].molgenis?f.id:
d;this.sections=[]}function k(c,f){var b=[];if(c)for(var d=0;d<c.length;++d)A(b,c[d]);if(f)for(d=0;d<f.length;++d)A(b,f[d]);return b}if("undefined"!==typeof c){var h=c("./cbrowser").Browser;c=c("./utils");var r=c.pick;var A=c.pushnew;var w=c.makeElement}h.prototype.addFeatureInfoPlugin=function(c){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(c)};m.prototype.setTitle=function(c){this.title=c};m.prototype.add=function(c,f){"string"===typeof f&&(f=w("span",f));this.sections.push({label:c,
info:f})};h.prototype.featurePopup=function(c,f,b,d){var q=b.length;f=0<=--q?b[q]:{};var h=0<=--q?b[q]:{};q=new m(b,f,h);q.tier=d;for(var C=this.featureInfoPlugins||[],l=0;l<C.length;++l)try{C[l](f,q)}catch(a){console.log(a.stack||a)}C=d.featureInfoPlugins||[];for(l=0;l<C.length;++l)try{C[l](f,q)}catch(a){console.log(a.stack||a)}this.removeAllPopups();C=w("table",null,{className:"table table-striped table-condensed"});C.style.width="100%";C.style.margin="0px";l=0;if(f.method&&!d.dasSource.suppressMethod){var t=
w("tr",[w("th","Method"),w("td",f.method)]);C.appendChild(t);++l}t=h.segment?h:f;t=w("tr",[w("th","Location"),w("td",t.segment+":"+t.min+"-"+t.max,{},{minWidth:"200px"})]);C.appendChild(t);++l;void 0===f.score||null===f.score||"-"==f.score||f.suppressScore||d.dasSource.suppressScore||(t=w("tr",[w("th","Score"),w("td",""+f.score)]),C.appendChild(t),++l);(d=k(h.links,f.links))&&0<d.length&&(t=w("tr",[w("th","Links"),w("td",d.map(function(a){return w("div",w("a",a.desc,{href:a.uri,target:"_new"}))}))]),
C.appendChild(t),++l);d=k(h.notes,f.notes);for(h=0;h<d.length;++h){t="Note";var g=d[h];if(b[0].molgenis){var B=g.split("=");2===B.length&&(t=B[0],g=B[1])}t=w("tr",[w("th",t),w("td",g)]);C.appendChild(t);++l}for(l=0;l<q.sections.length;++l)d=q.sections[l],C.appendChild(w("tr",[w("th",d.label),w("td",d.info)]));if(b[0].molgenis&&f.actions)for(b={},l=0;l<f.actions.length;b={action:b.action},++l)b.action=f.actions[l],d=w("a",b.action.label),d.addEventListener("click",function(a){return function(b){eval(a.action.run)}}(b),
!1),C.appendChild(w("tr",[w("th",""),w("td",d)]));this.popit(c,q.title||"Feature",C,{width:450})}},{"./cbrowser":6,"./utils":50}],20:[function(c,v,u){function m(c){for(var m,w,B=c.browser.drawnStart,f=c.browser.drawnEnd,b={},d={},q={},z={},C={},l={},t={},g={},r=[],a,e,p,x=function(){p={};for(var a=0;a<c.currentFeatures.length;++a){var b=c.currentFeatures[a];b.id&&(p[b.id]=b)}},J=function(a){var b=[];if(a.parents)for(var e=0;e<a.parents.length;++e){var d=a.parents[e],g=p[d];g&&"SO:0000704"==g.typeCv&&
pushnew(b,d)}return b},n=0;n<c.currentFeatures.length;++n){var E=c.currentFeatures[n];if(!E.parts){var u=E.min<=f&&E.max>=B;if(E.min&&E.max){if(E.score&&"."!=E.score&&"-"!=E.score){var v=1*E.score;if(!a||v<a)a=v;if(!e||v>e)e=v}v=[];var S=null;if(E.groups)for(var W=0;W<E.groups.length;++W)if(w=E.groups[W],m=w.id,"gene"==w.type)S=m,l[m]=w;else if("translation"!=w.type){k(d,m,E);l[m]=w;v.push(m);w=z[m];if(!w||E.min<w)z[m]=E.min;w=C[m];if(!w||E.max>w)C[m]=E.max}if(E.parents)for(p||x(),W=0;W<E.parents.length;++W){var D=
E.parents[W],I=p[D];if(I){I.parts||(I.parts=[E]);h(d,D,I);k(d,D,E);l[D]||(l[D]={type:I.type,id:I.id,label:I.label||I.id});v.push(D);w=z[D];if(!w||E.min<w)z[D]=E.min;w=C[D];if(!w||E.max>w)C[D]=E.max;w=J(I);0<w.length&&(S=w[0],D=p[w[0]],l[w[0]]={type:D.type,id:D.id,label:D.label||D.id},c.dasSource.collapseSuperGroups||(c.dasSource.collapseSuperGroups=!0))}}if(0==v.length)u&&k(b,E.type,E);else if(S)for(w=0;w<v.length;++w)m=v[w],h(t,S,m),g[m]=S}else r.push(E)}}for(m in d)r=l[m],"number"!==typeof r.min&&
(r.min=z[m]),"number"!==typeof r.max&&(r.max=C[m]),C[m]>=B&&z[m]<=f&&(q[m]=d[m]);c.ungroupedFeatures=b;c.groupedFeatures=q;c.groups=l;c.superGroups=t;c.groupsToSupers=g;a&&(0<a?a=0:0>e&&(e=0),c.currentFeaturesMinScore=a,c.currentFeaturesMaxScore=e)}if("undefined"!==typeof c){c=c("./utils");var k=c.pusho;var h=c.pushnewo}"undefined"!==typeof v&&(v.exports={sortFeatures:m})},{"./utils":50}],21:[function(c,v,u){function m(a,b){this._stroke=a;this._fill=b}function k(a,b,e,d,g,f,c,n){this.x=a;this.y=b;
this._width=e;this._height=d;this.fill=g;this.stroke=f;this._alpha=c;this._radius=n||0}function h(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();b=[];for(var e=0;e<a.length;++e){var d=a[e];b.push(new W(d.min(),d.max()));this.h=Math.max(this.h,d.height())}this.coverage=S(b)}function r(a,b,e){this.points=a;this.color=b;this._height=e||50}function A(a,b,e,d,g,f,c){this.glyph=b;this.text=e;this.anchor=g||"left";this.align=f||"below";c&&(this.font=c);this.font&&(a.save(),a.font=this.font);e=
a.measureText(e);this.font&&a.restore();this.textLen=e.width;this.textHeight=5;this.bump=b.bump;this.measured=!d}function w(a,b,e){this._x=a;this._height=b;this._stroke=e}function B(a,b,e){this._x=a;this._height=b;this._stroke=e}function f(a,b,e,d,g,f){m.call(this,f,g);this._x=a;this._height=b;this._dir=e;this._width=d}function b(a,b,e,d){this._x=a;this._height=b;this._fill=e;this._stroke=d}function d(a,b,e){this.glyph=a;this._min=b;this._max=e;a&&(this.bump=a.bump)}function q(a,b,e,d,g,f){m.call(this,
g,d);this._min=a;this._max=b;this._height=e;this._ori=f}function z(a,b,e,d){m.call(this,d,null);this._min=a;this._max=b;this._height=e}function C(a,b,e,d,g,f){this._min=a;this._max=b;this._height=e;this._style=d;this._strand=g;this._stroke=f}function l(a,b,e,d,g){this._min=a;this._max=b;this._height=e;this._fill=d;this._stroke=g}function t(a,b,e,d,g,f,c){m.call(this,null,d);this._min=a;this._max=b;this._height=e;this._color=d;this._parallel=g;this._sw=f;this._ne=c}function g(a,b,e,d,g){this._min=
a;this._max=b;this._height=e;this._fill=d;this._stroke=g}function F(a,b,e,d,g,f){this._min=b;this._max=e;this._height=d;this._fill=g;this._string=f;this._textLen=a.measureText(f).width}function a(a,b,e){var d={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[e.toLowerCase()];e=d?[e,d]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":e[b%2]}function e(a){var b={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var e=
[],d=0;d<a.length;++d){var g=a.substr(d,1).toUpperCase();e.push(g in b?b[g]:"N")}return e.join("")}function p(a,b,e,d,g,f,c){this._min=a;this._max=b;this._height=e;this._fill=d;this._seq=g;this._orientation=f;this._readframe=c}function x(a,b,e,d){this.glyph=a;this._height=d;this._x=b;this._y=e}function J(a,b,e,d){this._x=a;this._y=b;this._height=e;this._fill=d}function n(a){this._height=a||50}function E(a,b,e,d,g){m.call(this,g,d);this._x=a;this._r=b;this._points=e}function T(a,b,e,d,g){this._x=a;
this._height=b;this._overhang=e;this._fill=d;this._stroke=g;this._hh=b/2}function U(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof c){u=c("./spans");var S=u.union;var W=u.Range;u=c("./utils");var D=u.makeElementNS;var I=u.AMINO_ACID_TRANSLATION;c=c("./svg-utils");var G=c.NS_SVG;var P=c.SVGPath}m.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};m.prototype.toSVG=function(){var a=
new P;this.drawPath(a);return D(G,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};m.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};k.prototype.draw=function(a){var b=this._radius;0<b?(a.beginPath(),a.moveTo(this.x+b,this.y),a.lineTo(this.x+this._width-b,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b),a.lineTo(this.x+this._width,this.y+this._height-b),a.arcTo(this.x+this._width,this.y+this._height,
this.x+this._width-b,this.y+this._height,b),a.lineTo(this.x+b,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b),a.lineTo(this.x,this.y+b),a.arcTo(this.x,this.y,this.x+b,this.y,b),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,
this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};k.prototype.toSVG=function(){var a=D(G,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};k.prototype.min=function(){return this.x};k.prototype.max=function(){return this.x+
this._width};k.prototype.height=function(){return this.y+this._height};h.prototype.drawConnectors=function(a){for(var b=this.coverage.ranges(),e=1;e<b.length;++e){var d=b[e],g=b[e-1];if(g&&d.min()>g.max()){g=g.max();d=d.min();var f=(g+d)/2;"hat+"===this.connector?(a.moveTo(g,this.h/2),a.lineTo(f,0),a.lineTo(d,this.h/2)):"hat-"===this.connector?(a.moveTo(g,this.h/2),a.lineTo(f,this.h),a.lineTo(d,this.h/2)):"collapsed+"===this.connector?(a.moveTo(g,this.h/2),a.lineTo(d,this.h/2),4<d-g&&(a.moveTo(f-
2,this.h/2-3),a.lineTo(f+2,this.h/2),a.lineTo(f-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(g,this.h/2),a.lineTo(d,this.h/2),4<d-g&&(a.moveTo(f+2,this.h/2-3),a.lineTo(f-2,this.h/2),a.lineTo(f+2,this.h/2+3))):(a.moveTo(g,this.h/2),a.lineTo(d,this.h/2))}}};h.prototype.draw=function(a,b){for(var e=0;e<this.glyphs.length;++e)this.glyphs[e].draw(a,b);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};h.prototype.toSVG=function(){for(var a=D(G,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());
b=new P;this.drawConnectors(b);0<b.toPathData().length&&(b=D(G,"path",null,{d:b.toPathData(),fill:"none",stroke:"black",strokeWidth:.5}),a.appendChild(b));return a};h.prototype.min=function(){return this.coverage.min()};h.prototype.max=function(){return this.coverage.max()};h.prototype.height=function(){return this.h};r.prototype.min=function(){return this.points[0]};r.prototype.max=function(){return this.points[this.points.length-2]};r.prototype.height=function(){return this._height};r.prototype.draw=
function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b+=2){var e=this.points[b],d=this.points[b+1];0==b?a.moveTo(e,d):a.lineTo(e,d)}a.stroke();a.restore()};r.prototype.toSVG=function(){for(var a=new P,b=0;b<this.points.length;b+=2){var e=this.points[b],d=this.points[b+1];0==b?a.moveTo(e,d):a.lineTo(e,d)}return D(G,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};A.prototype.toSVG=function(){var a=this.glyph.toSVG(),
b={};"above"==this.align?(a=D(G,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return D(G,"g",[a,D(G,"text",this.text,b)])};A.prototype.min=function(){return this.glyph.min()};A.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};A.prototype.height=
function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};A.prototype.draw=function(a,b){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();b.registerGlyph(this)};A.prototype.drawOverlay=function(a,b,e){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?e=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(e=this.glyph.min(),e<b&&(e=Math.min(b,this.glyph.max()-
this.textLen)));a.fillText(this.text,e,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};w.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};w.prototype.toSVG=function(){var a=this._height/2,b=new P;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return D(G,"path",
null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};w.prototype.min=function(){return this._x-this._height/2};w.prototype.max=function(){return this._x+this._height/2};w.prototype.height=function(){return this._height};B.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};B.prototype.toSVG=function(){var a=
this._height/2,b=new P;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return D(G,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};B.prototype.min=function(){return this._x-this._height/2};B.prototype.max=function(){return this._x+this._height/2};B.prototype.height=function(){return this._height};f.prototype=Object.create(m.prototype);f.prototype.drawPath=function(a){var b=this._height/2,e=this._width/
2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-e,0),a.lineTo(this._x+e,0)):"W"===this._dir?(a.moveTo(this._x+e,b),a.lineTo(this._x-e,0),a.lineTo(this._x-e,this._height)):"E"===this._dir?(a.moveTo(this._x-e,b),a.lineTo(this._x+e,0),a.lineTo(this._x+e,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+e,this._height),a.lineTo(this._x-e,this._height));a.closePath()};f.prototype.min=function(){return this._x-this._height/2};f.prototype.max=function(){return this._x+this._height/
2};f.prototype.height=function(){return this._height};b.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};b.prototype.toSVG=function(){var a=this._height/2;return D(G,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=
function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};d.prototype.draw=function(a,b){this.glyph&&this.glyph.draw(a,b)};d.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():D(G,"g")};d.prototype.min=function(){return this._min};d.prototype.max=function(){return this._max};d.prototype.height=function(){return this.glyph?this.glyph.height():1};q.prototype=Object.create(m.prototype);q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};
q.prototype.height=function(){return this._height};q.prototype.drawPath=function(a){var b=this._max,e=this._min,d=this._height,g=0,f=0,c=this._height+2,n=.333333*this._height;this._ori&&("+"===this._ori?f=.5*this._height:"-"===this._ori&&(g=.5*this._height));b-e<c&&(e=(b+e-c)/2,b=e+c);a.moveTo(e+g,0+n);a.lineTo(b-f,0+n);a.lineTo(b-f,0);a.lineTo(b,0+this._height/2);a.lineTo(b-f,0+d);a.lineTo(b-f,0+n+n);a.lineTo(e+g,0+n+n);a.lineTo(e+g,0+d);a.lineTo(e,0+d/2);a.lineTo(e+g,0);a.lineTo(e+g,0+n)};z.prototype=
Object.create(m.prototype);z.prototype.min=function(){return this._min};z.prototype.max=function(){return this._max};z.prototype.height=function(){return this._height};z.prototype.drawPath=function(a){var b=this._min,e=this._max,d=this._height,g=d/2;a.moveTo(b,g);a.lineTo(e,g);a.moveTo(b,0);a.lineTo(b,d);a.moveTo(e,0);a.lineTo(e,d)};C.prototype.min=function(){return this._min};C.prototype.max=function(){return this._max};C.prototype.height=function(){return this._height};C.prototype.drawPath=function(a){var b=
this._min,e=this._max,d=this._height,g=d/2;"hat"===this._style?(a.moveTo(b,g),a.lineTo((b+e)/2,"-"===this._strand?d:0)):a.moveTo(b,g);a.lineTo(e,g)};C.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};C.prototype.toSVG=function(){var a=new P;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return D(G,
"path",null,a)};l.prototype.min=function(){return this._min};l.prototype.max=function(){return this._max};l.prototype.height=function(){return this._height};l.prototype.drawStemPath=function(a){var b=this._max,e=this._height/2;a.moveTo(this._min,e);a.lineTo(b,e)};l.prototype.drawTrigsPath=function(a){var b=this._min,e=this._max,d=this._height,g=d/2;a.moveTo(b,0);a.lineTo(b+d,g);a.lineTo(b,d);a.lineTo(b,0);a.moveTo(e,0);a.lineTo(e-d,g);a.lineTo(e,d);a.lineTo(e,0)};l.prototype.draw=function(a){a.beginPath();
this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};l.prototype.toSVG=function(){var a=new P;this.drawStemPath(a);var b=new P;this.drawTrigsPath(b);return D(G,"g",[D(G,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),D(G,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};t.prototype=Object.create(m.prototype);t.prototype.min=function(){return this._min};t.prototype.max=function(){return this._max};t.prototype.height=
function(){return this._height};t.prototype.drawPath=function(a){var b=this._min,e=this._max,d=this._height;if(this._parallel){var g=d/2;var f=.4*d;this._sw?(a.moveTo(b+g,d-f),a.lineTo(b+g,d),a.lineTo(b,g),a.lineTo(b+g,0),a.lineTo(b+g,f)):(a.moveTo(b,d-f),a.lineTo(b,f));this._ne?(a.lineTo(e-g,f),a.lineTo(e-g,0),a.lineTo(e,g),a.lineTo(e-g,d),a.lineTo(e-g,d-f)):(a.lineTo(e,f),a.lineTo(e,d-f))}else{g=(b+e)/2;f=.4*(e-b);var c=d/3;this._ne?(a.moveTo(b+f,c),a.lineTo(b,c),a.lineTo(g,0),a.lineTo(e,c),a.lineTo(e-
f,c)):(a.moveTo(b+f,0),a.lineTo(e-f,0));this._sw?(a.lineTo(e-f,d-c),a.lineTo(e,d-c),a.lineTo(g,d),a.lineTo(b,d-c),a.lineTo(b+f,d-c)):(a.lineTo(e-f,d),a.lineTo(b+f,d))}a.closePath()};g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};g.prototype.height=function(){return this._height};g.prototype.toSVG=function(){return D(G,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};g.prototype.draw=
function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b+=3)a.moveTo(this._min,b),a.lineTo(this._max,b);a.stroke()}};F.prototype.min=function(){return this._min};F.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};F.prototype.height=function(){return this._height};F.prototype.draw=
function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};F.prototype.toSVG=function(){return D(G,"text",this._string,{x:this._min,y:this._height-4})};p.prototype.min=function(){return this._min};p.prototype.max=function(){return this._max};p.prototype.height=function(){return this._height};p.prototype.draw=function(b){var d=this._seq,g=this._fill;if(d){var f=(this._max-this._min+1)/d.length,c=(3-this._readframe)%3,n=(d.length-c)%3;c="+"==this._orientation?c:n;0<c&&(b.fillStyle=
g,b.fillRect(this._min,0,f*c,this._height));for(;c<d.length;c+=3){n=d.substr(c,3).toUpperCase();"-"==this._orientation&&(n=e(n));var l=n in I?I[n]:"?";g=3==n.length?a(l,c,this._fill):this._fill;b.fillStyle=g;b.fillRect(this._min+c*f,0,f*n.length,this._height);8<=f&&3==n.length&&(b.fillStyle="white",b.fillText(l,this._min+(c+1)*f,this._height))}}};p.prototype.toSVG=function(){var b=D(G,"g"),d=this._seq,g=this._fill;if(!d)return b;var f=(this._max-this._min+1)/d.length,c=(3-this._readframe)%3,n=(d.length-
c)%3;c="+"==this._orientation?c:n;for(0<c&&b.appendChild(D(G,"rect",null,{x:this._min,y:0,width:f*c,height:this._height,fill:g}));c<d.length;c+=3){n=d.substr(c,3).toUpperCase();"-"==this._orientation&&(n=e(n));var l=n in I?I[n]:"?";g=3==n.length?a(l,c,this._fill):this._fill;b.appendChild(D(G,"rect",null,{x:this._min+c*f,y:0,width:f*n.length,height:this._height,fill:g}));8<=f&&3==n.length&&b.appendChild(D(G,"text",l,{x:this._min+(c+1)*f,y:this._height,fill:"white"}))}return b};(function(a){function b(a,
b,e,d,g,f,c,n,l,p){this.baseColors=a;this._strandColor=b;this._min=e;this._max=d;this._height=g;this._seq=f;this._ref=c;this._scheme=n;this._quals=l;this._fillbg=p}var e=1<window.devicePixelRatio,d={},g=/^[ACGT-]$/;b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this._height};b.prototype.alphaForQual=function(a){return.1+.9*Math.max(0,Math.min(1*a/30,1))};b.prototype.draw=function(a){var b=this._seq,f=this._ref,c="mismatch-all"===
this._scheme,n=b?b.length:this._max-this._min+1,l=(this._max-this._min+1)/n;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=l||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var p=0;p<n;++p){var q=b?b.substr(p,1).toUpperCase():"N";if(g.test(q)||8<=l){var h=this.baseColors[q];if(this._quals){var x=this._quals.charCodeAt(p)-33;var z=a.globalAlpha;a.globalAlpha=this.alphaForQual(x)}h||(x=f?f.substr(p,1).toUpperCase():"N",h="N"==
q||"N"==x?"gray":this._strandColor,c&&(q=x));a.fillStyle=h;x=g.test(q);!this._fillbg&&8<=l&&x||a.fillRect(this._min+p*l,0,l,this._height);if(8<=l&&x){x=h+"_"+q;var t=d[x];if(!t){t=document.createElement("canvas");e?(t.width=16,t.height=20):(t.width=8,t.height=10);var k=t.getContext("2d");e&&k.scale(2,2);k.fillStyle=this._fillbg?"black":h;h=k.measureText(q).width;k.fillText(q,.5*(8-h),8);d[x]=t}e?a.drawImage(t,this._min+p*l+.5*(l-8),0,8,10):a.drawImage(t,this._min+p*l+.5*(l-8),0)}this._quals&&(a.globalAlpha=
z)}}};b.prototype.toSVG=function(){for(var a=this._seq,b=this._ref,e="mismatch-all"===this._scheme,d=(this._max-this._min+1)/this._seq.length,f=D(G,"g"),c=0;c<a.length;++c){var n=a?a.substr(c,1).toUpperCase():"N",l=this.baseColors[n];if(!l){var p=b?b.substr(c,1).toUpperCase():"N";l="N"==n||"N"==p?"gray":this._strandColor;e&&(n=p)}p=1;this._quals&&(p=this._quals.charCodeAt(c)-33,p=this.alphaForQual(p));var q=g.test(n);!this._fillbg&&8<=d&&q||f.appendChild(D(G,"rect",null,{x:this._min+c*d,y:0,width:d,
height:this._height,fill:l,fillOpacity:p}));8<=d&&q&&f.appendChild(D(G,"text",n,{x:this._min+(.5+c)*d,y:8,textAnchor:"middle",fill:this._fillbg?"black":l,fillOpacity:p}))}return f};a.SequenceGlyph=b})(this);x.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};x.prototype.min=function(){return this.glyph.min()+this._x};x.prototype.max=function(){return this.glyph.max()+this._x};x.prototype.minY=function(){return this._y};x.prototype.maxY=function(){return this._y+
this.glyph.height()};x.prototype.draw=function(a,b){a.save();a.translate(this._x,this._y);this.glyph.draw(a,b);a.restore()};x.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};J.prototype.min=function(){return this._x-2};J.prototype.max=function(){return this._x+2};J.prototype.height=function(){return this._height};J.prototype.draw=function(a){a.save();a.globalAlpha=.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,
1.5,0,6.29);a.fill();a.restore()};J.prototype.toSVG=function(){return D(G,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};n.prototype.notSelectable=!0;n.prototype.min=function(){return-1E5};n.prototype.max=function(){return 1E5};n.prototype.height=function(){return this._height};n.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=.1;a.beginPath();for(var b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);a.stroke();a.restore()};n.prototype.toSVG=
function(){for(var a=new P,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);return D(G,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};E.prototype=Object.create(m.prototype);E.prototype.min=function(){return this._x-this._r};E.prototype.max=function(){return this._x+this._r};E.prototype.height=function(){return 2*this._r};E.prototype.drawPath=function(a){for(var b=this._x,e=this._r,d=this._r,g=0;g<this._points;++g){var f=6.28*g/this._points,c=b+d*Math.sin(f);
f=e-d*Math.cos(f);0==g?a.moveTo(c,f):a.lineTo(c,f);f=6.28*(g+.5)/this._points;c=b+.4*d*Math.sin(f);f=e-.4*d*Math.cos(f);a.lineTo(c,f)}a.closePath()};T.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};T.prototype.toSVG=function(){var a=this._hh;return D(G,"g",[D(G,"circle",
null,{cx:this._x,cy:a,r:a-this._overhang}),D(G,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};T.prototype.min=function(){return this._x-this._hh};T.prototype.max=function(){return this._x+this._hh};T.prototype.height=function(){return this._height};U.prototype.translate=function(a,b){this.ox+=a;this.oy+=b};U.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};U.prototype.draw=function(a,
b,e){for(var d=0;d<this.glyphs.length;++d){var g=this.glyphs[d];a.save();a.translate(g.x,g.y);g.glyph.drawOverlay(a,b,e);a.restore()}};"undefined"!==typeof v&&(v.exports={BoxGlyph:k,GroupGlyph:h,LineGraphGlyph:r,LabelledGlyph:A,CrossGlyph:w,ExGlyph:B,TriangleGlyph:f,DotGlyph:b,PaddedGlyph:d,AArrowGlyph:q,SpanGlyph:z,LineGlyph:C,PrimersGlyph:l,ArrowGlyph:t,TooManyGlyph:g,TextGlyph:F,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:p,TranslatedGlyph:x,GridGlyph:n,StarGlyph:E,PointGlyph:J,PlimsollGlyph:T,
OverlayLabelCanvas:U})},{"./spans":37,"./svg-utils":40,"./utils":50}],22:[function(c,v,u){function m(c,k){this.base=c;this.query=k}if("undefined"!==typeof c)var k=c("./das").DASFeature;m.prototype.features=function(c,m,A){url=this.base+"/features/"+c.name;m=[];this.query&&m.push(this.query);c.isBounded&&(m.push("start="+c.start),m.push("end="+c.end));0<m.length&&(url=url+"?"+m.join("&"));var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==h.readyState)if(300<=h.status)A(null,"Error code "+
h.status);else{var m=JSON.parse(h.response).features,f=[];for(fi=0;fi<m.length;++fi){var b=m[fi],d=new k;d.segment=c.name;d.min=(b.start|0)+1;d.max=b.end|0;b.name&&(d.label=b.name);d.type=b.type||"unknown";f.push(d)}A(f)}};h.open("GET",url,!0);h.responseType="text";h.send("")};"undefined"!==typeof v&&(v.exports={JBrowseStore:m})},{"./das":10}],23:[function(c,v,u){function m(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new x(function(b,e){a.notifyRequestsIssued=b})}function k(a,
b,e,d,g,f,c){this.chr=a;this.min=b;this.max=e;this.coverage=c;this.scale=d;this.features=g||[];this.status=f}function h(a,b,e,d,g,f){this.tierMap=a;this.chr=b;this.min=e;this.max=d;this.scale=g;this.seqSource=f||new C;this.viewCount=0;this.featureCache={};this.latestViews={}}function r(a,b,e){for(var d,g=[],f={},c=0;c<a.length;++c)d=a[c],d.min&&d.max?d.groups&&0<d.groups.length?w(f,d.groups[0].id,d):d.min<=e&&d.max>=b&&g.push(d):g.push(d);for(var n in f){a=f[n];var l=1E11,p=-1E11;for(c=0;c<a.length;++c)d=
a[c],l=Math.min(l,d.min),p=Math.max(p,d.max);if(l<=e||p>=b)for(c=0;c<a.length;++c)g.push(a[c])}return g}if("undefined"!==typeof c){u=c("./utils");var A=u.Awaited;var w=u.pusho;u=c("./sourceadapters");var B=u.MappedFeatureSource;var f=u.CachingFeatureSource;var b=u.BWGFeatureSource;var d=u.RemoteBWGFeatureSource;var q=u.BAMFeatureSource;var z=u.RemoteBAMFeatureSource;var C=u.DummySequenceSource;var l=u.DummyFeatureSource;var t=c("./overlay").OverlayFeatureSource;u=c("./spans");var g=u.Range;var F=
u.intersection;u=c("./sample");var a=u.downsample;var e=u.getBaseCoverage;var p=c("./das").DASSequence;var x=c("es6-promise").Promise}m.prototype.addRequest=function(a){this.reqs.push(a)};m.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};k.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};h.prototype.cancel=function(){this.cancelled=!0};h.prototype.bestCacheOverlapping=function(a,b,e){return(a=this.featureCache[this.tierMap[0]])?
a:null};h.prototype.viewFeatures=function(a,b,e,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=e;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new m;this.awaitedSeq=new A;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};h.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};
h.prototype.startFetchesForTiers=function(a){for(var b=this,e=this.awaitedSeq,d=!1,g,f=0;f<a.length;++f)try{this.startFetchesFor(a[f],e)&&(d=!0)}catch(I){g=a[f],g.currentFeatures=[],g.currentSequence=null,g.draw(),g.updateHeight(),g.updateStatus(I),console.log("Error fetching tier source"),console.log(I),g=I}if(d&&!this.seqWasFetched){this.seqWasFetched=!0;var c=this.min,l=this.max;if(this.cs&&this.cs.start<=c&&this.cs.end>=l)return a=this.cs.start==c&&this.cs.end==l?this.cs:new p(this.cs.name,c,
l,this.cs.alphabet,this.cs.seq.substring(c-this.cs.start,l+1-this.cs.start)),e.provide(a);this.seqSource.fetch(this.chr,c,l,this.pool,function(a,d){if(d){if(!b.cs||c<=b.cs.start&&l>=b.cs.end||c>=b.cs.end||l<=b.cs.start||l-c>b.cs.end-b.cs.start)b.cs=d;e.provide(d)}else console.log("Sequence loading failed",a),e.provide(null)})}if(g)throw g;};h.prototype.startFetchesFor=function(a,b){var e=this,d=this.viewCount,f=a.getSource()||new l,c=a.needsSequence(this.scale),n=e.featureCache[a],p=a.getActiveStyleFilters(this.scale),
q;p&&(q=p.typeList());var h=this.chr,x=this.min,z=this.max;if(void 0===q)return!1;if(n&&n.chr===this.chr&&n.min<=x&&n.max>=z){var t=n.features;if(n.min<x||n.max>z)t=r(t,x,z);e.provision(a,n.chr,F(n.coverage,new g(x,z)),n.scale,q,t,n.status,c?b:null);t=f.getScales();if(n.scale<=this.scale||!t)return c}f.instrument&&console.log("Starting  fetch "+d+" ("+x+", "+z+")");f.fetch(h,x,z,this.scale,q,this.pool,function(l,p,t,C){f.instrument&&console.log("Finishing fetch "+d);var m=e.latestViews[a]||-1;if(!(e.cancelled||
m>d)){C||(C=new g(x,z));if(!n||x<n.min||z>n.max)e.featureCache[a]=new k(h,x,z,t,p,l,C);e.latestViews[a]=d;e.provision(a,h,C,t,q,p,l,c?b:null)}},p);return c};h.prototype.provision=function(g,c,l,p,h,x,k,C){k&&(g.currentFeatures=[],g.currentSequence=null,g.draw(),g.updateHeight());g.updateStatus(k);if(!k){for(var n=k=!1,m=g.getSource();B.prototype.isPrototypeOf(m)||f.prototype.isPrototypeOf(m)||t.prototype.isPrototypeOf(m);)m=t.prototype.isPrototypeOf(m)?m.sources[0]:m.source;if(b.prototype.isPrototypeOf(m)||
d.prototype.isPrototypeOf(m)||q.prototype.isPrototypeOf(m)||z.prototype.isPrototypeOf(m))k=!0;m.opts&&(m.opts.forceReduction||m.opts.noDownsample)||k&&h&&1==h.length&&0<=h.indexOf("density")&&(x=a(x,this.scale));h&&1==h.length&&0<=h.indexOf("base-coverage")&&(n=!0);C?C.await(function(a){n&&(x=e(x,a,g.browser.baseColors));g.viewFeatures(c,l,p,x,a)}):g.viewFeatures(c,l,p,x)}};"undefined"!==typeof v&&(v.exports={KnownSpace:h})},{"./das":10,"./overlay":28,"./sample":30,"./sourceadapters":35,"./spans":37,
"./utils":50,"es6-promise":54}],24:[function(c,v,u){function m(b,d){this.block=b;this.offset=d}function k(b,d){var f=4294967296*(b[d+6]&255)+16777216*(b[d+5]&255)+65536*(b[d+4]&255)+256*(b[d+3]&255)+(b[d+2]&255);b=b[d+1]<<8|b[d];return 0==f&&0==b?null:new m(f,b)}function h(b,d){d=Math.min(d||1,b.byteLength-50);for(var c=[],h=[0],k=0;h[0]<d;){var l=new Uint8Array(b,h[0],12);l=l[11]<<8|l[10];l=B(b,12+l+h[0],Math.min(65536,b.byteLength-12-l-h[0]),h);h[0]+=8;k+=l.byteLength;c.push(l)}if(1==c.length)return c[0];
b=new Uint8Array(k);for(h=d=0;h<c.length;++h)k=new Uint8Array(c[h]),f(k,0,b,d,k.length),d+=k.length;return b.buffer}function r(b,d){this.minv=b;this.maxv=d}function A(b,d){--d;return b>>14==d>>14?4681+(b>>14):b>>17==d>>17?585+(b>>17):b>>20==d>>20?73+(b>>20):b>>23==d>>23?9+(b>>23):b>>26==d>>26?1+(b>>26):0}function w(b,d){var f,c=[];--d;c.push(0);for(f=1+(b>>26);f<=1+(d>>26);++f)c.push(f);for(f=9+(b>>23);f<=9+(d>>23);++f)c.push(f);for(f=73+(b>>20);f<=73+(d>>20);++f)c.push(f);for(f=585+(b>>17);f<=585+
(d>>17);++f)c.push(f);for(f=4681+(b>>14);f<=4681+(d>>14);++f)c.push(f);return c}if("undefined"!==typeof c){c=c("jszlib");var B=c.inflateBuffer;var f=c.arrayCopy}m.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof v&&(v.exports={unbgzf:h,readVob:k,reg2bin:A,reg2bins:w,Chunk:r})},{jszlib:66}],25:[function(c,v,u){function m(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function k(f){this.source=f;A.call(this);this.storeHolder=new w;this.parser=r(f.payload);
if(!this.parser)throw"Unsupported memstore payload: "+f.payload;var b=this;this._load(function(d,f){if(d){f=new m;var c=[];d=d.split("\n");for(var h=b.parser.createSession(function(b){c.push(b)}),l=0;l<d.length;++l){var q=d[l];0<q.length&&h.parse(q)}h.flush();f.addFeatures(c);b.storeHolder.provide(f)}else b.error=f||"No data",b.storeHolder.provide(null)})}if("undefined"!==typeof c){v=c("./sourceadapters");var h=v.registerSourceAdapterFactory;var r=v.makeParser;var A=v.FeatureSourceBase;c("./das");
c=c("./utils");var w=c.Awaited;var B=c.textXHR}m.prototype.addFeatures=function(f){for(var b,d,c={},h=0;h<f.length;++h){var k=f[h];d=k.segment||k.chr;b=this.featuresByChr[d];b||(b=[],this.featuresByChr[d]=b);b.push(k);c[d]=!0;b=k.max-k.min+1;b>this.maxLength&&(this.maxLength=b)}for(d in c)b=this.featuresByChr[d],b.sort(function(b,d){var g=b.min-d.min;return 0!=g?g:b.max-d.max});this.chrRing=null};m.prototype._indexFor=function(f,b){for(var d=0,c=f.length;c>d;){var h=(d+c)/2|0;if(h>=f.length)return f.length;
b<f[h].min?c=h:d=h+1}return c};m.prototype.fetch=function(f,b,d){var c=this.featuresByChr[f];c||(c=0==f.indexOf("chr")?this.featuresByChr[f.substring(3)]:this.featuresByChr["chr"+f]);if(!c)return[];var h=Math.max(0,this._indexFor(c,b-this.maxLength-1));f=Math.min(c.length-1,this._indexFor(c,d));for(var k=[];h<=f;++h){var l=c[h];l.min<=d&&l.max>=b&&k.push(l)}return k};m.prototype.findNextFeature=function(f,b,d){if(null==this.chrRing){this.chrRing=[];for(f in this.featuresByChr)this.chrRing.push(f);
this.chrRing.sort()}var c=this.featuresByChr[f];c||(f=0==f.indexOf("chr")?f.substring(3):"chr"+f,c=this.featuresByChr[f]);if(!c)return null;var h=Math.max(0,Math.min(this._indexFor(c,b),c.length-1));if(0<d){for(;h<c.length;){var k=c[h++];if(k.min>b)return k}f=this.chrRing.indexOf(f)+1;f>=this.chrRing.length&&(f=0);return this.findNextFeature(this.chrRing[f],0,d)}for(;0<=h;)if(k=c[h--],k.max<b)return k;f=this.chrRing.indexOf(f)-1;0>f&&(f=this.chrRing.length-1);return this.findNextFeature(this.chrRing[f],
1E10,d)};k.prototype=Object.create(A.prototype);k.prototype._load=function(f){var b;if(this.source.blob){var d=new FileReader;d.onloadend=function(){return f(d.result,d.error)};d.readAsText(this.source.blob)}else this.source.credentials&&(b={credentials:this.source.credentials}),B(this.source.uri,f,b)};k.prototype.fetch=function(f,b,d,c,h,k,l){var q=this;this.storeHolder.await(function(g){return g?(g=g.fetch(f,b,d),l(null,g,1E8)):l(q.error)})};k.prototype.getStyleSheet=function(f){this.parser&&this.parser.getStyleSheet&&
this.parser.getStyleSheet(f)};k.prototype.getDefaultFIPs=function(f){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(f)};k.prototype.getScales=function(){return 1E8};k.prototype.findNextFeature=function(f,b,d,c){var h=this;this.storeHolder.await(function(q){return q?c(q.findNextFeature(f,b,d)):c(null,h.error)})};k.prototype.capabilities=function(){return{leap:!0}};h("memstore",function(f){return{features:new k(f)}})},{"./das":10,"./sourceadapters":35,"./utils":50}],26:[function(c,
v,u){function m(f){r.call(this);this.source=f;this.base=f.uri||"//localhost:8080/api/v2/";if(0===this.base.indexOf("//")){var b=window.location.protocol;"http:"!=b&&"https:"!=b&&(this.base="http:"+this.base)}this.species=f.species||"human";this.type="string"===typeof f.type?[f.type]:f.type||["regulatory"]}function k(f,b,d){var c=d.track_type,h=d.genome_attrs.alt;"numeric"===c?b.type="numeric":"exon"===c?-1!=f[d.label_attr].search(d.exon_key)?(b.type="exon",b.method="exon"):(b.type="exon",b.method=
"intron"):h?"A"===f[h]?(b.type="variant",b.method="A"):"T"===f[h]?(b.type="variant",b.method="T"):"G"===f[h]?(b.type="variant",b.method="G"):"C"===f[h]?(b.type="variant",b.method="C"):-1!=f[h].search(",")?(b.type="variant",b.method="multiple"):1<f[h].length||1<f.REF.length?b.type="indel":(b.type="variant",b.method="unknown"):b.type="default"}if("undefined"!==typeof c){v=c("./sourceadapters");var h=v.registerSourceAdapterFactory;var r=v.FeatureSourceBase;c=c("./das");var A=c.DASStylesheet;var w=c.DASStyle;
var B=c.DASFeature}m.prototype=Object.create(r.prototype);m.prototype.constructor=m;m.prototype.getStyleSheet=function(f){var b=new A;var d=new w;d.glyph="TEXT";d.STRING="A";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="green";b.pushStyle({type:"variant",method:"A"},null,d);d=new w;d.glyph="TEXT";d.STRING="C";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="blue";b.pushStyle({type:"variant",method:"C"},null,d);d=new w;d.glyph="TEXT";d.STRING="G";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="orange";b.pushStyle({type:"variant",
method:"G"},null,d);d=new w;d.glyph="TEXT";d.STRING="T";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="red";b.pushStyle({type:"variant",method:"T"},null,d);d=new w;d.glyph="TEXT";d.STRING="?";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="darkgrey";b.pushStyle({type:"variant",method:"unknown"},null,d);d=new w;d.glyph="DOT";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="purple";b.pushStyle({type:"indel"},null,d);d=new w;d.glyph="STAR";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="black";b.pushStyle({type:"variant",method:"multiple"},null,
d);d=new w;d.glyph="BOX";d.FGCOLOR="blue";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;b.pushStyle({type:"default"},null,d);d=new w;d.glyph="BOX";d.FGCOLOR="red";d.BGCOLOR="red";d.HEIGHT=8;d.LABEL=!0;d.ZINDEX=20;b.pushStyle({type:"exon",method:"exon"},null,d);d=new w;d.glyph="BOX";d.FGCOLOR="white";d.BGCOLOR="white";d.HEIGHT=8;d.LABEL=!0;d.ZINDEX=20;b.pushStyle({type:"exon",method:"intron"},null,d);d=new w;d.glyph="HISTOGRAM";d.BGCOLOR="blue";d.HEIGHT=50;b.pushStyle({type:"numeric"},
null,d);return f(b)};m.prototype.getScales=function(){return[]};m.prototype.fetch=function(f,b,d,c,h,m,l){var q=this,g=this.source;if(!g.genome_attrs.chr||!g.genome_attrs.pos)throw Error("Bad molgenis track configuration: please specify 'genome_attrs.chr' and 'genome_attrs.pos'");c=this.base;h=[];if(g.attrs){for(m=0;m<g.attrs.length;++m){var z=g.attrs[m].split(":");h.push(z[0])}c+="&attrs="+encodeURIComponent(h)}c=g.genome_attrs.stop?c+("&q="+encodeURIComponent(g.genome_attrs.chr)+"=="+f+";("+g.genome_attrs.pos+
"=ge="+b+";"+g.genome_attrs.pos+"=le="+d+","+g.genome_attrs.stop+"=ge="+b+";"+g.genome_attrs.stop+"=le="+d+")"):c+("&q="+encodeURIComponent(g.genome_attrs.chr)+"=="+f+";"+g.genome_attrs.pos+"=ge="+b+";"+g.genome_attrs.pos+"=le="+d);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(q.busy--,q.notifyActivity(),300<=a.status){var b="Error code "+a.status;try{var d=JSON.parse(a.response);d.error&&(b=d.error)}catch(S){}l(b,null)}else{b=JSON.parse(a.response).items;d=[];for(var c=
0;c<b.length;++c){var h=b[c],n=[],t=new B;t.segment=f;t.min=h[g.genome_attrs.pos]|0;t.max=g.genome_attrs.stop?h[g.genome_attrs.stop]|0:h[g.genome_attrs.pos]|0;t.type=h.feature_type||"unknown";t.id=h[g.label_attr?g.label_attr:"ID"];if(g.attrs)for(var m=0;m<g.attrs.length;++m){var z=g.attrs[m].split(":");n.push(z[1]+"="+h[z[0]])}g.actions&&(t.actions=eval(g.actions),t.entity=h);0<n.length&&(t.notes=n);"numeric"===g.track_type&&(t.score=h[g.score_attr]);k(h,t,g);t.molgenis=!0;d.push(t)}l(null,d)}};q.busy++;
q.notifyActivity();a.open("GET",c,!0);a.responseType="text";a.send("")};h("molgenis",function(f){return{features:new m(f)}})},{"./das":10,"./sourceadapters":35}],27:[function(c,v,u){function m(c){return(c|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function k(c){c=""+c;var h=c.indexOf(".");if(0>h)return c;var k=2;"-"==c.substring(0,1)&&++k;return h>=k?c.substring(0,h):c.substring(0,h+2)}"undefined"!==typeof v&&(v.exports={formatLongInt:m,formatQuantLabel:k})},{}],28:[function(c,v,u){function m(c,
f){this.sources=c;this.opts=f||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(c=0;c<this.sources.length;++c)this.initN(c);"function"===typeof f.merge?this.merge=f.merge:"concat"==f.merge?this.merge=r:"alternates"==f.merge?(this.merge=r,this.filterDispatchOnMethod=!0):this.merge=h}function k(c,f,b){this.source=c;this.callback=f;this.sources=b;this.count=b.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=
[];this.statuses=[];this.scale=null}function h(c){for(var f,b,d=[],h=1;h<c.length;++h){f={};b=c[h];for(var k=0;k<b.length;++k)f[this.keyForFeature(b[k])]=b[k];d.push(f)}h=[];c=c[0];for(k=0;k<c.length;++k){for(var m=c[k],l=0;l<d.length;++l)if(f=d[l],b=f[this.keyForFeature(m)])for(var t in b)"score"===t?m.score2=b.score:"min"!==t&&"max"!==t&&"segment"!==t&&"_cachedStyle"!==t&&(m[t]=b[t]);h.push(m)}return h}function r(c,f){for(var b=[],d=0;d<c.length;++d)for(var h=c[d],k=f[d].name,m=0;m<h.length;++m){var l=
h[m];l.method=k;b.push(l)}return b}if("undefined"!==typeof c){c=c("./utils");var A=c.shallowCopy;var w=c.arrayIndexOf}m.prototype.initN=function(c){var f=this.sources[c],b=this;this.business[c]=0;f.addActivityListener&&f.addActivityListener(function(d){b.business[c]=d;b.notifyActivity()});f.addChangeListener&&f.addChangeListener(function(){b.notifyChange()});f.addReadinessListener&&f.addReadinessListener(function(d){b.readiness[c]=d;b.notifyReadiness()})};m.prototype.addReadinessListener=function(c){this.readinessListeners.push(c);
this.notifyReadinessListener(c)};m.prototype.removeReadinessListener=function(c){c=w(this.readinessListeners,c);0<=c&&this.readinessListeners.splice(c,1)};m.prototype.notifyReadiness=function(){for(var c=0;c<this.readinessListeners.length;++c)this.notifyReadinessListener(this.readinessListeners[c])};m.prototype.notifyReadinessListener=function(c){for(var f=null,b=0;b<this.readiness.length;++b)if(null!=this.readiness[b]){f=this.readiness[b];break}try{c(f)}catch(d){console.log(d)}};m.prototype.addActivityListener=
function(c){this.activityListeners.push(c)};m.prototype.removeActivityListener=function(c){c=w(this.activityListeners,c);0<=c&&this.activityListeners.splice(c,1)};m.prototype.notifyActivity=function(){for(var c=0,f=0;f<this.business.length;++f)c+=this.business[f];for(f=0;f<this.activityListeners.length;++f)try{this.activityListeners[f](c)}catch(b){console.log(b)}};m.prototype.addChangeListener=function(c){this.changeListeners.push(c)};m.prototype.removeChangeListener=function(c){c=w(this.changeListeners,
c);0<=c&&this.changeListeners.splice(c,1)};m.prototype.notifyChange=function(){for(var c=0;c<this.changeListeners.length;++c)try{this.changeListeners[c](this.busy)}catch(f){console.log(f)}};m.prototype.getScales=function(){return this.sources[0].getScales()};m.prototype.getStyleSheet=function(c){return this.sources[0].getStyleSheet(c)};m.prototype.capabilities=function(){var c={},f=this.sources[0];f.capabilities&&(c=A(f.capabilities()));for(f=1;f<this.sources.length;++f){var b=this.sources[f];b.capabilities&&
(b=b.capabilities(),b.search&&(c.search=b.search))}return c};m.prototype.search=function(c,f){for(var b=0;b<this.sources.length;++b){var d=this.sources[b];d=d.capabilities?d.capabilities().search:!1;if(d)return this.sources[b].search(c,f)}};m.prototype.fetch=function(c,f,b,d,h,m,C,l){if(this.filterDispatchOnMethod){var q=[];for(var g=l.list(),z=0;z<this.sources.length;++z)for(var a=this.sources[z],e=0;e<g.length;++e){var p=g[e];if(!p.method||p.method==a.name){q.push(a);break}}}else q=this.sources;
C=new k(this,C,q);for(z=0;z<q.length;++z)this.fetchN(C,z,q[z],c,f,b,d,h,m,l)};m.prototype.fetchN=function(c,f,b,d,h,k,m,l,t,g){b.fetch(d,h,k,m,l,t,function(b,a,e){return c.completed(f,b,a,e)},g)};m.prototype.quantFindNextFeature=function(c,f,b,d,h){return this.sources[0].quantFindNextFeature(c,f,b,d,h)};m.prototype.findNextFeature=function(c,f,b,d){return this.sources[0].findNextFeature(c,f,b,d)};k.prototype.completed=function(c,f,b,d){if(null==this.scale||0==c)this.scale=d;if(this.returns[c])throw"Multiple returns for source "+
c;this.returns[c]=!0;this.returnCount++;this.features[c]=b;f&&(this.statuses[c]=f,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){c="";for(f=0;f<this.count;++f)if(b=this.statuses[f])0<c.length&&(c+=", "),c+=b;return this.callback(c,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};m.prototype.getDefaultFIPs=function(c){for(var f=0;f<this.sources.length;++f){var b=this.sources[f];b.getDefaultFIPs&&b.getDefaultFIPs(c)}};m.prototype.keyForFeature=
function(c){return""+c.min+".."+c.max};"undefined"!==typeof v&&(v.exports={OverlayFeatureSource:m})},{"./utils":50}],29:[function(c,v,u){function m(c,l,t){var g=/^\w+\s[0-9]+\s[0-9]+.*$/,C=/([^=]+)=\"?([^\"]+)\"?/,a=/^##\s*fileformat=VCFv4\..+/;(c.blob?new r(c.blob):"encode"==c.transport?new z(c.uri):new h(c.uri,{credentials:c.credentials})).slice(0,65536).salted().fetch(function(e,h){if(!e)return t||(c.credentials=!0,m(c,l,!0)),l(c,"Couldn't fetch data");h=new Uint8Array(e);var p=(new Uint32Array(e,
0,1))[0];if(p==w||p==B){c.tier_type="bwg";e=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(e=e.exec(c.uri||c.blob.name))c.name=e[1];return l(c,null)}if(p==d)return c.tier_type="bai",l(c,null);if(31==h[0]||139==h[1]){e=f(e);e=new Uint8Array(e);p=A(e,0);if(p==b){c.tier_type="bam";e=/\/?([^/]+?)(.bam)?$/;if(e=e.exec(c.uri||c.blob.name))c.name=e[1];return l(c,null)}if(p==q)return c.tier_type="tabix-index",l(c,null);if(1768301347==p){c.tier_type="tabix";c.payload="vcf";e=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(e=
e.exec(c.uri||c.blob.name))c.name=e[1];return l(c,null)}console.log("magic = "+p.toString(16));return l(c,"Unsupported format")}e=String.fromCharCode.apply(null,h).split("\n");if(0<e.length&&a.test(e[0]))return c.tier_type="memstore",c.payload="vcf",e=/\/?([^/]+?)(.vcf)?$/,(e=e.exec(c.uri||c.blob.name))&&!c.name&&(c.name=e[1]),l(c,null);for(p=0;p<e.length;++p)if(h=e[p].replace("\r",""),0!=h.length&&0!=h.indexOf("browser")){if(0==h.indexOf("track")){e="bed";h=h.split(/\s/);for(p=1;p<h.length;++p){var z=
C.exec(h[p]);z&&("type"==z[1]&&"wiggle_0"==z[2]?e="wig":"name"==z[0]&&(c.name=z[2]))}k(c,e);return l(c,null)}if(0==h.indexOf("fixedStep")||0==h.indexOf("variableStep"))return k(c,"wig"),l(c,null);if(g.test(h))return k(c,null),l(c,null);break}return l(c,"Unsupported format")},{timeout:1500})}function k(b,d){b.tier_type="memstore";var f=/\/?([^/]+?)(.(bed|wig))?$/.exec(b.uri||b.blob.name);f&&(b.name||(b.name=f[1]),!d&&f[3]&&(d=f[3]));b.payload=d||"bed"}if("undefined"!==typeof c){u=c("./bin");var h=
u.URLFetchable;var r=u.BlobFetchable;var A=u.readInt;u=c("./bigwig");var w=u.BIG_WIG_MAGIC;var B=u.BIG_BED_MAGIC;var f=c("./lh3utils").unbgzf;u=c("./bam");var b=u.BAM_MAGIC;var d=u.BAI_MAGIC;var q=c("./tabix").TABIX_MAGIC;var z=c("./encode").EncodeFetchable}"undefined"!==typeof v&&(v.exports={probeResource:m})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":42}],30:[function(c,v,u){function m(b){return d[b%d.length]*Math.pow(10,b/d.length|0)}function k(b,d,f){this.scale=
b;this.cnt=this.tot=0;this.hasScore=!1;this.min=d;this.max=f;this.features=[]}function h(b,d){return b.min<d.min?-1:b.min>d.min?1:b.max<d.max?-1:d.max>b.max?1:0}function r(b,d){for(var f,c=0;m(c+1)<d;)++c;c=m(c);for(var h=[],g=-1E10,q=1E10,a=0;a<b.length;++a){d=b[a];if(d.groups&&0<d.groups.length)return b;f=d.min/c|0;var e=d.max/c|0;g=Math.max(g,e);q=Math.min(q,f);for(var p=f;p<=e;++p)f=h[p],f||(f=new k(c,p*c,(p+1)*c-1),h[p]=f),f.feature(d)}a=[];for(p=q;p<=g;++p)if(f=h[p])d=new B,d.segment=b[0].segment,
d.min=p*c+1,d.max=(p+1)*c,d.score=f.score(),d.type="density",a.push(d);Date.now();return a}function A(b){this._pos=b;this._bases={};this._totalCount=0}function w(d,c,h){for(var l,q,g,k,a=null,e=null,p=[],x=0;x<d.length;++x){g=d[x];if(g.groups&&0<g.groups.length)return d;l=g.seq;var m=g.quals;k=f(g.cigar);var n=[];q=[];for(var z=0,w=0;w<k.length;++w){var r=k[w];if("M"==r.op)n.push(l.substr(z,r.cnt)),q.push(m.substr(z,r.cnt)),z+=r.cnt;else if("D"==r.op)for(var C=0;C<r.cnt;++C)n.push("-"),q.push("Z");
else"I"==r.op?z+=r.cnt:"S"==r.op?z+=r.cnt:console.log("unknown cigop"+r.op)}l=n.join("");q=q.join("");n=l;z=q;w=g.orientation;r=g.min||0;g=g.max||0;l=0;for(m=r;m<=g;++m)k=p[m],k||(k=new A(m),p[m]=k),q=n.charAt(l),C=z.charCodeAt(l)-33,k.recordBase(q,C,w),l++;a=a?Math.min(a,r):r;e=e?Math.max(e,g):g}g=a;x=e;q=[];if(c&&(l=c.start|0,k=c.end|0,l<=x&&k>=g)){m=Math.max(g,l);k=Math.min(x,k);for(n=0;n<m-g;n++)q.push("N");q.push(c.seq.substr(m-l,k-m+1));for(n=0;n<x-k;n++)q.push("N")}c=q.join("");x=[];l=0;for(m=
a;m<=e;++m){if(k=p[m])if(g=new B,g.segment=d[0].segment,g.min=k.pos(),g.max=g.min,g.notes=[],g.notes=g.notes.concat(k.infoList()),g.type="base-coverage",g.suppressScore=!0,c)for(a=c.charAt(l),g.notes.unshift("Ref="+a),k=k.baseScoreList(a,.2),n=0;n<k.length;n++){q=k[n].base;z=k[n].score;w=b(g);w.score=z;if(1<k.length||q!=a)w.itemRgb=h[q];x.push(w)}else x.push(g);l++}return x}if("undefined"!==typeof c){var B=c("./das").DASFeature;var f=c("./cigar").parseCigar;var b=c("./utils").shallowCopy}var d=[1,
2,5];k.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var b=this.features;b.sort(h);for(var d=-1E10,f=0,c=0,k=1;k<b.length;++k){var g=b[k],m=Math.max(g.min,this.min);g=Math.min(g.max,this.max);c+=g-m+1;m>d?(f+=g-m+1,d=g):g>d&&(f+=g-d,d=g)}return 0<f?1*c/f:0};k.prototype.feature=function(b){void 0!==b.score&&(this.tot+=b.score,this.hasScore=!0);++this.cnt;this.features.push(b)};A.prototype.recordBase=function(b,d,f){if(this._bases[b])b=this._bases[b],b.cnt++,
b.totalQual+=d,b.strandCnt[f]++;else{var c={"+":0,"-":0};c[f]++;this._bases[b]={cnt:1,totalQual:d,strandCnt:c}}this._totalCount++};A.prototype.totalCount=function(){return this._totalCount};A.prototype.pos=function(){return this._pos};A.prototype.infoList=function(){var b=[],d=this._totalCount;b.push("Depth="+d.toString());for(var f in this._bases){var c=this._bases[f],h=c.cnt,g=c.strandCnt["+"],k=c.strandCnt["-"];c=c.totalQual/h;h=[f,"=",h," (",(100*h/d).toFixed(0),"%, ",g," +, ",k," -, Qual: ",
c.toFixed(0),")"];b.push(h.join(""))}return b};A.prototype.baseScoreList=function(b,d){var f=[],c=this._totalCount;d*=c;for(var h in this._bases){var g=this._bases[h].cnt;g<d||h==b||(f.push({base:h,score:c}),c-=g)}f.push({base:b,score:c});return f};"undefined"!==typeof v&&(v.exports={downsample:r,getBaseCoverage:w})},{"./cigar":8,"./das":10,"./utils":50}],31:[function(c,v,u){function m(c,h){c=parseFloat(c.replace(/,/g,""));return"k"===h||"K"===h?1E3*c|0:"m"==h||"M"===h?1E6*c|0:c|0}if("undefined"!==
typeof c){var k=c("./cbrowser").Browser;var h=c("./bin").URLFetchable;var r=c("./trix").connectTrix}var A=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;k.prototype.search=function(c,k,f){var b=this;f=f||{};var d=f.padding||this.defaultSearchRegionPadding,q=A.exec(c);if(q){f=q[1];if(q[6]){var z=m(q[2],q[3]);q=m(q[6],q[7])}else{var w=this.viewEnd-this.viewStart+1;z=m(q[2],q[3])-w/2|0;q=z+w-1}this.setLocation(f,z,q,k)}else{if(!c||0==c.length)return!1;var l=0,t=!1,
g=function(a,e){--l;if(e)return k(e);a||(a=[]);e=5E8;for(var g=-1E8,f=null,h=0;h<a.length;++h){var n=a[h];null==f&&(f=n.segment);e=Math.min(e,n.min);g=Math.max(g,n.max)}if(f)t=!0,b.highlightRegion(f,e,g),a=Math.max(d,.3*(g-e+1)|0),b.setLocation(f,e-a,g+a,k);else if(0==l&&!t)return k("no match for '"+c+"'")},B=function(a,b){b.lookup(c,function(b,e){if(null==b||2>b.length)return a.featureSource.search(c,g);b=b[1].split(",")[0];return a.featureSource.search(b,g)})};if(this.searchEndpoint)return l=1,
this.doDasSearch(b.searchEndpoint,c,g);for(f=0;f<this.tiers.length;++f)(function(a){b.sourceAdapterIsCapable(a.featureSource,"search")?a.dasSource.trixURI?(++l,a.trix?B(a,a.trix):r(new h(a.dasSource.trixURI),new h(a.dasSource.trixURI+"x"),function(b){a.trix=b;B(a,b)})):(++l,a.featureSource.search(c,g)):a.dasSource.provides_search&&(++l,b.doDasSearch(a.dasSource,c,g))})(this.tiers[f])}};k.prototype.doDasSearch=function(c,h,f){c.features(null,{group:h,type:"transcript"},function(b){b||(b=[]);for(var d=
[],c=0;c<b.length;++c){var k=b[c];k.label.toLowerCase()==h.toLowerCase()&&d.push(k)}return f(d)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":48}],32:[function(c,v,u){function m(b,d){d||(d=100);for(var c=f.length;b*f[c%f.length]*Math.pow(10,c/f.length|0)<d;)++c;return f[c%f.length]*Math.pow(10,c/f.length|0)}function k(b,d){var f=b.viewport.getContext("2d"),c=b.browser.retina&&1<window.devicePixelRatio,k=b.browser.featurePanelWidth+2E3;c&&(k*=2);var l=b.viewport.width|0;l<k-50&&(b.viewport.width=l=k);
k=50;d&&d.seq&&(k+=25);var m=k;c&&(m*=2);b.viewport.height=m;b.viewport.style.height=""+k+"px";b.viewport.style.width=c?""+l/2+"px":""+l+"px";b.layoutHeight=k;b.updateHeight();b.background&&(f.fillStyle=b.background,f.fillRect(0,0,l,b.viewport.height));c&&f.scale(2,2);f.translate(1E3,0);h(b,d,f);b.norigin=b.browser.viewStart;b.viewportHolder.style.left="-1000px"}function h(b,d,f){var c=b.browser.scale,h=b.browser.viewStart-1E3/c|0,l=b.browser.viewEnd+2E3/c,k=b.browser.currentSeqMax,g=l;0<k&&k<l&&
(g=k);var q=m(c),a=Math.max(0,(h/q|0)*q);for(k=b.browser.viewStart;a<=g;)f.fillStyle=0==a/q%2?"white":"black",f.strokeStyle="black",f.fillRect((a-k)*c,8,q*c,3),f.strokeRect((a-k)*c,8,q*c,3),f.fillStyle="black",f.fillText(A(a),(a-k)*c,22),a+=q;if(d&&d.seq)for(;h<=l;++h)h>=d.start&&h<=d.end&&(g=d.seq.substr(h-d.start,1).toUpperCase(),(q=b.browser.baseColors[g])||(q="gray"),f.fillStyle=q,8<=c?(q=f.measureText(g).width,f.fillText(g,(h-k)*c+.5*(c-q),52)):f.fillRect((h-k)*c,42,c,12))}function r(b,d){var f=
b.browser.scale,c=b.browser.viewStart-1E3/f|0,h=b.browser.viewEnd+2E3/f,l=b.browser.currentSeqMax,k=h;0<l&&l<h&&(k=l);var g=m(f),r=Math.max(0,(c/g|0)*g);l=b.browser.viewStart;for(var a=w(B,"g",[],{fontSize:"8pt"});r<=k;)a.appendChild(w(B,"rect",null,{x:(r-l)*f,y:8,width:g*f,height:3,fill:0==r/g%2?"white":"black",stroke:"black"})),a.appendChild(w(B,"text",A(r),{x:(r-l)*f,y:28,fill:"black",stroke:"none"})),r+=g;if(d&&d.seq)for(;c<=h;++c)c>=d.start&&c<=d.end&&(k=d.seq.substr(c-d.start,1).toUpperCase(),
(g=b.browser.baseColors[k])||(g="gray"),8<=f?a.appendChild(w(B,"text",k,{x:(.5+c-l)*f,y:52,textAnchor:"middle",fill:g})):a.appendChild(w(B,"rect",null,{x:(c-l)*f,y:42,width:f,height:12,fill:g})));return a}if("undefined"!==typeof c){u=c("./utils");var A=u.formatLongInt;var w=u.makeElementNS;var B=c("./svg-utils").NS_SVG;A=c("./numformats").formatLongInt}var f=[1,2,5];B="http://www.w3.org/2000/svg";"undefined"!==typeof v&&(v.exports={drawSeqTier:k,drawSeqTierGC:h,svgSeqTier:r})},{"./numformats":27,
"./svg-utils":40,"./utils":50}],33:[function(c,v,u){if("undefined"!=typeof c){var m=c("./cbrowser").Browser;v=c("./sourcecompare");var k=v.sourceDataURI;var h=v.sourcesAreEqual;var r=c("./version");var A=c("./utils").miniJSONify;var w=c("./sha1").hex_sha1}m.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+
this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+
this.cookieKey+".ruler-location"]};m.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};m.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+
this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};m.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){var c=[];for(var f=0;f<this.tiers.length;++f){var b=this.tiers[f];b.dasSource.noPersist||c.push({source:b.dasSource,config:b.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(c);f={};b=[];for(var d=0;d<this.hubObjects.length;++d){var h=this.hubObjects[d];
c={url:h.hub.url,genome:h.genome};h.credentials&&(c.credentials=h.credentials);h.mapping&&(c.mapping=h.mapping);f[c.url]=!0;b.push(c)}for(d=0;d<this.hubs.length;++d)c=this.hubs[d],"string"===typeof c&&(c={url:c}),f[c.url]||b.push(c);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+
this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=r.CONFIG}};m.prototype.restoreStatus=function(){var c;if(!this.noPersist){var f=localStorage["dalliance."+this.cookieKey+".version"];if(r.CONFIG==
(f?f|0:-100)){f=localStorage["dalliance."+this.cookieKey+".configHash"]||"";var b=w(A({sources:this.sources,hubs:this.hubs}));if(b!=f)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{f={};for(var d=0;d<this.sources.length;++d)if(c=this.sources[d]){var q=k(c);(b=f[q])||(f[q]=b=[]);b.push(c)}if(!this.noPersistView&&(b=localStorage["dalliance."+this.cookieKey+".view-chr"],c=localStorage["dalliance."+this.cookieKey+".view-start"]|0,d=localStorage["dalliance."+this.cookieKey+".view-end"]|
0,b&&c&&d)){this.chr=b;this.viewStart=c;this.viewEnd=d;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof b||isNaN(b)||(this.savedZoom=b)}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+
this.cookieKey+".reverse-key-scrolling"])&&"true"==b;this.singleBaseHighlight=(b=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==b;if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var m=
JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(d=0;d<m.length;++d)for(c=this.sources[d]=m[d].source,this.restoredConfigs[d]=m[d].config,q=k(c),b=f[q]||[],q=0;q<b.length;++q){var C=b[q];if(h(c,C))for(var l in C)C.hasOwnProperty(l)&&("function"===typeof C[l]||C[l]instanceof Blob)&&(c[l]=C[l])}}if(l=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(l);return!0}}}};m.prototype.reset=function(){for(var c=this.tiers.length-1;0<=c;--c)this.removeTier({index:c},!0);for(c=0;c<
this.defaultSources.length;++c)this.defaultSources[c].disabled||this.addTier(this.defaultSources[c]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":34,"./sourcecompare":36,"./utils":50,"./version":52}],34:[function(c,v,u){function m(c){c=h(r(c));for(var k="",f,b=0;b<c.length;b++)f=c.charCodeAt(b),k+="0123456789abcdef".charAt(f>>>4&15)+"0123456789abcdef".charAt(f&15);return k}function k(c){c=h(r(c));for(var k=
"",f=c.length,b=0;b<f;b+=3)for(var d=c.charCodeAt(b)<<16|(b+1<f?c.charCodeAt(b+1)<<8:0)|(b+2<f?c.charCodeAt(b+2):0),q=0;4>q;q++)k=8*b+6*q>8*c.length?k+"":k+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>>6*(3-q)&63);return k}function h(c){for(var h=Array(c.length>>2),f=0;f<h.length;f++)h[f]=0;for(f=0;f<8*c.length;f+=8)h[f>>5]|=(c.charCodeAt(f/8)&255)<<24-f%32;c=8*c.length;h[c>>5]|=128<<24-c%32;h[(c+64>>9<<4)+15]=c;c=Array(80);f=1732584193;for(var b=-271733879,d=-1732584194,
k=271733878,m=-1009589776,r=0;r<h.length;r+=16){for(var l=f,t=b,g=d,w=k,a=m,e=0;80>e;e++){if(16>e)c[e]=h[r+e];else{var p=c[e-3]^c[e-8]^c[e-14]^c[e-16];c[e]=p<<1|p>>>31}p=f<<5|f>>>27;var x=20>e?b&d|~b&k:40>e?b^d^k:60>e?b&d|b&k|d&k:b^d^k;p=A(A(p,x),A(A(m,c[e]),20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514));m=k;k=d;d=b<<30|b>>>2;b=f;f=p}f=A(f,l);b=A(b,t);d=A(d,g);k=A(k,w);m=A(m,a)}h=[f,b,d,k,m];c="";for(f=0;f<32*h.length;f+=8)c+=String.fromCharCode(h[f>>5]>>>24-f%32&255);return c}function r(c){for(var h=
"",f=-1,b,d;++f<c.length;)b=c.charCodeAt(f),d=f+1<c.length?c.charCodeAt(f+1):0,55296<=b&&56319>=b&&56320<=d&&57343>=d&&(b=65536+((b&1023)<<10)+(d&1023),f++),127>=b?h+=String.fromCharCode(b):2047>=b?h+=String.fromCharCode(192|b>>>6&31,128|b&63):65535>=b?h+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|b&63):2097151>=b&&(h+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|b&63));return h}function A(c,h){var f=(c&65535)+(h&65535);return(c>>16)+(h>>16)+(f>>16)<<16|f&65535}"undefined"!==
typeof v&&(v.exports={b64_sha1:k,hex_sha1:m})},{}],35:[function(c,v,u){function m(a,b){fa[a]=b}function k(a,b){ba[a]=b}function h(a){if(ba[a])return ba[a](a)}function r(a){var b=this;this.source=a;this.cfsid="cfs"+ ++ha;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){b.cfsid="cfs"+ ++ha})}function A(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function w(a){this.dasSource=new U(a);this.busy=0;this.activityListeners=[]}function B(a){this.dasSource=
new U(a);this.awaitedEntryPoints=new p;var b=this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}function f(a){var b=this;this.source=a;this.twoBit=new p;if(a.twoBitURI)a=new G(a.twoBitURI);else if(a.twoBitBlob)a=new P(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");y(a,function(a,e){e?console.log(e):b.twoBit.provide(a)})}function b(a){A.call(this);var b=this;this.readiness="Connecting";this.bwgSource=this.opts=a;b.bwgHolder=new p;if(this.opts.preflight){var e=
X[this.opts.preflight];if(!e){e=new p;X[this.opts.preflight]=e;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?e.provide("success"):e.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(d.withCredentials=!0);d.send("")}e.await(function(a){"success"===a&&b.init()})}else b.init()}function d(a,b){A.call(this);this.worker=b;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new p;
this.init()}function q(a,b){if(!(a.flag&Q.SEGMENT_UNMAPPED)){var e=a.seq?a.seq.length:a.seqLength;if(a.cigar){e=0;for(var d=Y(a.cigar),g=0;g<d.length;++g){var c=d[g];if("M"==c.op||"D"==c.op)e+=c.cnt}}d=new W;d.min=a.pos+1;d.max=a.pos+e;d.segment=a.segment;d.type="bam";d.id=a.readName;d.notes=["MQ="+a.mq];d.cigar=a.cigar;d.seq=a.seq;d.quals=a.quals;d.orientation=a.flag&Q.REVERSE_COMPLEMENT?"-":"+";d.bamRecord=a;b&&a.flag&Q.MULTIPLE_SEGMENTS&&(d.groups=[{id:a.readName,type:"readpair"}]);return d}}function z(a){A.call(this);
var b=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new p;if(this.opts.preflight){var e=X[this.opts.preflight];if(!e){e=new p;X[this.opts.preflight]=e;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?e.provide("success"):e.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(d.withCredentials="true");d.send("")}e.await(function(a){"success"===
a&&b.init()})}else b.init()}function C(a,b){A.call(this);this.bamSource=a;this.worker=b;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new p;this.init()}function l(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}function t(){}function g(){}function F(a){this.store=new aa(a.jbURI,a.jbQuery)}if("undefined"!==typeof c){var a=c("./cbrowser").Browser;var e=c("./tier").DasTier;u=c("./utils");var p=u.Awaited;var x=u.arrayIndexOf;var J=
u.shallowCopy;var n=u.resolveUrlToPage;u=c("./das");var E=u.DASStylesheet;var T=u.DASStyle;var U=u.DASSource;var S=u.DASSegment;var W=u.DASFeature;var D=u.DASSequence;var I=u.DASLink;u=c("./bin");var G=u.URLFetchable;var P=u.BlobFetchable;var y=c("./twoBit").makeTwoBit;var H=c("./bigwig").makeBwg;u=c("./bam");var N=u.makeBam;var Q=u.BamFlags;u=c("./spans");var O=u.Range;var Z=u.union;var Y=c("./cigar").parseCigar;var na=c("./overlay").OverlayFeatureSource;var aa=c("./jbjson").JBrowseStore;var ea=
c("./chainset").Chainset;c("./style");var R=c("./encode").EncodeFetchable}var fa={},ba={};e.prototype.initSources=function(){var a=this,b=this.browser.createSources(this.dasSource);this.featureSource=b.features||new t;this.sequenceSource=b.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};a.prototype.createSources=function(a){var e;if(e=this.sourceCache.get(a))return e;if("sequence"==a.tier_type||a.twoBitURI||
a.twoBitBlob)var g=a.twoBitURI||a.twoBitBlob?new f(a):new B(a);else if(a.tier_type&&fa[a.tier_type]){g=(0,fa[a.tier_type])(a);var c=g.features;g=g.sequence}else if(a.bwgURI||a.bwgBlob)c=(c=this.getWorker())?new d(a,c):new b(a);else if(a.bamURI||a.bamBlob)c=(c=this.getWorker())?new C(a,c):new z(a);else if(a.jbURI)c=new F(a);else if(a.uri||a.features_uri)c=new w(a);if(a.overlay){e=[];c&&e.push(new r(c));for(c=0;c<a.overlay.length;++c){var h=this.createSources(a.overlay[c]);h&&h.features&&e.push(h.features)}c=
new na(e,a)}a.sequenceAliases&&(c=new l(c,new ea({type:"alias",sequenceAliases:a.sequenceAliases})));a.mapping&&(c=new l(c,this.chains[a.mapping]));a.name&&c&&!c.name&&(c.name=a.name);null!=c&&(c=new r(c));if(null!=c||null!=g)e={features:c,sequence:g},this.sourceCache.put(a,e);return e};e.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||
this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new w(this.dasSource):this.getSource()).getStyleSheet(a)};var ha=0;r.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};r.prototype.removeReadinessListener=function(a){if(this.source.removeReadinessListener)return this.source.removeReadinessListener(a)};r.prototype.search=function(a,b){if(this.source.search)return this.source.search(a,b)};r.prototype.getDefaultFIPs=
function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};r.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};r.prototype.getScales=function(){return this.source.getScales()};r.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};r.prototype.removeActivityListener=function(a){this.source.removeActivityListener&&this.source.removeActivityListener(a)};r.prototype.addChangeListener=function(a){this.source.addChangeListener&&
this.source.addChangeListener(a)};r.prototype.removeChangeListener=function(a){this.source.removeChangeListener&&this.source.removeChangeListener(a)};r.prototype.findNextFeature=function(a,b,e,d){this.source.findNextFeature(a,b,e,d)};r.prototype.quantFindNextFeature=function(a,b,e,d,c){this.source.quantFindNextFeature(a,b,e,d,c)};r.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};r.prototype.fetch=function(a,b,e,d,c,g,f,h){if(!g)throw Error("Fetch pool is null");
var n=this,l=this.cfsid,k=g.awaitedFeatures[l];if(k&&k.started){if(k.styleFilters.doesNotContain(h)){n.source.fetch(a,b,e,d,c,g,f,h);return}}else k?k.styleFilters.addAll(h):(k=new p,k.styleFilters=h,g.awaitedFeatures[l]=k,g.requestsIssued.then(function(){k.started=!0;n.source.fetch(a,b,e,d,k.styleFilters.typeList(),g,function(a,b,e,d){k.res||k.provide({status:a,features:b,scale:e,coverage:d})},k.styleFilters)}).catch(function(a){console.log(a)}));k.await(function(a){f(a.status,a.features,a.scale,
a.coverage)})};A.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};A.prototype.removeReadinessListener=function(a){a=x(this.readinessListeners,a);0<=a&&this.readinessListeners.splice(a,1)};A.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(da){console.log(da)}};A.prototype.addActivityListener=function(a){this.activityListeners.push(a)};A.prototype.removeActivityListener=
function(a){a=x(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};A.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(da){console.log(da)}};A.prototype.getScales=function(){return null};A.prototype.fetch=function(a,b,e,d,c,g,f){return f(null,[],1E9)};A.prototype.getStyleSheet=function(a){var b=new E,e=new T;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};
w.prototype.addActivityListener=function(a){this.activityListeners.push(a)};w.prototype.removeActivityListener=function(a){a=x(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};w.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(da){console.log(da)}};w.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};w.prototype.fetch=
function(a,b,e,d,c,g,f){if(c&&0==c.length)f(null,[],d);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return f(null,this.cachedStaticFeatures,this.cachedStaticScale);var h=!1!==this.dasSource.maxbins;c={type:c};h&&(c.maxbins=1+((e-b)/d|0));var n=this;n.busy++;n.notifyActivity();this.dasSource.features(new S(a,b,e),c,function(a,b){n.busy--;n.notifyActivity();var e=d;h||(e=.1);!b&&n.dasSource.dasStaticFeatures&&(n.cachedStaticFeatures=
a,n.cachedStaticScale=e);f(b,a,e)})}};w.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,e,d){if(this.dasSource.capabilities&&0<=x(this.dasSource.capabilities,"das1:adjacent-feature")){var c=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(b|0)+":"+(0<e?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=b;thisTier.dasSource.features(null,a,function(a){c.dasAdjLock=!1;0<a.length&&
null!=a[0]&&d(a[0])})}};B.prototype.fetch=function(a,b,e,d,c){this.dasSource.sequence(new S(a,b,e),function(a){return 1==a.length?c(null,a[0]):c("Didn't get sequence")})};B.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(e){for(var d=0;d<e.length;++d)if(e[d].name==a)return b({length:e[d].end});return b()})};f.prototype.fetch=function(a,b,e,d,c){this.twoBit.await(function(d){d.fetch(a,b,e,function(d,g){if(g)return c(g,null);d=new D(a,b,e,"DNA",d);return c(null,d)})})};f.prototype.getSeqInfo=
function(a,b){this.twoBit.await(function(e){e.getSeq(a)?e.getSeq(a).length(function(a){b({length:a})}):b()})};w.prototype.getScales=function(){return[]};var X={};b.prototype=Object.create(A.prototype);b.prototype.init=function(){var a=this;var b=(b=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?new R(b,{credentials:this.opts.credentials}):new G(b,{credentials:this.opts.credentials}):new P(this.bwgSource.bwgBlob);H(b,function(b,e){e?(a.error=e,a.readiness=null,a.notifyReadiness(),
a.bwgHolder.provide(null)):(a.bwgHolder.provide(b),a.readiness=null,a.notifyReadiness(),"bigbed"==b.type&&b.getExtraIndices(function(b){a.extraIndices=b}))})};b.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var b=0;b<this.extraIndices.length;++b)a.search.push(this.extraIndices[b].field)}return a};b.prototype.fetch=function(a,b,e,d,c,g,f){var h=this;this.bwgHolder.await(function(g){if(null==
g)return f(h.error||"Can't access binary file",null,null);var n=!c||0==c.length||0<=x(c,"density");h.opts.clientBin&&(n=!1);var l=h.opts.scaleFactor||1;if("bigwig"==g.type||n||"undefined"!==typeof h.opts.forceReduction){n=-1;for(var p=0;p<g.zoomLevels.length;++p)if(g.zoomLevels[p].reduction<=d*l)n=p;else break;"undefined"!==typeof h.opts.forceReduction&&(n=h.opts.forceReduction);l=0>n?g.getUnzoomedView():g.getZoomedView(n)}else l=g.getUnzoomedView();h.busy++;h.notifyActivity();l.readWigData(a,b,e,
function(a){h.busy--;h.notifyActivity();var d=1E9;if("bigwig"===g.type){var c=(e-b)/a.length/2;c<d&&(d=c)}if(h.opts.link)for(c=0;c<a.length;++c){var n=a[c];n.label&&(n.links=[new I("Link",h.opts.link.replace(/\$\$/,n.label))])}f(null,a,d)})})};b.prototype.quantFindNextFeature=function(a,b,e,d,c){var g=this;g.busy++;g.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,e,d,function(a,b){g.busy--;g.notifyActivity();return c(a,b)})};b.prototype.findNextFeature=function(a,b,e,d){var c=this;c.busy++;
c.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,e,function(a){c.busy--;c.notifyActivity();0<a.length&&null!=a[0]&&d(a[0])})};b.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],e=0;e<a.zoomLevels.length;++e)b.push(a.zoomLevels[e].reduction);return b}return null};b.prototype.search=function(a,b){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,b):b(null,"No indices available")};b.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;
this.bwgHolder.await(function(b){b&&b.schema&&b.definedFieldCount<b.schema.fields.length&&a(function(a,e){for(var d=0;d<e.hit.length;++d)if(e.hit[d].isSuperGroup)return;for(d=b.definedFieldCount;d<b.schema.fields.length;++d){var c=b.schema.fields[d];e.add(c.comment,a[c.name])}})})};b.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var e=new E;if("bigbed"==b.type){var d=new T;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;
d.LABEL=!0;d.ZINDEX=20;e.pushStyle({type:"bigbed"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;e.pushStyle({type:"translation"},null,d);d=new T;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;e.pushStyle({type:"transcript"},null,d);d=new T;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2="black";d.HEIGHT=30;e.pushStyle({type:"density"},null,d)}else d=new T,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",
d.HEIGHT=30,e.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(e.geneHint=!0);return a(e)})};d.prototype=Object.create(A.prototype);d.prototype.init=function(){var a=this,b=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,e=this.bwgSource.blob||this.bwgSource.bwgBlob,d=function(b,e){a.readiness=null;a.notifyReadiness();b?a.worker.postCommand({command:"meta",connection:b},function(e,d){d?(a.error=d,a.keyHolder.provide(null)):(a.meta=e,a.keyHolder.provide(b))}):(a.error=
e,a.keyHolder.provide(null))};e?this.worker.postCommand({command:"connectBBI",blob:e},d):this.worker.postCommand({command:"connectBBI",uri:n(b),transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},d)};d.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var b=0;b<this.meta.extraIndices.length;++b)a.search.push(this.meta.extraIndices[b].field)}return a};
d.prototype.fetch=function(a,b,e,d,c,g,f){var h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(g){if(!g)return h.busy--,h.notifyActivity(),f(h.error||"Can't access binary file",null,null);var n=-1,l=!c||0==c.length||0<=x(c,"density");h.opts.clientBin&&(l=!1);if("bigwig"==h.meta.type||l||"undefined"!==typeof h.opts.forceReduction){for(l=1;l<h.meta.zoomLevels.length;++l)if(h.meta.zoomLevels[l]<=d)n=l-1;else break;"undefined"!==typeof h.opts.forceReduction&&(n=h.opts.forceReduction)}h.worker.postCommand({command:"fetch",
connection:g,chr:a,min:b,max:e,zoom:n},function(a,d){h.busy--;h.notifyActivity();var c=1E9;if("bigwig"===h.meta.type){var g=(e-b)/a.length/2;g<c&&(c=g)}if(h.opts.link)for(g=0;g<a.length;++g){var n=a[g];n.label&&(n.links=[new I("Link",h.opts.link.replace(/\$\$/,n.label))])}f(d,a,c)})})};d.prototype.quantFindNextFeature=function(a,b,e,d,c){var g=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:b,dir:e,threshold:d,under:!1},function(a,
b){console.log(a,b);g.busy--;g.notifyActivity();return c(a,b)})};d.prototype.findNextFeature=function(a,b,e,d){var c=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:b,dir:e},function(a,b){c.busy--;c.notifyActivity();0<a.length&&null!=a[0]&&d(a[0])})};d.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};d.prototype.search=function(a,b){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return b(null,
"No indices available");var e=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,d){e.busy--;e.notifyActivity();b(a,d)})};d.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var b=this;this.keyHolder.await(function(e){var d=b.meta;d&&d.schema&&d.definedFieldCount<d.schema.fields.length&&a(function(a,b){for(var e=0;e<b.hit.length;++e)if(b.hit[e].isSuperGroup)return;
for(e=d.definedFieldCount;e<d.schema.fields.length;++e){var c=d.schema.fields[e];b.add(c.comment,a[c.name])}})})};d.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(e){e=b.meta;if(!e)return a(null,"bbi error");var d=new E;if("bigbed"==e.type){var c=new T;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;d.pushStyle({type:"bigbed"},null,c);c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=10;c.BUMP=!0;c.ZINDEX=20;d.pushStyle({type:"translation"},
null,c);c=new T;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="white";c.HEIGHT=10;c.ZINDEX=10;c.BUMP=!0;c.LABEL=!0;d.pushStyle({type:"transcript"},null,c);c=new T;c.glyph="HISTOGRAM";c.COLOR1="white";c.COLOR2="black";c.HEIGHT=30;d.pushStyle({type:"density"},null,c)}else c=new T,c.glyph="HISTOGRAM",c.COLOR1="white",c.COLOR2="black",c.HEIGHT=30,d.pushStyle({type:"default"},null,c);12==e.definedFieldCount&&14<=e.fieldCount&&(d.geneHint=!0);return a(d)})};z.prototype=Object.create(A.prototype);z.prototype.init=
function(){var a=this;if(this.bamSource.bamBlob){var b=new P(this.bamSource.bamBlob);var e=new P(this.bamSource.baiBlob)}else b=new G(this.bamSource.bamURI,{credentials:this.opts.credentials}),e=new G(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials});N(b,e,null,function(b,e){a.readiness=null;a.notifyReadiness();b?a.bamHolder.provide(b):(a.error=e,a.bamHolder.provide(null))})};z.prototype.fetch=function(a,b,e,d,c,g,f){var h=c&&1==c.length&&"density"==c[0],n=this;
n.busy++;n.notifyActivity();this.bamHolder.await(function(d){if(!d)return n.busy--,n.notifyActivity(),f(n.error||"Couldn't fetch BAM");d.fetch(a,b,e,function(a,b){n.busy--;n.notifyActivity();if(b)f(b,null,null);else{b=[];for(var e=0;e<a.length;++e){var d=q(a[e],n.opts.bamGroup);d&&b.push(d)}f(null,b,1E9)}},{light:h})})};z.prototype.getScales=function(){return 1E9};z.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new E;var e=new T;e.glyph="HISTOGRAM";e.COLOR1="black";e.COLOR2=
"red";e.HEIGHT=30;b.pushStyle({type:"density"},"low",e);b.pushStyle({type:"density"},"medium",e);e=new T;e.glyph="__SEQUENCE";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!1;e.ZINDEX=20;b.pushStyle({type:"bam"},"high",e);return a(b)})};C.prototype=Object.create(A.prototype);C.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,e=this.bamSource.indexUri||this.bamSource.baiURI||b+".bai",d=this.bamSource.bamBlob||this.bamSource.blob,c=this.bamSource.baiBlob||
this.bamSource.indexBlob,g=function(b,e){a.readiness=null;a.notifyReadiness();b?a.keyHolder.provide(b):(a.error=e,a.keyHolder.provide(null))};d?this.worker.postCommand({command:"connectBAM",blob:d,indexBlob:c},g):this.worker.postCommand({command:"connectBAM",uri:n(b),indexUri:n(e),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},g)};C.prototype.fetch=function(a,b,e,d,c,g,f){var h=c&&1==c.length&&"density"==c[0],n=this;n.busy++;n.notifyActivity();this.keyHolder.await(function(d){if(!d)return n.busy--,
n.notifyActivity(),f(n.error||"Couldn't fetch BAM");n.worker.postCommand({command:"fetch",connection:d,chr:a,min:b,max:e,opts:{light:h}},function(a,b){n.busy--;n.notifyActivity();if(b)f(b,null,null);else{b=[];for(var e=0;e<a.length;++e){var d=q(a[e],n.opts.bamGroup);d&&b.push(d)}f(null,b,1E9)}})})};C.prototype.getScales=function(){return 1E9};C.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new E;var e=new T;e.glyph="HISTOGRAM";e.COLOR1="black";e.COLOR2="red";e.HEIGHT=30;b.pushStyle({type:"density"},
"low",e);b.pushStyle({type:"density"},"medium",e);e=new T;e.glyph="__SEQUENCE";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!1;e.ZINDEX=20;b.pushStyle({type:"bam"},"high",e);return a(b)})};l.prototype.addActivityListener=function(a){this.activityListeners.push(a)};l.prototype.removeActivityListener=function(a){a=x(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,0)};l.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(da){console.log(da)}};
l.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};l.prototype.getScales=function(){return this.source.getScales()};l.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};l.prototype.simplifySegments=function(a,b){if(0==a.length)return a;a.sort(function(a,b){var e=a.name-b.name;return e?e:(e=a.start-b.start)?e:a.end-b.end});for(var e=[],d=a[0],c=0;c<a.length;++c){var g=a[c];g.name!=d.name||g.start>d.end+b?(e.push(d),d=g):
d=new S(d.name,Math.min(d.start,g.start),Math.max(d.end,g.end))}e.push(d);return e};l.prototype.fetch=function(a,b,e,d,c,g,f,h){var n=this,l=e-b+1;n.busy++;n.notifyActivity();this.mapping.sourceBlocksForRange(a,b,e,function(a){if(0==a.length)n.busy--,n.notifyActivity(),f("No mapping available for this regions",[],d);else{a=n.simplifySegments(a,Math.max(100,.05*l));var b=[],e=null,p=a.length,k;a.map(function(a){n.source.fetch(a.name,a.start,a.end,d,c,g,function(d,c,g){d&&!k&&(k=d);if(c)for(d=0;d<c.length;++d){var h=
c[d],l=h.segment;0==l.indexOf("chr")&&(l=l.substr(3));l=n.mapping.mapSegment(l,h.min,h.max);if(0==l.length)h.parts&&0<h.parts.length&&b.push(h);else for(var x=0;x<l.length;++x){var q=l[x],m=J(h);m.segment=q.segment;m.min=q.min;m.max=q.max;q.partialMin&&(m.partialMin=q.partialMin);q.partialMax&&(m.partialMax=q.partialMax);q.flipped&&("-"==h.orientation?m.orientation="+":"+"==h.orientation&&(m.orientation="-"));b.push(m)}}c=n.mapping.mapPoint(a.name,a.start);d=n.mapping.mapPoint(a.name,a.end);c&&d&&
(c=new O(c.pos,d.pos),e=e?Z(e,c):c);--p;0==p&&(n.busy--,n.notifyActivity(),f(k,b,g,e))},h)})}})};t.prototype.getScales=function(){return null};t.prototype.fetch=function(a,b,e,d,c,g,f){return f(null,[],1E9)};t.prototype.getStyleSheet=function(a){var b=new E,e=new T;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};g.prototype.fetch=function(a,b,e,d,c){return c(null,null)};F.prototype.getScales=function(){return null};F.prototype.getStyleSheet=function(a){var b=
new E,e=new T;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="green";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=20;b.pushStyle({type:"default"},null,e);return a(b)};F.prototype.fetch=function(a,b,e,d,c,g,f){c&&0==c.length?f(null,[],d):this.store.features(new S(a,b,e),{},function(a,b){f(b,a,1E5)})};a.prototype.sourceAdapterIsCapable=function(a,b){return a.capabilities?a.capabilities()[b]:!1};"undefined"!==typeof v&&(v.exports={FeatureSourceBase:A,TwoBitSequenceSource:f,DASSequenceSource:B,MappedFeatureSource:l,
CachingFeatureSource:r,BWGFeatureSource:b,RemoteBWGFeatureSource:d,BAMFeatureSource:z,RemoteBAMFeatureSource:C,DummyFeatureSource:t,DummySequenceSource:g,registerSourceAdapterFactory:m,registerParserFactory:k,makeParser:h},c("./ensembljson"),c("./molgenisjson"),c("./tabix-source"),c("./memstore"),c("./bedwig"),c("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./molgenisjson":26,
"./overlay":28,"./spans":37,"./style":38,"./tabix-source":41,"./tier":46,"./twoBit":49,"./utils":50,"./vcf":51}],36:[function(c,v,u){function m(c){return c.uri?c.uri:c.blob?"file:"+c.blob.name:c.bwgBlob?"file:"+c.bwgBlob.name:c.bamBlob?"file:"+c.bamBlob.name:c.twoBitBlob?"file:"+c.twoBitBlob.name:c.bwgURI||c.bamURI||c.jbURI||c.twoBitURI||"https://www.biodalliance.org/magic/no_uri"}function k(c){return c.stylesheet_uri?c.stylesheet_uri:"sequence"==c.tier_type||c.twoBitURI||c.twoBitBlob?"https://www.biodalliance.org/magic/sequence":
m(c)}function h(c,k){if(m(c)!=m(k)||c.mapping!=k.mapping||c.tier_type!=k.tier_type)return!1;if(c.overlay){if(!k.overlay||k.overlay.length!=c.overlay.length)return!1;for(var r=0;r<c.overlay.length;++r)if(!h(c.overlay[r],k.overlay[r]))return!1}else if(k.overlay)return!1;return!0}function r(c,h){if(m(c)!=m(h)||k(c)!=k(h)||c.mapping!=h.mapping||c.tier_type!=h.tier_type)return!1;if(c.overlay){if(!h.overlay||h.overlay.length!=c.overlay.length)return!1;for(var w=0;w<c.overlay.length;++w)if(!r(c.overlay[w],
h.overlay[w]))return!1}else if(h.overlay)return!1;return!0}"undefined"!==typeof v&&(v.exports={sourcesAreEqual:r,sourcesAreEqualModuloStyle:h,sourceDataURI:m,sourceStyleURI:k})},{}],37:[function(c,v,u){function m(c,b){if("number"!=typeof c||"number"!=typeof b)throw"Bad range "+c+","+b;this._min=c;this._max=b}function k(c){c=c.sort(B);var b=[],d=c.shift();c.forEach(function(c){c._min<=d._max?c._max>d._max&&(d._max=c._max):(b.push(d),d=c)});b.push(d);this._ranges=b}function h(c,b){c instanceof k||(c instanceof
Array||(c=[c]),c=new k(c));b&&c.insertRange(b);return c}function r(c,b){for(var d=c.ranges(),f=b.ranges(),h=d.length,r=f.length,l=0,t=0,g=[];l<h&&t<r;){c=d[l];b=f[t];var w=Math.max(c.min(),b.min()),a=Math.min(c.max(),b.max());a>=w&&g.push(new m(w,a));c.max()>b.max()?++t:++l}return 0==g.length?null:1==g.length?g[0]:new k(g)}function A(c){var b=0;c=c.ranges();for(var d=0;d<c.length;++d){var f=c[d];b+=f.max()-f.min()+1}return b}function w(c,b){return c.min()<b.min()?-1:c.min()>b.min()?1:c.max()<b.max()?
-1:b.max()>c.max()?1:0}function B(c,b){return c._min<b._min?-1:c._min>b._min?1:c._max<b._max?-1:b._max>c._max?1:0}m.prototype.min=function(){return this._min};m.prototype.max=function(){return this._max};m.prototype.contains=function(c){return c>=this._min&&c<=this._max};m.prototype.isContiguous=function(){return!0};m.prototype.ranges=function(){return[this]};m.prototype._pushRanges=function(c){c.push(this)};m.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};k.prototype.min=function(){return this._ranges[0].min()};
k.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};k.prototype.lower_bound=function(c){var b=this.ranges();if(c>this.max())return b.length;if(c<this.min())return 0;for(var d=0,f=b.length-1;d<=f;){var h=Math.floor((d+f)/2);if(c>b[h]._max)d=h+1;else if(c<b[h]._min)f=h-1;else return h}return d};k.prototype.contains=function(c){var b=this.lower_bound(c);return b<this._ranges.length&&this._ranges[b].contains(c)?!0:!1};k.prototype.insertRange=function(c){var b=this.lower_bound(c._min);
if(b===this._ranges.length)this._ranges.push(c);else{var d=this.ranges();if(c._max<d[b]._min)this._ranges.splice(b,0,c);else{d[b]._min<c._min&&(c._min=d[b]._min);for(var f=b+1;f<d.length&&d[f]._min<=c._max;)f++;f--;d[f]._max>c._max&&(c._max=d[f]._max);this._ranges.splice(b,f-b+1,c)}}};k.prototype.isContiguous=function(){return 1<this._ranges.length};k.prototype.ranges=function(){return this._ranges};k.prototype._pushRanges=function(c){for(var b=0;b<this._ranges.length;++b)c.push(this._ranges[b])};
k.prototype.toString=function(){for(var c="",b=0;b<this._ranges.length;++b)0<b&&(c+=","),c+=this._ranges[b].toString();return c};"undefined"!==typeof v&&(v.exports={Range:m,union:h,intersection:r,coverage:A,rangeOver:w,_rangeOrder:B})},{}],38:[function(c,v,u){function m(c,k,m){this.type=c;this.method=k;this.label=m}function k(c){this._filters={};if(c)for(var h=0;h<c.length;++h)this.add(c[h])}m.prototype.equals=function(c){return this.type==c.type&&this.method==c.method&&this.label==c.label};m.prototype.toString=
function(){var c=[];this.type&&c.push("type="+this.type);this.method&&c.push("method="+this.method);this.label&&c.push("label="+this.label);return"StyleFilter<"+c.join(";")+">"};k.prototype.add=function(c){var h=c.toString();this._filters[h]||(this._filters[h]=c,this._list=null)};k.prototype.addAll=function(c){c=c.list();for(var h=0;h<c.length;++h)this.add(c[h])};k.prototype.doesNotContain=function(c){c=c.list();for(var h=0;h<c.length;++h)if(!this._filters[h.toString()])return!0;return!1};k.prototype.list=
function(){if(!this._list){this._list=[];for(var c in this._filters)this._filters.hasOwnProperty(c)&&this._list.push(this._filters[c])}return this._list};k.prototype.typeList=function(){for(var c=[],k=this.list(),m=0;m<k.length;++m){var w=k[m].type;if(!w||"default"==w)return null;0>c.indexOf(w)&&c.push(w)}return c};"undefined"!==typeof v&&(v.exports={StyleFilter:m,StyleFilterSet:k})},{}],39:[function(c,v,u){if("undefined"!==typeof c){var m=c("./cbrowser").Browser;var k=c("./utils").makeElementNS;
var h=c("./version");var r=c("./sequence-draw").svgSeqTier;v=c("./svg-utils");var A=v.NS_SVG;var w=v.NS_XLINK;var B=v.SVGPath;v=c("./numformats");var f=v.formatQuantLabel;var b=v.formatLongInt;var d=c("./feature-draw").drawFeatureTier}m.prototype.makeSVG=function(c){c=c||{};var m=c.minTierHeight||20,q=this.featurePanelWidth,l=this.scale;this.featurePanelWidth=c.width||this.featurePanelWidth;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);var t=document.implementation.createDocument(A,
"svg",null),g=k(A,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});t.documentElement.appendChild(g);if(c.banner){var u=k(A,"a",k(A,"text","Graphics from Biodalliance "+h,{x:this.featurePanelWidth+200-100,y:35,strokeWidth:0,fontSize:"12pt",textAnchor:"end",fill:"blue"}));u.setAttribute("xmlns:xlink",w);u.setAttribute("xlink:href","http://www.biodalliance.org/");g.appendChild(u)}c.region&&g.appendChild(k(A,"text",this.chr+":"+b(this.viewStart)+".."+b(this.viewEnd),{x:300,y:35,strokeWidth:0,fontSize:"12pt",
textAnchor:"start"}));u=k(A,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});u=k(A,"clipPath",u,{id:"featureClip"});g.appendChild(u);u=70;for(var a=k(A,"g",null,{}),e=0;e<this.tiers.length;++e){var p=this.tiers[e];p.backupSubtiers=p.subtiers;p.backupOriginHaxx=p.originHaxx;p.backupLayoutHeight=p.layoutHeight;d(p,p.sequenceSource?p.currentSequence:null);var x=k(A,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),J=k(A,"g"),n=u,E=k(A,"rect",null,{x:0,y:n,width:"10000",height:50,
fill:p.background});x.appendChild(E);if(p.sequenceSource){var v=r(p,p.currentSequence);x.appendChild(k(A,"g",v,{transform:"translate(200, "+u+")"}));u+=80}else{if(!p.subtiers)continue;v=(p.glyphCacheOrigin-this.viewStart)*this.scale;var U=!1;for(var S=0;S<p.subtiers.length;++S){u+=3;for(var W=p.subtiers[S],D=[],I=0;I<W.glyphs.length;++I)D.push(W.glyphs[I].toSVG());x.appendChild(k(A,"g",D,{transform:"translate("+(200+v)+", "+u+")"}));if(W.quant){U=!0;D=W.quant;var G=W.height;I=2;40<G&&(I=1+(G/20|0));
var P=G/(I-1),y=(D.max-D.min)/(I-1),H=new B;H.moveTo(205,u);H.lineTo(200,u);H.lineTo(200,u+W.height);H.lineTo(205,u+W.height);for(var N=1;N<I-1;++N)G=N*P,H.moveTo(200,u+G),H.lineTo(203,u+G);J.appendChild(k(A,"path",null,{d:H.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));J.appendChild(k(A,"text",f(D.max),{x:197,y:u+7,textAnchor:"end"}));J.appendChild(k(A,"text",f(D.min),{x:197,y:u+W.height,textAnchor:"end"}));for(N=1;N<I-1;++N)G=N*P,J.appendChild(k(A,"text",f(1*D.max-N*y),{x:197,y:u+
G+3,textAnchor:"end"}))}u+=W.height+3}u-n<m&&(u=n+m)}J.appendChild(k(A,"text","string"===typeof p.config.name?p.config.name:p.dasSource.name,{x:200-(U?20:12),y:(u+n+8)/2,fontSize:"10pt",textAnchor:"end"}));E.setAttribute("height",u-n);a.appendChild(k(A,"g",[x,J]));p.subtiers=p.backupSubtiers;p.originHaxx=p.backupOriginHaxx;p.layoutHeight=p.backupLayoutHeight}if(c.highlights)for(U=this.highlights||[],m=0;m<U.length;++m)G=U[m],(G.chr==this.chr||G.chr=="chr"+this.chr)&&G.min<this.viewEnd&&G.max>this.viewStart&&
(e=(Math.max(G.min,this.viewStart)-this.viewStart)*this.scale,a.appendChild(k(A,"rect",null,{x:200+e,y:70,width:(Math.min(G.max,this.viewEnd)-this.viewStart)*this.scale-e,height:u-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));U=-1;"center"==c.ruler?U=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==c.ruler?U=200:"right"==c.ruler&&(U=200+(this.viewEnd-this.viewStart)*this.scale);0<=U&&a.appendChild(k(A,"line",null,{x1:U,y1:70,x2:U,y2:u,stroke:"blue"}));
g.appendChild(a);t.documentElement.setAttribute("width",this.featurePanelWidth+20+200);t.documentElement.setAttribute("height",u+50);this.featurePanelWidth=q;this.scale=l;return new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./feature-draw":18,"./numformats":27,"./sequence-draw":32,"./svg-utils":40,"./utils":50,"./version":52}],40:[function(c,v,u){function m(){this.ops=[]}m.prototype.moveTo=function(c,h){this.ops.push("M "+c+" "+h)};m.prototype.lineTo=
function(c,h){this.ops.push("L "+c+" "+h)};m.prototype.closePath=function(){this.ops.push("Z")};m.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof v&&(v.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:m})},{}],41:[function(c,v,u){function m(b){r.call(this);this.readiness="Connecting";this.source=b;this.tabixHolder=new B;var d=this,c=h(b.payload);if(c)this.parser=c;else throw"Unsuported tabix payload "+b.payload;if(this.source.blob){b=
new w(this.source.blob);var k=new w(this.source.indexBlob)}else b=new A(this.source.uri,{credentials:this.source.credentials}),k=new A(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials});f(b,k,function(b,f){d.tabixHolder.provide(b);b.fetchHeader(function(b,d){if(b){d=c.createSession(function(){});for(var g=0;g<b.length;++g)d.parse(b[g]);d.flush()}});d.readiness=null;d.notifyReadiness()})}if("undefined"!==typeof c){v=c("./sourceadapters");var k=v.registerSourceAdapterFactory;
var h=v.makeParser;var r=v.FeatureSourceBase;v=c("./bin");var A=v.URLFetchable;var w=v.BlobFetchable;var B=c("./utils").Awaited;var f=c("./tabix").connectTabix}m.prototype=Object.create(r.prototype);m.prototype.fetch=function(b,d,c,f,h,l,k){var g=this;g.busy++;g.notifyActivity();this.tabixHolder.await(function(f){f.fetch(b,d,c,function(a,b){g.busy--;g.notifyActivity();var e=[];b=g.parser.createSession(function(a){e.push(a)});for(var d=0;d<a.length;++d)b.parse(a[d]);b.flush();k(null,e,1E9)})})};m.prototype.getStyleSheet=
function(b){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(b)};m.prototype.getDefaultFIPs=function(b){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(b)};k("tabix",function(b){return{features:new m(b)}})},{"./bin":4,"./sourceadapters":35,"./tabix":42,"./utils":50}],42:[function(c,v,u){function m(){}function k(c,b,d){var f=new m;f.data=c;f.tbi=b;f.tbi.fetch(function(b){if(!b)return d(null,"Couldn't access Tabix");b=A(b,b.byteLength);var c=new Uint8Array(b);if(21578324!=
h(c,0))return d(null,"Not a tabix index");var l=h(c,4);f.format=h(c,8);f.colSeq=h(c,12);f.colStart=h(c,16);f.colEnd=h(c,20);f.meta=h(c,24);f.skip=h(c,28);h(c,32);f.indices=[];var k=36;f.chrToIndex={};f.indexToChr=[];for(var g=0;g<l;++g){for(var m="";;){var a=c[k++];if(0==a)break;m+=String.fromCharCode(a)}f.chrToIndex[m]=g;0==m.indexOf("chr")?f.chrToIndex[m.substring(3)]=g:f.chrToIndex["chr"+m]=g;f.indexToChr.push(m)}m=1E9;for(a=0;a<l;++a){var e=k,p=h(c,k);k+=4;for(g=0;g<p;++g){h(c,k);var x=h(c,k+
4);k+=8+16*x}x=h(c,k);var q=k+=4;for(g=0;g<x;++g){var n=r(c,q);q+=8;if(n){g=n.block;0<n.offset&&(g+=65536);g<m&&(m=g);break}}k+=8*x;0<p&&(f.indices[a]=new Uint8Array(b,e,k-e))}f.headerMax=m;d(f)},{timeout:5E4})}if("undefined"!==typeof c){c("./spans");var h=c("./bin").readInt;c=c("./lh3utils");var r=c.readVob;var A=c.unbgzf;var w=c.reg2bins;var B=c.Chunk}m.prototype.blocksForRange=function(c,b,d){var f=this.indices[c];if(!f)return[];c=w(b,d);for(var k=[],m=0;m<c.length;++m)k[c[m]]=!0;c=[];var l=[];
m=h(f,0);for(var t=4,g=0;g<m;++g){var u=h(f,t),a=h(f,t+4);t+=8;if(k[u])for(var e=0;e<a;++e){var p=r(f,t),x=r(f,t+8);(4681>u?l:c).push(new B(p,x));t+=16}else t+=16*a}m=h(f,t);k=null;d=Math.min(d>>14,m-1);for(m=Math.min(b>>14,m-1);m<=d;++m)(b=r(f,t+4+8*m))&&(!k||b.block<k.block||b.offset<k.offset)&&(k=b);b=[];if(null!=k)for(m=0;m<l.length;++m)f=l[m],f.maxv.block>=k.block&&f.maxv.offset>=k.offset&&b.push(f);l=b;b=[];for(m=0;m<l.length;++m)b.push(l[m]);for(m=0;m<c.length;++m)b.push(c[m]);b.sort(function(a,
b){var e=a.minv.block-b.minv.block;return 0!=e?e:a.minv.offset-b.minv.offset});c=[];if(0<b.length){l=b[0];for(m=1;m<b.length;++m)f=b[m],f.minv.block==l.maxv.block?l=new B(l.minv,f.maxv):(c.push(l),l=f);c.push(l)}return c};m.prototype.fetch=function(c,b,d,h){function f(){if(q>=m.length)return h(g);if(a){var e=new Uint8Array(a);k.readRecords(e,m[q].minv.offset,g,b,d,l);a=null;++q;return f()}var c=m[q];e=c.minv.block;k.data.slice(e,c.maxv.block+65536-e).fetch(function(b){a=A(b,c.maxv.block-c.minv.block+
1);return f()})}var k=this;c=this.chrToIndex[c];if(void 0==c)return h([]);var l=this.indexToChr[c];if(void 0===c)var m=[];else(m=this.blocksForRange(c,b,d))||h(null,"Error in index fetch");var g=[],q=0,a;f()};m.prototype.readRecords=function(c,b,d,h,k,m){a:for(;;){for(var f="";b<c.length;){var q=c[b++];if(10==q){q=f.split("\t");if(q[this.colSeq-1]==m){var g=parseInt(q[this.colStart-1]),r=g;0<this.colEnd&&(r=parseInt(q[this.colEnd-1]));this.format&65536&&++g;g<=k&&r>=h&&d.push(f)}continue a}else f+=
String.fromCharCode(q)}break}};m.prototype.fetchHeader=function(c){var b=this;b.data.slice(0,b.headerMax).fetch(function(d){if(!d)return c(null,"Fetch failed");d=new Uint8Array(A(d,d.byteLength));for(var f=0,h="",k=[];f<d.length;){var l=d[f++];if(10==l)if(h.charCodeAt(0)==b.meta)k.push(h),h="";else return c(k);else h+=String.fromCharCode(l)}c(k)})};"undefined"!==typeof v&&(v.exports={connectTabix:k,TABIX_MAGIC:21578324})},{"./bin":4,"./lh3utils":24,"./spans":37}],43:[function(c,v,u){function m(b){this.genomes=
{};this.url=b}function k(){}function h(b){this.hub=b}function r(b,c,d){d=d||{};d.salt=!0;w(b,function(g,a){if(a)return c(null,a);g=g.split(z);var e=new m(b);d.credentials&&(e.credentials=d.credentials);for(a=0;a<g.length-2;a+=3)e[g[a+1]]=g[a+2];if(e.genomesFile){var f=B(b,e.genomesFile);w(f,function(a,b){if(b)return c(null,b);a=a.split(q);for(b=0;b<a.length;++b){var g=a[b].split(z),l=new h(e);d.credentials&&(l.credentials=d.credentials);for(var p=0;p<g.length-2;p+=3)l[g[p+1]]=g[p+2];l.twoBitPath&&
(l.twoBitPath=B(f,l.twoBitPath));l.genome&&l.trackDb&&(l.absURL=B(f,l.trackDb),e.genomes[l.genome]=l)}c(e)},d)}else c(null,"No genomesFile")},d)}function A(b,d){return b.priority&&d.priority?1*b.priority-1*d.priority:b.priority?1:d.priority?-1:b.shortLabel.localeCompare(d.shortLabel)}if("undefined"!==typeof c){u=c("./utils");var w=u.textXHR;var B=u.relativeURL;var f=u.shallowCopy;c=c("./das");var b=c.DASStylesheet;var d=c.DASStyle}var q=/\n\s*\n/,z=/(\w+) +(.+)\n?/,C=/subGroup[1-9]/;k.prototype.get=
function(b){if(this[b])return this[b];if(this._parent)return this._parent.get(b)};h.prototype.getTracks=function(b){var d=this;if(this._tracks)return b(this._tracks);w(this.absURL,function(c,f){if(f)return b(null,f);c=c.replace("\\\n"," ");f=[];for(var a={},e=c.split(q),g=0;g<e.length;++g){var h=e[g].replace(/\#.*/g,"").split(z);c=new k;c._db=d;for(var l=0;l<h.length-2;l+=3){var n=h[l+1];var m=h[l+2];if(n.match(C)){c.subgroups||(c.subgroups={});n=m.split(/\s/);m=n[0];for(var r={name:n[1],tags:[],
titles:[]},t=2;t<n.length;++t){var w=n[t].split(/=/);r.tags.push(w[0]);r.titles.push(w[1])}c.subgroups[m]=r}else if("subGroups"===n)for(n=m.split(/(\w+)=(\w+)/),c.sgm={},t=0;t<n.length-2;t+=3)c.sgm[n[t+1]]=n[t+2];else c[h[l+1]]=h[l+2]}c.track&&(c.type||c.container||c.view||c.bigDataUrl)&&(f.push(c),a[c.track]=c)}e=[];g=[];for(n=0;n<f.length;++n)c=f[n],h=!0,c.parent&&(l=c.parent.split(/\s+/),(m=a[l[0]])?(c._parent=m,m.children||(m.children=[]),m.children.push(c),m&&(h=!1)):console.log("Couldn't find parent "+
l[0]+"("+c.parent+")")),c.compositeTrack?g.push(c):h&&e.push(c);for(f=0;f<g.length;++f)if(a=g[f],a.children){c=!1;for(h=0;h<a.children.length;++h)n=a.children[h],n.view&&(n.shortLabel=a.shortLabel+": "+n.shortLabel,e.push(n),c=!0);c||e.push(a)}d._tracks=e;return b(d._tracks,null)},{credentials:this.credentials,salt:!0})};k.prototype.toDallianceSource=function(){var b={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(b.mapping=this._db.mapping);var c=this.get("pennantIcon");c&&(c=c.split(/\s+/),
b.pennant="http://genome.ucsc.edu/images/"+c[0]);if(c=this.get("searchTrix"))b.trixURI=B(this._db.absURL,c);if("multiWig"==this.container){b.merge="concat";b.overlay=[];c=this.children||[];b.style=[];b.noDownsample=!0;for(var d=0;d<c.length;++d){var f=c[d],a=f.toDallianceSource();b.overlay.push(a);if(a.style)for(var e=0;e<a.style.length;++e){var h=a.style[e];h.method=f.shortLabel;"transparentOverlay"==this.aggregate&&(h.style.ALPHA=.5);b.style.push(h)}}return b}c=this.type;if(!c){for(c=this;c._parent&&
!c.type;)c=c._parent;c=c.type}if(c){d=c.split(/\s+/);if("bigBed"==d[0]&&this.bigDataUrl)return c=d[1]|0,d="+"==d[2],b.bwgURI=B(this._db.absURL,this.bigDataUrl),b.style=this.bigbedStyles(),this._db.credentials&&(b.credentials=!0),12<=c&&d&&(b.collapseSuperGroups=!0),b;if("bigWig"==d[0]&&this.bigDataUrl)return b.bwgURI=B(this._db.absURL,this.bigDataUrl),b.style=this.bigwigStyles(),b.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(b.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:
0),this._db.credentials&&(b.credentials=!0),b;if("bam"==d[0]&&this.bigDataUrl)return b.bamURI=B(this._db.absURL,this.bigDataUrl),this._db.credentials&&(b.credentials=!0),b;if("vcfTabix"==d[0]&&this.bigDataUrl)return b.uri=B(this._db.absURL,this.bigDataUrl),b.tier_type="tabix",b.payload="vcf",this._db.credentials&&(b.credentials=!0),b;console.log("Unsupported "+this.type)}};k.prototype.bigwigStyles=function(){var c=this.type;if(!c){for(c=this;c._parent&&!c.type;)c=c._parent;c=c.type}if(c){c=c.split(/\s+/);
if(3<=c.length){var f=1*c[1];var g=1*c[2]}var h;this.maxHeightPixels&&(c=this.maxHeightPixels.split(/:/),3==c.length?h=c[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));c="bars";this.graphTypeDefault&&(c=this.graphTypeDefault);var a="black",e=null;this.color&&(a="rgb("+this.color+")");this.altColor&&(e="rgb("+this.altColor+")");var p=new b,k=new d;k.glyph="points"==c?"POINT":"HISTOGRAM";e?(k.COLOR1=a,k.COLOR2=e):k.BGCOLOR=a;k.HEIGHT=h||30;if(f||g)k.MIN=f,k.MAX=g;p.pushStyle({type:"default"},
null,k);return p.styles}};k.prototype.bigbedStyles=function(){var c="on"==(""+this.get("itemRgb")).toLowerCase(),h=this.get("visibility")||"full",g=this.get("color");g=g?"rgb("+g+")":"blue";var k=new b,a=new d;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR=g;a.HEIGHT="full"==h||"pack"==h?12:8;a.BUMP="full"==h||"pack"==h;a.LABEL="full"==h||"pack"==h;a.ZINDEX=20;c&&(a.BGITEM=!0);(h=this.get("colorByStrand"))?(h=h.split(/\s+/),g=f(a),g.BGCOLOR="rgb("+h[0]+")",k.pushStyle({type:"bigbed",orientation:"+"},null,
g),a=f(a),a.BGCOLOR="rgb("+h[1]+")",k.pushStyle({type:"bigbed",orientation:"-"},null,a)):k.pushStyle({type:"bigbed"},null,a);a=new d;a.glyph="BOX";a.FGCOLOR="black";c&&(a.BGITEM=!0);a.BGCOLOR="red";a.HEIGHT=10;a.BUMP=!0;a.ZINDEX=20;k.pushStyle({type:"translation"},null,a);c=new d;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="white";c.HEIGHT=10;c.ZINDEX=10;c.BUMP=!0;c.LABEL=!0;k.pushStyle({type:"transcript"},null,c);return k.styles};"undefined"!==typeof v&&(v.exports={connectTrackHub:r,THUB_COMPARE:A})},
{"./das":10,"./utils":50}],44:[function(c,v,u){if("undefined"!==typeof c){var m=c("./cbrowser").Browser;var k=c("./utils").shallowCopy}m.prototype.mergeSelectedTiers=function(){for(var c=[],m=[],u=0;u<this.selectedTiers.length;++u){var w=this.tiers[this.selectedTiers[u]];c.push(k(w.dasSource));for(var v=w.stylesheet.styles,f=0;f<v.length;++f){var b=v[f],d=k(b);d.method=w.dasSource.name.replace(/[()+*?]/g,"\\$&");d._methodRE=null;d.style=k(b.style);void 0===d.style.ZINDEX&&(d.style.ZINDEX=u);w.forceMin&&
(d.style.MIN=w.forceMin);w.forceMax&&(d.style.MAX=w.forceMax);m.push(d)}}this.addTier({name:"Merged",merge:"concat",overlay:c,noDownsample:!0,style:m});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":50}],45:[function(c,v,u){function m(b){for(var c=0;c<b.styles.length;++c){var f=b.styles[c].style;if("__SEQUENCE"===f.glyph)return f}}if("undefined"!==typeof c){var k=c("./cbrowser").Browser;var h=c("./utils").makeElement;v=c("./das");var r=v.isDasBooleanTrue;var A=v.copyStylesheet;
var w=c("./color").dasColourForName;var B=c("./sourcecompare").sourceDataURI}var f={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};k.prototype.openTierPanel=function(b){if("tier"===this.uiMode&&this.manipulatingTier===b)this.hideToolPanel(),this.setUiMode("none");else if(b){var c=function(a){a.BGGRAD||(1==S?("LINEPLOT"==a.glyph||f[a.glyph]?a.FGCOLOR=x.value:a.BGCOLOR=x.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=x.value,a.COLOR2=J.value,a.COLOR3=2<S?n.value:null),a._gradient=
null,a._plusColor=E.value,a._minusColor=T.value)},k=function(a){for(var c=A(b.stylesheet),e=b.browser.zoomForCurrentScale(),d=0;d<c.styles.length;++d){var g=c.styles[d];g.zoom&&g.zoom!=e||a(g.style)}return c},z=function(a){b.mergeStylesheet(k(c))};this.manipulatingTier=b;var u=h("div",null,{className:"tier-edit"}),l=h("div","About '"+(b.config.Name||b.dasSource.name)+"'",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});u.appendChild(l);l=h("div",[h("p",b.dasSource.desc)]);
var t=[],g=B(b.dasSource);!g||0!=g.indexOf("http://")&&0!=g.indexOf("https://")&&0!=g.indexOf("//")||"https://www.biodalliance.org/magic/no_uri"===g||t.push(h("li",h("a","(Download data)",{href:g})));b.dasSource.mapping&&(g=this.chains[b.dasSource.mapping].coords,t.push(h("li","Mapped from "+g.auth+g.version)));0<t.length&&l.appendChild(h("ul",t));u.appendChild(l);var v=h("span"," (styles for current zoom level)",null,{display:"none"});l=h("div",["Edit",v],null,{background:"gray",paddingBottom:"5px",
marginBottom:"5px",textAlign:"center"});u.appendChild(l);var a=h("input",null,{type:"text"}),e=h("input",null,{type:"checkbox",disabled:this.disablePinning}),p=h("select");p.appendChild(h("option","Histogram",{value:"HISTOGRAM"}));p.appendChild(h("option","Line Plot",{value:"LINEPLOT"}));p.appendChild(h("option","Ribbon",{value:"GRADIENT"}));p.appendChild(h("option","Scatter",{value:"SCATTER"}));var x=h("input",null,{type:"text",value:"#dd00dd"}),J=h("input",null,{type:"text",value:"#dd00dd"}),n=
h("input",null,{type:"text",value:"#dd00dd"}),E=h("input",null,{type:"text",value:"#ffa07a"}),T=h("input",null,{type:"text",value:"#87cefa"});try{x.type=J.type=n.type="color",E.type=T.type="color"}catch(ta){}var U=[x,J,n];l=h("i",null,{className:"fa fa-plus-circle"});t=h("i",null,{className:"fa fa-minus-circle"});var S=1;g=h("td",U);var W=function(a){S=a;for(var b=0;b<a;++b)U[b].style.display="block";for(b=a;b<U.length;++b)U[b].style.display="none"};l.addEventListener("click",function(a){3>S&&(W(S+
1),z(null))},!1);t.addEventListener("click",function(a){1<S&&(W(S-1),z(null))},!1);var D=h("input",null,{type:"text",value:"0.0"}),I=h("input",null,{type:"text",value:"10.0"}),G=h("input",null,{type:"checkbox"}),P=h("input",null,{type:"checkbox"}),y=h("input",null,{type:"checkbox",checked:void 0!==b.quantLeapThreshold}),H=h("input",null,{type:"text",value:b.quantLeapThreshold,disabled:!y.checked}),N=h("input",null,{type:"text",value:"50"}),Q=h("input",null,{type:"checkbox"}),O=h("input",null,{type:"text"}),
Z=h("input",null,{type:"checkbox"}),Y=null;0<b.stylesheet.styles.length&&(Y=b.stylesheet.styles[0].style);var na=function(){var c;a.value="string"===typeof b.config.name?b.config.name:b.dasSource.name;e.checked=b.pinned;b.forceHeight?N.value=""+b.forceHeight:Y&&Y.HEIGHT&&(N.value=""+Y.HEIGHT);"number"==typeof b.quantLeapThreshold?(y.checked=!0,H.disabled=!1,parseFloat(H.value)!=b.quantLeapThreshold&&(H.value=b.quantLeapThreshold)):(y.checked=!1,H.disabled=!0);O.value="number"==typeof b.subtierMax?
""+b.subtierMax:""+(b.dasSource.subtierMax||b.browser.defaultSubtierMax);if(0<b.stylesheet.styles.length){var d=null;var g=!1;var f=b.browser.zoomForCurrentScale();for(var h=c=0;h<b.stylesheet.styles.length;++h){var k=b.stylesheet.styles[h];if(!k.zoom||k.zoom==f)if(++c,k=b.stylesheet.styles[h].style,d||(d=Y=k),"LINEPLOT"==k.glyph||"HISTOGRAM"==k.glyph||"GRADIENT"==k.glyph||r(k.SCATTER))g||(d=Y=k),g=!0}if(!d)return;v.style.display=c==b.stylesheet.styles.length?"none":"inline";f=g&&1==c;g?(ja.style.display=
"table-row",qa.style.display="table-row",V.style.display="none",ca.style.display="none"):(ja.style.display="none",qa.style.display="none",V.style.display="table-row",Q.checked=r(Y.BUMP),O.disabled=!r(Y.BUMP),ca.style.display="table-row",Z.checked=r(Y.LABEL));f?(X.style.display="table-row",K.style.display="table-row"):(X.style.display="none",K.style.display="none");c=1;d.COLOR1?(x.value=w(d.COLOR1).toHexString(),d.COLOR2&&(J.value=w(d.COLOR2).toHexString(),d.COLOR3?(n.value=w(d.COLOR3).toHexString(),
c=3):c=2)):"LINEPLOT"==d.glyph||"DOT"==d.glyph&&d.FGCOLOR?x.value=w(d.FGCOLOR).toHexString():d.BGCOLOR&&(x.value=w(d.BGCOLOR).toHexString());W(c);d._plusColor&&(E.value=w(d._plusColor).toHexString()||d._plusColor);d._minusColor&&(T.value=w(d._minusColor).toHexString()||d._minusColor);r(d.SCATTER)?p.value="SCATTER":p.value=d.glyph;var l,q;void 0!==d.MIN&&(c=parseFloat(d.MIN),isNaN(c)||(l=c));b.forceMinDynamic||void 0===d.MIN&&void 0===b.forceMin?(G.checked=!1,D.disabled=!0):(G.checked=!0,D.disabled=
!1);void 0!==d.MAX&&(c=parseFloat(d.MAX),isNaN(c)||(q=c));b.forceMaxDynamic||void 0===d.MAX&&void 0===b.forceMax?(P.checked=!1,I.disabled=!0):(P.checked=!0,I.disabled=!1);void 0!=b.forceMin&&(l=b.forceMin);void 0!=b.forceMax&&(q=b.forceMax);"number"==typeof l&&l!=parseFloat(D.value)&&(D.value=l);"number"==typeof q&&q!=parseFloat(I.value)&&(I.value=q);(d=m(b.stylesheet))?(ea.style.display="table-row",aa.checked="mismatch"===d.__SEQCOLOR,fa.style.display="table-row",R.checked=r(d.__INSERTIONS),ha.style.display=
"table-row",ba.checked=void 0===d.__disableQuals||!1===d.__disableQuals,console.log(d.__disableQuals)):(ea.style.display="none",fa.style.display="none",ha.style.display="none");d&&aa.checked&&!f?(da.style.display="table-row",pa.style.display="table-row"):(da.style.display="none",pa.style.display="none")}g&&b.browser.sourceAdapterIsCapable(b.featureSource,"quantLeap")?ra.style.display="table-row":ra.style.display="none"},aa=h("input",null,{type:"checkbox"}),ea=h("tr",[h("th","Highlight mismatches & strands"),
h("td",aa)]);aa.addEventListener("change",function(a){a=A(b.stylesheet);m(a).__SEQCOLOR=aa.checked?"mismatch":"base";b.mergeStylesheet(a)});var R=h("input",null,{type:"checkbox"}),fa=h("tr",[h("th","Show insertions"),h("td",R)]);R.addEventListener("change",function(a){a=A(b.stylesheet);m(a).__INSERTIONS=R.checked?"yes":"no";b.mergeStylesheet(a)});var ba=h("input",null,{type:"checkbox"}),ha=h("tr",[h("th","Reflect base quality as base color transparency"),h("td",ba)]);ba.addEventListener("change",
function(a){a=A(b.stylesheet);var c=m(a);c.__disableQuals=!ba.checked;console.log(c.__disableQuals);b.mergeStylesheet(a)});var X=h("tr",[h("th","Style"),h("td",p)]),K=h("tr",[h("th",["Colour(s)",l,t]),g]),da=h("tr",[h("th","Plus Strand Color"),h("td",E)]),pa=h("tr",[h("th","Minus Strand Color"),h("td",T)]),ja=h("tr",[h("th","Min value"),h("td",[G," ",D])]),qa=h("tr",[h("th","Max value"),h("td",[P," ",I])]),ra=h("tr",[h("th","Threshold leap:"),h("td",[y," ",H])]),V=h("tr",[h("th","Bump overlaps"),
h("td",[Q," limit: ",O])]),ca=h("tr",[h("th","Label features"),h("td",Z)]);l=h("table",[h("tr",[h("th","Name",{},{width:"150px",textAlign:"right"}),a]),h("tr",[h("th","Pin to top"),e]),h("tr",[h("th","Height"),h("td",N)]),X,K,da,pa,ja,qa,ra,V,ca,ea,fa,ha]);na();u.appendChild(l);l=h("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});l.addEventListener("click",function(a){b.setConfig({})},!1);u.appendChild(l);a.addEventListener("input",function(c){b.mergeConfig({name:a.value})},
!1);e.addEventListener("change",function(a){b.mergeConfig({pinned:e.checked})},!1);for(l=0;l<U.length;++l)U[l].addEventListener("change",z,!1);E.addEventListener("change",z,!1);T.addEventListener("change",z,!1);p.addEventListener("change",function(a){a=k(function(a){"SCATTER"===p.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=p.value,a.SCATTER=void 0);c(a)});b.mergeStylesheet(a)},!1);G.addEventListener("change",function(a){a={forceMinDynamic:!G.checked};D.disabled=!G.checked;var c=parseFloat(D.value);
G.checked&&"number"==typeof c&&!isNaN(c)&&(a.forceMin=parseFloat(c));b.mergeConfig(a)});D.addEventListener("input",function(a){a=parseFloat(D.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMin:a})},!1);P.addEventListener("change",function(a){a={forceMaxDynamic:!P.checked};I.disabled=!P.checked;var c=parseFloat(I.value);P.checked&&"number"==typeof c&&!isNaN(c)&&(a.forceMax=parseFloat(c));b.mergeConfig(a)});I.addEventListener("input",function(a){a=parseFloat(I.value);"number"!=typeof a||isNaN(a)||
b.mergeConfig({forceMax:a})},!1);N.addEventListener("input",function(a){a=parseFloat(N.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({height:Math.min(500,a|0)})},!1);var M=function(){H.disabled=!y.checked;if(y.checked){var a=parseFloat(H.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({quantLeapThreshold:parseFloat(H.value)})}else b.mergeConfig({quantLeapThreshold:null})};y.addEventListener("change",function(a){M()},!1);H.addEventListener("input",function(a){M()},!1);Z.addEventListener("change",
function(a){a=k(function(a){a.LABEL=Z.checked?"yes":"no"});b.mergeStylesheet(a)},!1);Q.addEventListener("change",function(a){a=k(function(a){a.BUMP=Q.checked?"yes":"no"});b.mergeStylesheet(a)},!1);O.addEventListener("input",function(a){a=parseInt(O.value);"number"==typeof a&&0<a&&b.mergeConfig({subtierMax:a})},!1);this.showToolPanel(u);this.setUiMode("tier");b.addTierListener(na);var ma=b.browser.scale;b.browser.addViewListener(function(){b.browser.scale!=ma&&(ma=b.browser.scale,na())})}}},{"./cbrowser":6,
"./color":9,"./das":10,"./sourcecompare":36,"./utils":50}],46:[function(c,v,u){function m(b,c,a,e){this.config=a||{};this.id="tier"+ ++C;this.browser=b;this.dasSource=r(c);this.background=e;this.viewport=k("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=k("div",this.viewport,{className:"viewport-holder_12_5"},{background:e,position:"absolute",padding:"0px",margin:"0px",
border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=k("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=k("div","",{className:"notifier"});this.notifierHolder=k("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=k("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=k("i",null,{className:"fa fa-times"});this.bumpButton=k("i",null,{className:"fa fa-plus-circle"});this.loaderButton=
b.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=k("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=k("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);c.pennant?this.nameButton.appendChild(k("img",null,{src:c.pennant,width:"16",height:"16"})):c.mapping&&(a=null,this.browser.chains[c.mapping]&&(a=this.browser.chains[c.mapping].coords.version),a&&this.nameButton.appendChild(k("span",""+a,null,{fontSize:"8pt",background:"black",
color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=k("span",c.name);this.nameButton.appendChild(k("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=k("span",[this.nameButton],{className:"btn-group track-label"});this.row=k("div",[this.viewportHolder,this.overlay,this.quantOverlay],
{className:"tier"+(c.className?" "+c.className:"")});e||(this.row.style.background="none");b.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;c.quantLeapThreshold&&(this.quantLeapThreshold=c.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;c.featureInfoPlugin&&this.addFeatureInfoPlugin(c.featureInfoPlugin);this.initSources();var d=this;this.featureSource&&
this.featureSource.getDefaultFIPs&&!c.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&d.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&(this.readinessListener=function(a){d.notify(a,-1)},this.featureSource.addReadinessListener(this.readinessListener));this.featureSource&&this.featureSource.addActivityListener&&(this.activityListener=function(a){d.loaderButton.style.display=0<a?"inline-block":"none";d.browser.pingActivity()},this.featureSource.addActivityListener(this.activityListener));
this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof c){u=c("./utils");var k=u.makeElement;var h=u.removeChildren;var r=u.shallowCopy;var A=u.miniJSONify;var w=u.arrayIndexOf;u=c("./das");var B=u.DASStylesheet;var f=u.DASStyle;var b=c("./sha1").b64_sha1;u=c("./style");var d=u.StyleFilter;var q=u.StyleFilterSet;var z=c("./sourcecompare").sourceDataURI}var C=0;m.prototype.destroy=function(){this.featureSource.removeReadinessListener&&this.featureSource.removeReadinessListener(this.readinessListener);
this.featureSource.removeActivityListener&&this.featureSource.removeActivityListener(this.activityListener)};m.prototype.setBackground=function(b){this.background=b;this.viewportHolder.style.background=b};m.prototype.toString=function(){return this.id};m.prototype.addFeatureInfoPlugin=function(b){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};m.prototype.init=function(){var b=this;b.dasSource.style?(this.setStylesheet({styles:b.dasSource.style}),this.browser.refreshTier(this)):
(b.status="Fetching stylesheet",b.fetchStylesheet(function(c,a){a||!c?(b.error="No stylesheet",c=new B,a=new f,a.glyph="BOX",a.BGCOLOR="blue",a.FGCOLOR="black",c.pushStyle({type:"default"},null,a),b.setStylesheet(c)):(b.setStylesheet(c),c.geneHint&&(b.dasSource.collapseSuperGroups=!0,b.bumped=!1,b.updateLabel()),b._updateFromConfig());b.browser.refreshTier(b)}))};m.prototype.setStylesheet=function(c){this.baseStylesheet=r(c);for(c=0;c<this.baseStylesheet.styles.length;++c){var d=this.baseStylesheet.styles[c]=
r(this.baseStylesheet.styles[c]);d._methodRE=d._labelRE=d._typeRE=null;d.style=r(d.style);d.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=b(A(this.baseStylesheet));this._updateFromConfig()};m.prototype.getSource=function(){return this.featureSource};m.prototype.getDesiredTypes=function(b){if(b=this.getActiveStyleFilters(b))return b.typeList()};m.prototype.getActiveStyleFilters=function(b){b=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var c=new q,a=this.stylesheet.styles,
e=0;e<a.length;++e){var g=a[e];g.zoom&&g.zoom!=b||c.add(new d(g.type,g.method,g.label))}return c}};m.prototype.needsSequence=function(b){return this.sequenceSource&&5>b||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>b?!0:!1};m.prototype.viewFeatures=function(b,c,a,e,d){this.currentFeatures=e;this.currentSequence=d;this.notifyFeaturesLoaded();this.knownChr=b;this.knownCoverage=c;this.status&&(this.status=null,this._notifierToStatus());this.draw()};
m.prototype.draw=function(){var b=this.currentSequence;this.sequenceSource?t(this,b):l(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};m.prototype.findNextFeature=function(b,c,a,e,d){if(this.quantLeapThreshold)this.featureSource.quantFindNextFeature(b,c+(this.browser.viewEnd-this.browser.viewStart+1)*a/2|0,a,this.quantLeapThreshold,d);else{if(this.knownCoverage&&c>=this.knownCoverage.min()&&c<=this.knownCoverage.max()&&this.currentFeatures){for(var g=null,f=0;f<this.currentFeatures.length;++f){var h=
this.currentFeatures[f];if(h.min&&h.max&&!(h.parents&&0<h.parents.length))if(0>a)if(1==e&&h.max>=c&&h.min<c){if(!g||h.min>g.min||h.min==g.min&&h.max<g.max)g=h}else h.max<c&&(!g||h.max>g.max||h.max==g.max&&h.min<g.min||h.min==g.mmin&&g.max>=c)&&(g=h);else if(1==e&&h.min<=c&&h.max>c){if(!g||h.max<g.max||h.max==g.max&&h.min>g.min)g=h}else h.min>c&&(!g||h.min<g.min||h.min==g.min&&h.max>g.max||h.max==g.max&&g.min<=c)&&(g=h)}if(g)return d(g);c=0>a?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(b,
c,a,d)}};m.prototype.trySourceFNF=function(b,c,a,e){var d=this;this.featureSource.findNextFeature(b,c,a,function(b){b||e(b);var c=d.browser.getSequenceSource();c||e(b);c.getSeqInfo(b.segment,function(c){c?e(b):d.trySourceFNF(b.segment,0<a?1E10:0,a,e)})})};m.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};m.prototype.updateHeight=function(){this.currentHeight=
Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};m.prototype.drawOverlay=function(){var b=this.browser,c=b.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=c?2*b.featurePanelWidth:b.featurePanelWidth;var a=this.overlay.getContext("2d");c&&a.scale(2,2);var e=c=b.viewStart,d=b.viewEnd;if(this.overlayLabelCanvas){var f=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale;a.save();a.translate(f,0);var h=-f+2;this.dasSource.tierGroup&&(h+=15);this.overlayLabelCanvas.draw(a,h,b.featurePanelWidth-f);a.restore()}for(f=0;f<b.highlights.length;++f)h=b.highlights[f],(h.chr===b.chr||h.chr==="chr"+b.chr)&&h.min<d&&h.max>e&&(a.globalAlpha=b.defaultHighlightAlpha,a.fillStyle=b.defaultHighlightFill,a.fillRect((h.min-c)*b.scale,0,(h.max-h.min)*b.scale,this.overlay.height));this.overlay.style.width=b.featurePanelWidth;this.overlay.style.height=
this.viewport.style.height;this.overlay.style.left="0px"};m.prototype.updateStatus=function(b){var c=this;b?(this.status=b,this._notifierToStatus(),z(this.dasSource),"https:"!==window.location.protocol||0!=z(this.dasSource).indexOf("http:")||this.checkedHTTP||(this.checkedHTTP=!0,this.browser.canFetchPlainHTTP().then(function(a){a||(c.warnHTTP=!0,c._notifierToStatus())}))):this.status&&(this.status=null,this._notifierToStatus())};m.prototype.notify=function(b,c){"number"!==typeof c&&(c=2E3);this.notifierFadeTimeout&&
(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(b){if(this._notifierOn(b),0<c){var a=this;this.notifierFadeTimeout=setTimeout(function(){a._notifierToStatus()},c)}}else this._notifierToStatus()};m.prototype._notifierOn=function(b,c){h(this.notifier);c?this.notifier.appendChild(k("span",[k("a","[HTTP Warning] ",{href:this.browser.httpWarningURL,target:"_blank"}),b])):this.notifier.textContent=b;this.notifier.style.opacity=.8};m.prototype._notifierOff=function(){this.notifier.style.opacity=
0};m.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status,this.warnHTTP):this._notifierOff()};m.prototype.setConfig=function(b){this.config=b||{};this._updateFromConfig();this.notifyTierListeners()};m.prototype.mergeStylesheet=function(b){this.mergeConfig({stylesheet:b,stylesheetValidity:this.baseStylesheetValidity})};m.prototype.mergeConfig=function(b){for(var c in b)this.config[c]=b[c];this._updateFromConfig();this.notifyTierListeners()};m.prototype._updateFromConfig=
function(){var b=!1,c=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var a=this.config.height||this.dasSource.forceHeight;a!=this.forceHeight&&(this.forceHeight=a,b=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,b=!0);a=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=a&&(this.forceMin=a,b=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&
(this.forceMaxDynamic=this.config.forceMaxDynamic,b=!0);a=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=a&&(this.forceMax=a,b=!0);a=null;void 0!==this.config.quantLeapThreshold?a=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(a=this.dasSource.quantLeapThreshold);a!=this.quantLeapThreshold&&(this.quantLeapThreshold=a,b=!0);a=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(a=this.config.stylesheet);a=a||this.baseStylesheet;
this.stylesheet!==a&&(this.stylesheet=a,b=!0);a=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;a!==this.pinned&&(this.pinned=a,c=!0);a=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;a!=this.subtierMax&&(this.subtierMax=a,b=!0);a=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;a!==this.bumped&&(this.bumped=a,b=
!0,this.updateLabel());b&&this.scheduleRedraw();c&&this.browser.reorderTiers()};m.prototype.scheduleRedraw=function(){if(this.currentFeatures){var b=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){b.draw();b.redrawTimeout=null},10))}};m.prototype.clearTierListeners=function(){this.listeners=[]};m.prototype.addTierListener=function(b){this.listeners.push(b)};m.prototype.removeTierListener=function(b){b=w(this.listeners,b);0<=b&&this.listeners.splice(b,1)};m.prototype.notifyTierListeners=
function(b){for(var c=0;c<this.listeners.length;++c)try{this.listeners[c](b)}catch(a){console.log(a)}this.browser.notifyTier()};m.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};m.prototype.addFeaturesLoadedListener=function(b){this.featuresLoadedListeners.push(b)};m.prototype.removeFeaturesLoadedListener=function(b){b=w(this.featuresLoadedListeners,b);0<=b&&this.featuresLoadedListeners.splice(b,1)};m.prototype.notifyFeaturesLoaded=function(){for(var b=0;b<this.featuresLoadedListeners.length;++b)try{this.featuresLoadedListeners[b].call(this)}catch(F){console.log(F)}};
if("undefined"!==typeof v){v.exports={DasTier:m};var l=c("./feature-draw").drawFeatureTier;var t=c("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./sequence-draw":32,"./sha1":34,"./sourcecompare":36,"./style":38,"./utils":50}],47:[function(c,v,u){function m(a,b){for(var c=0;c<a.length;++c){var e=a[c];e===b?e.classList.add("active"):e.classList.remove("active")}}if("undefined"!==typeof c){var k=c("./cbrowser").Browser;var h=c("./sourcecompare").sourcesAreEqual;v=c("./utils");var r=
v.makeElement;var A=v.removeChildren;var w=v.Observed;v=c("./thub");var B=v.THUB_COMPARE;var f=v.connectTrackHub;var b=c("./domui").makeTreeTableSection;var d=c("./probe").probeResource;v=c("./bin");var q=v.URLFetchable;var z=v.BlobFetchable;var C=v.readInt;var l=c("./lh3utils").unbgzf;var t=c("./bam").BAI_MAGIC;var g=c("./tabix").TABIX_MAGIC;v=c("./das");var F=v.DASSource;var a=v.DASSegment;var e=v.DASRegistry;var p=v.coordsMatch;var x=c("./encode").EncodeFetchable}k.prototype.currentlyActive=function(a){for(var b=
0;b<this.tiers.length;++b)if(h(this.tiers[b].dasSource,a))return this.tiers[b];return!1};k.prototype.makeButton=function(a,b){a=r("a",a,{href:"#"});b&&this.makeTooltip(a,b);return r("li",a)};k.prototype.showTrackAdder=function(c){function h(a){var c;ia.style.display="none";ka.style.display="none";la.style.display="none";V=!1;A(M);for(var e=r("div",null,{},{width:"100%"}),d=[],f=0;f<a.length;++f)d.push(a[f]);d.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});
a=[];var g=[];for(f=0;f<d.length;++f){var h=d[f];h.children&&0<h.children.length&&"multiWig"!=h.container?a.push(h):g.push(h)}0<g.length&&a.push({shortLabel:"Others",priority:-1E8,children:g});a.sort(B);var n=[];for(d=0;d<a.length;++d){h=g=a[d];!h.dimensions&&h._parent&&h._parent.dimensions&&(h=h._parent);f={};if(h.dimensions)for(var k=h.dimensions.split(/(\w+)=(\w+)/),l=0;l<k.length-2;l+=3)f[k[l+1]]=k[l+2];if(f.dimX&&f.dimY){var p=f.dimX;var m=f.dimY;f=h.subgroups[p];k=h.subgroups[m];l={};for(c=
0;c<g.children.length;++c){var x=g.children[c];h=x.sgm[p];var q=x.sgm[m];l[h]||(l[h]={});l[h][q]=x}var t=r("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});h=r("tr");h.appendChild(r("th",null,{},{width:"150px",height:"100px"}));for(p=0;p<f.titles.length;++p)q=r("th",r("div",f.titles[p],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",
height:"100px",verticalAlign:"bottom"}),h.appendChild(q);t.appendChild(h);for(var z=r("tbody",null,{className:"table table-striped table-condensed"}),u=0;u<k.titles.length;++u){q=k.tags[u];var w=r("tr");w.appendChild(r("th",k.titles[u]),{});for(var E=0;E<f.titles.length;++E){h=f.tags[E];var v=r("td");if(l[h]&&l[h][q]){h=l[h][q];x=h.toDallianceSource();if(!x)continue;p=r("tr");c=r("td");c.style.textAlign="center";m=r("input");m.type="checkbox";m.dalliance_source=x;ma&&(m.dalliance_mapping=ma);n.push(m);
v.appendChild(m);m.addEventListener("change",function(a){a.target.checked?y.addTier(a.target.dalliance_source):y.removeTier(a.target.dalliance_source)})}w.appendChild(v)}z.appendChild(w)}t.appendChild(z);e.appendChild(b(g.shortLabel,t,0==d))}else{k=r("tbody",null,{className:"table table-striped table-condensed"});l=r("table",k,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});q=0;g.children.sort(B);for(f=0;f<g.children.length;++f)if(h=g.children[f],x=h.toDallianceSource())p=
r("tr"),c=r("td",null,{},{width:"30px"}),c.style.textAlign="center",m=r("input"),m.type="checkbox",m.dalliance_source=x,ma&&(m.dalliance_mapping=ma),n.push(m),c.appendChild(m),m.addEventListener("change",function(a){a.target.checked?y.addTier(a.target.dalliance_source):y.removeTier(a.target.dalliance_source)}),p.appendChild(c),m=r("td"),m.appendChild(document.createTextNode(h.shortLabel)),h.longLabel&&0<h.longLabel.length&&y.makeTooltip(m,h.longLabel),p.appendChild(m),k.appendChild(p),++q;1<a.length||
"Others"!==g.shortLabel?e.appendChild(b(g.shortLabel,l,0==d)):e.appendChild(l)}}var D=function(){for(var a=0;a<n.length;++a){var b=n[a],c=y.currentlyActive(b.dalliance_source);c?(b.checked=!0,b.disabled=null!=c.sequenceSource):b.checked=!1}};D();y.addTierListener(function(a){D()});M.appendChild(e)}function k(){m(H,fa);V="bin";ia.style.display="none";ka.style.display="inline";la.style.display="none";A(M);var a=r("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(r("h3","Add custom URL-based data"));
a.appendChild(r("p",["You can add indexed binary data hosted on an web server that supports CORS (",r("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(r("br"));a.appendChild(document.createTextNode("URL: "));X=r("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(X);a.appendChild(r("br"));a.appendChild(r("b","- or -"));a.appendChild(r("br"));
a.appendChild(document.createTextNode("File: "));ja=r("input",null,{type:"file",multiple:"multiple"});a.appendChild(ja);a.appendChild(r("p",'Clicking the "Add" button below will initiate a series of test queries.'));M.appendChild(a);X.focus()}function u(){m(H,ba);ia.style.display="none";ka.style.display="inline";la.style.display="none";V="hub-connect";ia.style.visibility="hidden";A(M);var a=r("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(r("h3","Connect to a track hub."));
a.appendChild(r("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));X=r("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(X);M.appendChild(a);X.focus()}function v(){m(H,R);ia.style.display="none";ka.style.display="inline";la.style.display="none";V="das";A(M);var a=r("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(r("h3","Add custom DAS data"));a.appendChild(r("p",
"This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(r("br"));X=r("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(X);a.appendChild(r("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));M.appendChild(a);
X.focus()}function J(){var a;if(V)if("das"===V){var b=X.value.trim();/^.+:\/\//.exec(b)||(b="http://"+b);b=new F({name:"temporary",uri:b});wa(b)}else if("bin"===V)if((a=ja.files)&&0<a.length){b=oa=[];V="multiple";for(var c=0;c<a.length;++c){var e=a[c];e&&b.push({blob:e})}for(c=0;c<b.length;++c)xa(b[c]);ya()}else b=X.value.trim(),/^.+:\/\//.exec(b)||(b="http://"+b),a={uri:b},b=b.toLowerCase(),0==b.indexOf("https://www.encodeproject.org/")&&0<=b.indexOf("@@download")&&(a.transport="encode"),za(a);else if("reset"===
V)v();else if("reset-bin"===V)k();else if("reset-hub"===V)u();else if("prompt-bai"===V)(a=ja.files)&&0<a.length&&a[0]?(ca.baiBlob=a[0],I(ca)):(a=ca,ia.style.display="none",ka.style.display="inline",la.style.display="inline",A(M),V="prompt-bai",M.appendChild(r("h2","Select an index file")),M.appendChild(r("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
M.appendChild(document.createTextNode("Index file: ")),ja=r("input",null,{type:"file"}),M.appendChild(ja),ca=a);else if("prompt-tbi"===V)(a=ja.files)&&0<a.length&&a[0]?(ca.indexBlob=a[0],G(ca)):(a=ca,ia.style.display="none",ka.style.display="inline",la.style.display="inline",A(M),V="prompt-tbi",M.appendChild(r("h2","Select an index file")),M.appendChild(r("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
M.appendChild(document.createTextNode("Index file: ")),ja=r("input",null,{type:"file"}),M.appendChild(ja),ca=a);else if("finalize"===V||"finalize-bin"===V)ca.name=K.value,a=da.value,ca.mapping="__default__"!=a?a:void 0,pa&&(ca.maxbins=pa.checked),1<qa.value.length&&1<ra.value.length&&(ca.xUser=qa.value,ca.xPass=ra.value),y.addTier(ca),"finalize-bin"==V?k():v();else if("hub-connect"===V)b=X.value.trim(),/^.+:\/\//.exec(b)||(b="http://"+b),W(b);else{if("multiple"===V){for(a=0;a<oa.length;++a)if(b=oa[a],
!b.hidden&&("bam"!=b.tier_type||b.indexBlob||b.indexUri)&&("tabix"!=b.tier_type||b.indexBlob||b.indexUri)&&(b=L(b)))b.noPersist=!0,y.addTier(b);k()}}else y.removeAllPopups()}function W(a,b,c){b=b||{};for(var e=0;e<y.hubObjects.length;++e){var d=y.hubObjects[e];if(d.hub.url==a){for(e=0;e<H.length;++e)H[e].hub==d&&m(H,H[e]);d.getTracks(function(a,b){b&&console.log(b);h(a)});return}}f(a,function(e,d){if(d){if(!c)return W(a,{credentials:!0},!0);A(M);M.appendChild(r("h2","Error connecting to track hub"));
M.appendChild(r("p",d));V="reset-hub"}else{var f=d=null,g;for(g in e.genomes){var n=null,k=!1;if(g==y.coordSystem.ucscName)k=!0;else for(var l in y.chains)g==y.chains[l].coords.ucscName&&(n=l,k=!0);k&&(k={url:a,genome:g},b.credentials&&(k.credentials=!0),n&&(k.mapping=n,e.genomes[g].mapping=n),y.hubs.push(k),y.hubObjects.push(e.genomes[g]),k=na(e.genomes[g]),ha.appendChild(k),n&&d||(d=e.genomes[g],f=k))}d?(y.notifyTier(),m(H,f),d.getTracks(function(a,b){h(a)})):(A(M),M.appendChild(r("h2","No data for this genome")),
M.appendChild(r("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),M.appendChild(r("p","coordSystem.ucscName = "+y.coordSystem.ucscName)),V="reset-hub")}},b)}function D(a,b){var c=a.uri;if(b){var d=/(.+)\/[^\/]+\/?/.exec(c);d&&(c=d[1]+"/sources")}(new e(c,{credentials:a.credentials})).sources(function(c){if(!c||0==c.length)return b?sa(a):D(a,!0);var e=null;if(1==c.length)e=c[0];else for(var d=0;d<c.length;++d)if(c[d].uri===a.uri){e=
c[d];break}d=c=!1;if(e&&(a.name=e.name,a.desc=e.desc,a.maxbins=e.maxbins?!0:!1,e.capabilities&&(a.capabilities=e.capabilities),d=!0,e.coords&&1==e.coords.length))if(e=e.coords[0],p(e,y.coordSystem))c=!0;else if(y.chains)for(var f in y.chains)p(e,y.chains[f].coords)&&(a.mapping=f,c=!0);return sa(a,c,d)},function(){return b?sa(a):D(a,!0)})}function I(a){(a.baiBlob?new z(a.baiBlob):"encode"==a.transport?new x(a.bamURI+".bai"):new q(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(b){var c=
!1;b&&(b=new Uint8Array(b),c=C(b,0)==t);return c?sa(a,!1,!1,!0):P("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function G(a){(a.indexBlob?new z(a.indexBlob):new q(a.uri+".tbi")).slice(0,65536).fetch(function(b){var c=!1;if(b){var e=new Uint8Array(b);if(31==e[0]||139==e[1])b=l(b),e=new Uint8Array(b),c=C(e,0)==g}return c?sa(a,!1,!1,!0):P('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function P(a){ia.style.display="none";ka.style.display="inline";la.style.display="inline";A(M);a=a||"Custom data format not recognized";M.appendChild(r("h2","Error adding custom data"));M.appendChild(r("p",a));M.appendChild(r("p","Currently supported formats are bigBed, bigWig, and BAM."));V="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var y=this;c=r("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var H=[];if(!this.noRegistryTabs){var N=this.makeButton("Registry","Browse compatible datasources from the DAS registry");H.push(N);for(var Q in this.mappableSources)(function(a){var b=y.makeButton(y.chains[a].srcTag,"Browse datasources mapped from "+y.chains[a].srcTag);H.push(b);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();m(H,b);ua(y.mappableSources[a],a)},!1)})(Q)}Q={};for(var O=0;O<this.defaultSources.length;++O){var Z=
this.defaultSources[O];var Y=Z.group||"Defaults";Q[Y]?Q[Y].push(Z):Q[Y]=[Z]}var na=function(a){var b=a.hub,c=r("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),e=b.altLabel||b.shortLabel||"Unknown";a.mapping&&(e=e+" ("+a.genome+")");e=r("span",[e," ",c]);var d=y.makeButton(e,b.longLabel);d.hub=a;H.push(d);d.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();m(H,d);A(M);b=y.makeLoader(24);b.style.marginLeft="auto";b.style.marginRight="auto";b.style.marginTop=
"100px";M.appendChild(r("div",b,null,{textAlign:"center"}));ia.style.display="none";ka.style.display="none";la.style.display="none";a.getTracks(function(a,b){b&&console.log(b);h(a)})},!1);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=r("li",r("a","Remove hub")),e=r("li",r("a","Enable all")),f=r("li",r("a","Disable all")),g=r("ul",[c,e,f],{className:"dropdown-menu"},{display:"block"}),h=b.clientX;b=b.clientY;h+=document.documentElement.scrollLeft||document.body.scrollLeft;
b+=document.documentElement.scrollTop||document.body.scrollTop;g.style.position="absolute";g.style.top=""+(b+10)+"px";g.style.left=""+(h-30)+"px";y.hPopupHolder.appendChild(g);var n=function(a){console.log("cc");document.body.removeEventListener("click",n,!0);y.hPopupHolder.removeChild(g)};document.body.addEventListener("click",n,!0);c.addEventListener("click",function(b){for(b=0;b<y.hubObjects.length;++b)if(y.hubObjects[b].absURL==a.absURL){y.hubObjects.splice(b,1);break}for(b=0;b<y.hubs.length;++b){var c=
y.hubs[b];"string"===typeof c&&(c={url:c});if(c.url==a.hub.url&&!c.genome||c.genome==a.genome){y.hubs.splice(b,1);break}}y.notifyTier();ha.removeChild(d);m(H,ba);u()},!1);e.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(b=0;b<a.length;++b){var c=a[b].toDallianceSource();y.currentlyActive(c)||y.addTier(c)}})},!1);f.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(b=0;b<a.length;++b){var c=a[b].toDallianceSource();y.currentlyActive(c)&&
y.removeTier(c)}})},!1)},!1);return d},aa=null,ea=null;for(Y in Q)(function(a,b){var c=y.makeButton(a,"Browse the default set of data for this browser");c.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();m(H,c);ua(new w(b))},!1);H.push(c);aa||(aa=c,ea=b)})(Y,Q[Y]);var R=this.makeButton("DAS","Add arbitrary DAS data");H.push(R);var fa=this.makeButton("Binary","Add data in bigwig or bigbed format");H.push(fa);for(Y=0;Y<this.hubObjects.length;++Y)na(this.hubObjects[Y]);var ba=
this.makeButton("+","Connect to a new track-hub");H.push(ba);var ha=r("ul",H,{className:"nav nav-tabs"},{marginBottom:"0px"});c.appendChild(ha);var X,K,da,pa,ja,qa,ra,V=!1,ca=null;Y=r("form",null,{},{display:"inline-block",width:"100%"});Y.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();J();return!1},!0);var M=r("div");M.style.position="relative";M.style.overflow="scroll";Y.appendChild(M);var ma,ta;var ua=function(a,b){ia.style.display="none";ka.style.display="none";la.style.display=
"none";ta&&ta.removeListener(va);ma=b;ta=a;ta.addListenerAndFire(va)};var va=function(a){V=!1;var b=[];A(M);if(a){for(var c=r("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),e=r("table",c,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),d=0,f=[],g=0;g<a.length;++g)f.push(a[g]);f.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(g=0;g<f.length;++g){a=f[g];var h=r("tr"),n=r("td",
null,{},{width:"30px"});n.style.textAlign="center";if(!a.props||a.props.cors){var k=r("input");k.type="checkbox";k.dalliance_source=a;ma&&(k.dalliance_mapping=ma);n.appendChild(k);b.push(k);k.addEventListener("change",function(a){a.target.checked?y.addTier(a.target.dalliance_source):y.removeTier(a.target.dalliance_source)})}else n.appendChild(document.createTextNode("!")),y.makeTooltip(n,r("span",["This data source isn't accessible because it doesn't support ",r("a","CORS",{href:"http://www.w3.org/TR/cors/"}),
"."]));h.appendChild(n);n=r("td");n.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&y.makeTooltip(n,a.desc);h.appendChild(n);c.appendChild(h);++d}var l=function(){for(var a=0;a<b.length;++a){var c=b[a];y.currentlyActive(c.dalliance_source)?c.checked=!0:c.checked=!1}};l();y.addTierListener(function(a){l()});M.appendChild(e)}else M.appendChild(r("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};N&&N.addEventListener("click",
function(a){a.preventDefault();a.stopPropagation();m(H,N);ua(y.availableSources)},!1);fa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();k()},!1);ba.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();u()},!1);R.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();v()},!1);var ka=r("button","Add",{className:"btn btn-primary"});ka.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();J()},!1);var wa=function(b,
c){var e=y.knownSpace;if(e){var d=Math.max(e.min,(e.min+e.max-100)/2)|0;e=new a(e.chr,d,Math.min(d+99,e.max));b.features(e,{},function(a,e){if(e)c?(A(M),M.appendChild(r("h2","Custom data not found")),M.appendChild(r("p","DAS uri: "+b.uri+" is not answering features requests")),V="reset"):(b.credentials=!0,wa(b,!0));else{if(a=/\/([^/]+)\/?$/.exec(b.uri))b.name=a[1];D(b)}})}else alert("Can't confirm track-addition to an uninit browser.")},L=function(a){var b={name:a.name};a.credentials&&(b.credentials=
a.credentials);a.mapping&&"__default__"!=a.mapping&&(b.mapping=a.mapping);a.transport&&(b.transport=a.transport);if("bwg"==a.tier_type)return a.blob?b.bwgBlob=a.blob:a.uri&&(b.bwgURI=a.uri),b;if("bam"==a.tier_type)return a.blob?(b.bamBlob=a.blob,b.baiBlob=a.indexBlob):(b.bamURI=a.uri,b.baiURI=a.indexUri),b;if("tabix"==a.tier_type)return b.tier_type="tabix",b.payload=a.payload,a.blob?(b.blob=a.blob,b.indexBlob=a.indexBlob):(b.uri=a.uri,b.indexUri=a.indexUri),b;if("memstore"==a.tier_type)return b.tier_type=
"memstore",b.payload=a.payload,a.blob?b.blob=a.blob:b.uri=a.uri,b},za=function(a){d(a,function(a,b){if(b){A(M);var c=r("div");c.appendChild(r("h2","Couldn't access custom data"));c.appendChild(r("p",""+b));M.appendChild(c);console.log(a);"https:"===window.location.protocol&&0==a.uri.indexOf("http:")&&y.canFetchPlainHTTP().then(function(a){a||c.appendChild(r("p",[r("strong","HTTP warning: "),"you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.",
r("a","[More info]",{href:y.httpWarningURL,target:"_blank"})]))});V="reset-bin"}else return b=L(a),"bam"==a.tier_type?I(b):"tabix"==a.tier_type?G(b):sa(b,!1,!1,!0)})},sa=function(a,b,c,e){ia.style.display="none";ka.style.display="inline";la.style.display="inline";A(M);M.appendChild(r("h2","Add custom data: step 2"));M.appendChild(document.createTextNode("Label: "));K=r("input","",{value:a.name});M.appendChild(K);qa=r("input","");ra=r("input","");M.appendChild(r("br"));M.appendChild(r("br"));M.appendChild(r("h4",
"Coordinate system: "));da=r("select",null);da.appendChild(r("option",y.nameForCoordSystem(y.coordSystem),{value:"__default__"}));if(y.chains)for(var d in y.chains)da.appendChild(r("option",y.nameForCoordSystem(y.chains[d].coords),{value:d}));da.value=a.mapping||"__default__";M.appendChild(da);b?M.appendChild(r("p","(Based on server response, probably doesn't need changing.)")):(M.appendChild(r("p",[r("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
M.appendChild(r("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));e||(M.appendChild(document.createTextNode("Quantitative: ")),pa=r("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(pa.checked=a.maxbins),M.appendChild(pa),c?M.appendChild(r("p","(Based on server response, probably doesn't need changing.)")):M.appendChild(r("p",[r("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
M.appendChild(r("p",[r("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));K.focus();V="bin"===V||"prompt-bai"===V||"prompt-tbi"===V?"finalize-bin":"finalize";ca=a},oa=null,xa=function(a){d(a,function(a,b){b&&(a.error=b);a=[];for(var c={},e={},d=0;d<oa.length;++d){var f=oa[d];"bam"!=f.tier_type||f.indexBlob||(c[f.blob.name]=f);"tabix"!=f.tier_type||f.indexBlob||(e[f.blob.name]=f)}for(d=0;d<oa.length;++d)f=oa[d],"bai"===
f.tier_type?(b=/(.+)\.bai$/.exec(f.blob.name))&&c[b[1]]&&(c[b[1]].indexBlob=f.blob,a.push(d)):"tabix-index"===f.tier_type&&(b=/(.+)\.tbi$/.exec(f.blob.name))&&e[b[1]]&&(e[b[1]].indexBlob=f.blob,a.push(d));for(b=a.length-1;0<=b;--b)oa.splice(a[b],1);ya()})},ya=function(){A(M);var a=!1,b=r("table",oa.filter(function(a){return!a.hidden}).map(function(b){r("tr").appendChild(r("td",b.name||b.blob.name));var c=b.error?r("span","Error",null,{color:"red"}):b.tier_type?b.payload||b.tier_type:y.makeLoader(16);
var e="unknown";"bwg"==b.tier_type||"memstore"==b.tier_type?e="okay":"bam"==b.tier_type?e=b.indexBlob?"okay":"needs-index":"tabix"==b.tier_type&&(e=b.indexBlob?"okay":"needs-index");if("okay"==e){var d=r("select",null,null,{width:"150px"});d.appendChild(r("option",y.nameForCoordSystem(y.coordSystem),{value:"__default__"}));if(y.chains)for(var f in y.chains)d.appendChild(r("option",y.nameForCoordSystem(y.chains[f].coords),{value:f}));d.value=b.mapping||"__default__";d.addEventListener("change",function(a){b.mapping=
d.value;console.log(b)},!1)}else"needs-index"==e&&(d=r("span","Needs index",{},{color:"red"}),a=!0);return r("tr",[r("td",b.name||b.blob.name),r("td",c),r("td",d)])}),{className:"table table-striped table-condensed"});M.appendChild(b);if(a){M.appendChild(r("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
M.appendChild(document.createTextNode("Index file(s): "));var c=r("input",null,{type:"file",multiple:"multiple"});M.appendChild(c);c.addEventListener("change",function(a){console.log("fileset changed");a=c.files||[];for(var b=0;b<a.length;++b){var e=a[b];e&&(e={blob:e,hidden:!0},oa.push(e),xa(e))}},!1)}},la=r("button","Cancel",{className:"btn"});la.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===V?k():v()},!1);var ia=r("button","Refresh",{className:"btn"});
ia.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();y.queryRegistry(ma)},!1);this.makeTooltip(ia,"Click to re-fetch data from the DAS registry");Q=r("div",[ka," ",la," ",ia]);Q.style.margin="10px";Y.appendChild(Q);c.appendChild(Y);ua(y.availableSources);this.showToolPanel(c);this.setUiMode("add");aa&&(m(H,aa),ua(new w(ea)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":29,"./sourcecompare":36,"./tabix":42,"./thub":43,
"./utils":50}],48:[function(c,v,u){function m(c,m,u){m.fetchAsText(function(h){if(!h)return u(null,"Couldn't fetch index-index");h=h.split(/(.+)([0-9A-F]{10})\n/);for(var m=[],f=[],b=1;b<h.length;b+=3)m.push(h[b]),f.push(parseInt(h[b+1],16));return u(new k(m,f,c))})}function k(c,k,m){this.keys=c;this.offsets=k;this.ix=m}k.prototype.lookup=function(c,k){for(var h,m=(c+"     ").substring(0,5).toLowerCase(),r=0;r<this.keys.length;++r)if(0>m.localeCompare(this.keys[r])){h=this.ix.slice(this.offsets[r-
1],this.offsets[r]-this.offsets[r-1]);break}h||(h=this.ix.slice(this.offsets[this.offsets.length-1]));h.fetchAsText(function(f){f=f.split("\n");for(var b=0;b<f.length;++b)if(0==f[b].indexOf(c.toLowerCase()+" "))return k(f[b].split(" "));return k(null)})};"undefined"!==typeof v&&(v.exports={connectTrix:m})},{}],49:[function(c,v,u){function m(){}function k(b,c){var d=new m;d.data=b;d.data.slice(0,12500).fetch(function(b){if(!b)return c(null,"Couldn't access data");var f=new Uint8Array(b);b=r(f,0);if(440477507==
b)d.readInt=r;else if(1126646042==b)d.readInt=A;else return c(null,"Not a .2bit file, magic=0x"+b.toString(16));b=d.readInt(f,4);if(0!=b)return c(null,"Unsupported version "+b);d.seqCount=d.readInt(f,8);d.seqDict={};var k=16,g=0,m=0,a=function(){for(;g<d.seqCount;){var b=f[k];if(k+b+6>=f.length)return d.data.slice(m+k,12500).fetch(function(b){m+=k;k=0;f=new Uint8Array(b);a()});++k;for(var l="",x=1;x<=b;++x)l+=String.fromCharCode(f[k++]);b=d.readInt(f,k);k+=4;d.seqDict[l]=new h(d,b);++g}return c(d)};
a()})}function h(b,c){this.tbf=b;this.offset=c}if("undefined"!==typeof c){u=c("./bin");var r=u.readInt;var A=u.readIntBE;c=c("./spans");var w=c.Range;var B=c.union;var f=c.intersection}m.prototype.getSeq=function(b){var c=this.seqDict[b];c||(c=this.seqDict["chr"+b]);return c};m.prototype.fetch=function(b,c,f,h){var d=this.getSeq(b);if(d){if(f<=c)return h("");d.fetch(c,f,h)}else return h(null,"Couldn't find "+b)};h.prototype.init=function(b){if(this.seqOffset)return b();var c=this;c.tbf.data.slice(c.offset,
8).fetch(function(d){if(!d)return b("Fetch failed");d=new Uint8Array(d);c._length=c.tbf.readInt(d,0);c.nBlockCnt=c.tbf.readInt(d,4);c.tbf.data.slice(c.offset+8,8*c.nBlockCnt+4).fetch(function(d){if(!d)return b("Fetch failed");d=new Uint8Array(d);for(var f=null,h=0;h<c.nBlockCnt;++h){var g=c.tbf.readInt(d,4*h),k=c.tbf.readInt(d,4*(h+c.nBlockCnt));g=new w(g,g+k-1);f=f?B(f,g):g}c.nBlocks=f;c.mBlockCnt=c.tbf.readInt(d,8*c.nBlockCnt);c.seqLength=(c._length+3)/4|0;c.seqOffset=c.offset+16+8*(c.nBlockCnt+
c.mBlockCnt);return b()})})};var b=["T","C","A","G"];h.prototype.fetch=function(c,h,k){--c;--h;var d=this;this.init(function(l){if(l)return k(null,l);var m=c>>2;l=h+3>>2;if(0>m||l>d.seqLength)return k("Coordinates out of bounds: "+c+":"+h);d.tbf.data.slice(d.seqOffset+m,l-m).salted().fetch(function(g){function l(c){for(;x<=c;){var e=x&3,d=a[(x>>2)-m];p+=b[0==e?d>>6&3:1==e?d>>4&3:2==e?d>>2&3:d&3];++x}}if(null==g)return k("SeqFetch failed");var a=new Uint8Array(g);g=[];if(d.nBlocks){var e=f(new w(c,
h),d.nBlocks);e&&(g=e.ranges())}var p="",x=c;for(e=0;e<g.length;++e){var q=g[e];if(x>q.min())throw"N mismatch...";for(x<q.min()&&l(q.min()-1);x<=q.max();)p+="N",++x}x<=h&&l(h);return k(p)})})};h.prototype.length=function(b){var c=this;this.init(function(d){return d?b(null,d):b(c._length)})};"undefined"!==typeof v&&(v.exports={makeTwoBit:k})},{"./bin":4,"./spans":37}],50:[function(c,v,u){function m(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function k(a,b,c){a[b]?a[b].push(c):a[b]=
[c]}function h(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function r(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function m(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function A(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function w(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var e=0;e<b.length;++e){var f=b[e];f&&("string"==typeof f?f=document.createTextNode(f):
"number"==typeof f&&(f=document.createTextNode(""+f)),a.appendChild(f))}}if(c)for(var g in c)try{a[g]=c[g]}catch(U){throw console.log("error setting "+g),U;}if(d)for(g in d)a.style[g]=d[g];return a}function B(a,b,c,d){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var e=c[b];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}if(d)for(var f in d){c=a;b=f;e=d[f];var g=F[b];if(!g){g="";for(var h=0;h<b.length;++h){var k=b.substring(h,h+1),l=k.toLowerCase();
g=l!=k?g+"-"+l:g+k}F[b]=g}c.setAttribute(g,e)}return a}function f(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function b(a,c){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){var d=null;for(var e=0;e<a.length;++e)d=(null==d?"":d+", ")+b(a[e],c);return"["+(d?d:"")+"]"}c=c||{};d=null;for(e in a)c[e]||void 0!=e&&
"function"!=typeof a[e]&&(d=(null==d?"":d+", ")+e+": "+b(a[e],c));return"{"+(d?d:"")+"}"}return typeof a}function d(a){var b={},c;for(c in a)b[c]=a[c];return b}function q(a){this.value=a;this.listeners=[]}function z(){this.queue=[]}function C(b,c,d){d&&d.salt&&(b=b+"?salt="+g(""+Date.now()+","+ ++a));try{var e;d&&d.timeout&&(e=setTimeout(function(){console.log("timing out "+b);f.abort();return c(null,"Timeout")},d.timeout));var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&
(e&&clearTimeout(e),200>f.status||300<=f.status?c(null,"Error code "+f.status):c(f.responseText))};f.open("GET",b,!0);f.responseType="text";d&&d.credentials&&(f.withCredentials=!0);f.send("")}catch(E){c(null,"Exception "+E)}}function l(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function t(a){return w("a",null,{href:a}).href}if("undefined"!==typeof c)var g=c("./sha1").b64_sha1;var F={};q.prototype.addListener=function(a){this.listeners.push(a)};
q.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};q.prototype.removeListener=function(a){var b=this.listeners;a=A(b,a);0<=a&&b.splice(a,1)};q.prototype.get=function(){return this.value};q.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};z.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};z.prototype.await=
function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var a=0;c={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",
CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof v&&(v.exports={textXHR:C,relativeURL:l,resolveUrlToPage:t,shallowCopy:d,pusho:k,pushnew:m,pushnewo:h,arrayIndexOf:A,pick:r,makeElement:w,makeElementNS:B,removeChildren:f,miniJSONify:b,Observed:q,Awaited:z,AMINO_ACID_TRANSLATION:c})},{"./sha1":34}],51:[function(c,v,u){function m(){this.info=
[]}function k(b,c){this.parser=b;this.sink=c}if("undefined"!==typeof c){var h=c("./sourceadapters").registerParserFactory;c=c("./das");var r=c.DASStylesheet;var A=c.DASStyle;var w=c.DASFeature}var B=/([^;=]+)(=([^;]+))?;?/,f=/##INFO=<([^>]+)>/,b=/([^,=]+)=([^,]+|"[^"]+"),?/;m.prototype.createSession=function(b){return new k(this,b)};k.prototype.parse=function(c){if(0!=c.length)if("#"==c[0]){if(1<c.length&&"#"==c[1]&&(c=f.exec(c))){var d=c[1].split(b);var h=null,k=null;for(c=0;c<d.length-1;c+=3){var l=
d[c+1],m=d[c+2].replace(/"/g,"");"ID"==l?h=m:"Description"==l&&(k=m)}h&&k&&this.parser.info.push({id:h,desc:k})}}else{d=c.split("\t");h=new w;h.segment=d[0];h.id=d[2];h.refAllele=d[3];h.altAlleles=d[4].split(",");h.min=parseInt(d[1]);h.max=h.min+h.refAllele.length-1;d=d[7].split(B);h.info={};for(c=0;c<d.length;c+=4)h.info[d[c+1]]=d[c+3];c=h.altAlleles[0];d=h.refAllele;c.length>d.length?(h.type="insertion",0==c.indexOf(d)?(h.insertion=c.substr(d.length),h.min+=d.length,h.max=h.min-1):h.insertion=c):
h.type=c.length<d.length?"deletion":"substitution";this.sink(h)}};k.prototype.flush=function(){};m.prototype.getStyleSheet=function(b){var c=new r;var d=new A;d.glyph="__INSERTION";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"insertion"},null,d);d=new A;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(255, 60, 60)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"deletion"},null,d);d=new A;d.glyph="PLIMSOLL";
d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"default"},null,d);return b(c)};m.prototype.getDefaultFIPs=function(b){var c=this;b(function(b,d){d.add("Ref. allele",b.refAllele);d.add("Alt. alleles",b.altAlleles.join(","));if(b.info)for(var f=0;f<c.info.length;++f){var h=c.info[f],g=b.info[h.id];void 0!==g&&d.add(h.desc,g)}})};h("vcf",function(){return new m})},{"./das":10,"./sourceadapters":35}],52:[function(c,v,u){c={CONFIG:5,MAJOR:0,
MINOR:13,MICRO:7,BRANCH:"MOLGENIS",toString:function(){var c=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(c+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(c=c+"-"+this.BRANCH);return c}};"undefined"!==typeof v&&(v.exports=c)},{}],53:[function(c,v,u){function m(){function c(a){a=Math.min(a,200);q=a=Math.max(a,0);w.style.left=""+q+"px"}function m(a){a=Math.min(a,200);z=a=Math.max(a,0);v.style.left=""+z+"px"}var u=k("hr",null,{className:"slider-track"}),w=k("hr",null,{className:"slider-thumb active"}),
v=k("hr",null,{className:"slider-thumb"}),f=k("div",[u,w,v],{className:"slider"}),b=0,d=200,q=50,z=100,C=[];f.removeLabels=function(){for(var a=0;a<C.length;++a)f.removeChild(C[a]);C=[]};f.addLabel=function(a,c){a=k("div",c,{className:"slider-label"},{left:""+(0+200*(a-b)/(d-b)|0)+"px"});f.appendChild(a);C.push(a)};var l=document.createEvent("HTMLEvents");l.initEvent("change",!0,!1);Object.defineProperty(f,"value",{get:function(){return b+(q-0)*(d-b)/200},set:function(a){c(0+200*(a-b)/(d-b))}});Object.defineProperty(f,
"value2",{get:function(){return b+(z-0)*(d-b)/200},set:function(a){m(0+200*(a-b)/(d-b))}});Object.defineProperty(f,"active",{get:function(){return w.classList.contains("active")?1:2},set:function(a){1==a?(w.classList.add("active"),v.classList.remove("active")):(v.classList.add("active"),w.classList.remove("active"))}});Object.defineProperty(f,"min",{get:function(){return b},set:function(a){b=a}});Object.defineProperty(f,"max",{get:function(){return d},set:function(a){d=a}});var t,g;u=function(b){g=
this==w?1:2;g!=f.active&&(f.active=g,f.dispatchEvent(l));b.stopPropagation();b.preventDefault();window.addEventListener("mousemove",F,!1);window.addEventListener("mouseup",a,!1);t=b.clientX-(1==g?q:z)};w.addEventListener("mousedown",u,!1);v.addEventListener("mousedown",u,!1);var F=function(a){1==g?c(a.clientX-t):m(a.clientX-t);f.dispatchEvent(l)},a=function(b){window.removeEventListener("mousemove",F,!1);window.removeEventListener("mouseup",a,!1)};return f}if("undefined"!==typeof c)var k=c("./utils").makeElement;
"undefined"!==typeof v&&(v.exports=m)},{"./utils":50}],54:[function(c,v,u){v=c("./promise/promise").Promise;c=c("./promise/polyfill").polyfill;u.Promise=v;u.polyfill=c},{"./promise/polyfill":59,"./promise/promise":60}],55:[function(c,v,u){var m=c("./utils").isArray,k=c("./utils").isFunction;u.all=function(c){if(!m(c))throw new TypeError("You must pass an array to all.");return new this(function(h,m){function r(b){return function(c){u[b]=c;0===--f&&h(u)}}var u=[],f=c.length,b;0===f&&h([]);for(var d=
0;d<c.length;d++)(b=c[d])&&k(b.then)?b.then(r(d),m):(u[d]=b,0===--f&&h(u))})}},{"./utils":64}],56:[function(c,v,u){(function(c,k){function h(){return function(){c.nextTick(w)}}function m(){var b=0,c=new f(w),d=document.createTextNode("");c.observe(d,{characterData:!0});return function(){d.data=b=++b%2}}function v(){return function(){b.setTimeout(w,1)}}function w(){for(var b=0;b<d.length;b++){var c=d[b];(0,c[0])(c[1])}d=[]}var B="undefined"!==typeof window?window:{},f=B.MutationObserver||B.WebKitMutationObserver,
b="undefined"!==typeof k?k:void 0===this?window:this,d=[];var q="undefined"!==typeof c&&"[object process]"==={}.toString.call(c)?h():f?m():v();u.asap=function(b,c){1===d.push([b,c])&&q()}}).call(this,c("2ionoC"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"2ionoC":65}],57:[function(c,v,u){u.cast=function(c){return c&&"object"===typeof c&&c.constructor===this?c:new this(function(k){k(c)})}},{}],58:[function(c,v,u){var m={instrument:!1};u.config=m;u.configure=function(c,
h){if(2===arguments.length)m[c]=h;else return m[c]}},{}],59:[function(c,v,u){(function(m){var k=c("./promise").Promise,h=c("./utils").isFunction;u.polyfill=function(){var c="undefined"!==typeof m?m:"undefined"!==typeof window&&window.document?window:self;"Promise"in c&&"cast"in c.Promise&&"resolve"in c.Promise&&"reject"in c.Promise&&"all"in c.Promise&&"race"in c.Promise&&function(){var k;new c.Promise(function(c){k=c});return h(k)}()||(c.Promise=k)}}).call(this,"undefined"!==typeof self?self:"undefined"!==
typeof window?window:{})},{"./promise":60,"./utils":64}],60:[function(c,v,u){function m(a){if(!l(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof m))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];k(a,this)}function k(a,c){function d(a){B(c,a)}function e(a){b(c,a)}try{a(d,e)}catch(S){e(S)}}function h(a,c,
d,e){var f=l(d);if(f)try{var g=d(e);var h=!0}catch(P){var k=!0;var n=P}else g=e,h=!0;w(c,g)||(f&&h?B(c,g):k?b(c,n):a===x?B(c,g):a===J&&b(c,g))}function r(a,b,c,d){a=a._subscribers;var e=a.length;a[e]=b;a[e+x]=c;a[e+J]=d}function A(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],h(b,c,d,f);a._subscribers=null}function w(a,c){var d=null,e;try{if(a===c)throw new TypeError("A promises callback cannot return that same promise.");if(C(c)&&(d=c.then,l(d)))return d.call(c,
function(b){if(e)return!0;e=!0;c!==b?B(a,b):f(a,b)},function(c){if(e)return!0;e=!0;b(a,c)}),!0}catch(S){if(e)return!0;b(a,S);return!0}return!1}function B(a,b){a===b?f(a,b):w(a,b)||f(a,b)}function f(a,b){a._state===e&&(a._state=p,a._detail=b,z.async(d,a))}function b(a,b){a._state===e&&(a._state=p,a._detail=b,z.async(q,a))}function d(a){A(a,a._state=x)}function q(a){A(a,a._state=J)}var z=c("./config").config;c("./config");var C=c("./utils").objectOrFunction,l=c("./utils").isFunction;c("./utils");v=
c("./cast").cast;var t=c("./all").all,g=c("./race").race,F=c("./resolve").resolve,a=c("./reject").reject;c=c("./asap").asap;z.async=c;var e=void 0,p=0,x=1,J=2;m.prototype={constructor:m,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;z.async(function(){h(c._state,d,e[c._state-1],c._detail)})}else r(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}};m.all=t;m.cast=v;m.race=g;m.resolve=
F;m.reject=a;u.Promise=m},{"./all":55,"./asap":56,"./cast":57,"./config":58,"./race":61,"./reject":62,"./resolve":63,"./utils":64}],61:[function(c,v,u){var m=c("./utils").isArray;u.race=function(c){if(!m(c))throw new TypeError("You must pass an array to race.");return new this(function(h,k){for(var m,r=0;r<c.length;r++)(m=c[r])&&"function"===typeof m.then?m.then(h,k):h(m)})}},{"./utils":64}],62:[function(c,v,u){u.reject=function(c){return new this(function(k,h){h(c)})}},{}],63:[function(c,v,u){u.resolve=
function(c){return new this(function(k,h){k(c)})}},{}],64:[function(c,v,u){function m(c){return"function"===typeof c}c=Date.now||function(){return(new Date).getTime()};u.objectOrFunction=function(c){return m(c)||"object"===typeof c&&null!==c};u.isFunction=m;u.isArray=function(c){return"[object Array]"===Object.prototype.toString.call(c)};u.now=c},{}],65:[function(c,v,u){function m(){}c=v.exports={};c.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(c){return window.setImmediate(c)};
if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var c=[];window.addEventListener("message",function(h){var k=h.source;k!==window&&null!==k||"process-tick"!==h.data||(h.stopPropagation(),0<c.length&&c.shift()())},!0);return function(h){c.push(h);window.postMessage("process-tick","*")}}return function(c){setTimeout(c,0)}}();c.title="browser";c.browser=!0;c.env={};c.argv=[];c.on=m;c.addListener=m;c.once=m;c.off=m;c.removeListener=m;c.removeAllListeners=m;c.emit=m;c.binding=
function(c){throw Error("process.binding is not supported");};c.cwd=function(){return"/"};c.chdir=function(c){throw Error("process.chdir is not supported");}},{}],66:[function(c,v,u){function m(){}function k(){this.was=[0]}function h(a,b,c){this.hufts=new Int32Array(4320);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=0;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new r;this.check=this.write=
this.read=this.bitb=this.bitk=this.last=0;this.inftree=new A}function r(){}function A(){}function w(a,b,c,d,f){if(0!=f){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&f==a.length)c.set(a,d);else if(F)a=a.subarray(b,b+f),c.set(a,d);else if(1==a.BYTES_PER_ELEMENT&&100<f)a=new Uint8Array(a.buffer,a.byteOffset+b,f),c.set(a,d);else for(var e=0;e<f;++e)c[d+e]=a[b+e]}}function B(a,b,c,d){a=b?c?new Uint8Array(a,b,c):new Uint8Array(a,b,a.byteLength-b):new Uint8Array(a);c=new m;c.inflateInit(15,!0);
c.next_in=a;c.next_in_index=0;c.avail_in=a.length;a=[];for(var e=0;;){var f=new Uint8Array(32E3);c.next_out=f;c.next_out_index=0;c.avail_out=f.length;var g=c.inflate(0);if(0!=g&&1!=g&&-5!=g)throw c.msg;if(0!=c.avail_out){var h=new Uint8Array(f.length-c.avail_out);w(f,0,h,0,f.length-c.avail_out);f=h}a.push(f);e+=f.length;if(1==g||-5==g)break}d&&(d[0]=(b||0)+c.next_in_index);if(1==a.length)return a[0].buffer;b=new Uint8Array(e);for(c=d=0;c<a.length;++c)e=a[c],w(e,0,b,d,e.length),d+=e.length;return b.buffer}
var f=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],b=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,
82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,
46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,
0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,
254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,
0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,
7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,
0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],d=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,
80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],q=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],l=[0,
0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];m.prototype.inflateInit=function(a,b){a||(a=15);b&&(b=!1);this.istate=new k;return this.istate.inflateInit(this,b?-a:a)};m.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};m.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};m.prototype.inflateSync=function(){return istate.inflateSync(this)};m.prototype.inflateSetDictionary=function(a,
b){return istate.inflateSetDictionary(this,a,b)};k.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return 0};k.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return 0};k.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new h(a,
0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return 0};k.prototype.inflate=function(a,b){var c;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?-5:0;for(c=-5;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;var d=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+d)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(d&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=
(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=
0;break}0==c&&(c=b);if(1!=c)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=
(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}};k.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;
a.adler=a._adler.adler32(0,null,0,0);e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,d=c-e);a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=7;return 0};var t=[0,0,255,255];k.prototype.inflateSync=function(a){var b,c;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return-5;var d=a.next_in_index;for(c=a.istate.marker;0!=b&&4>c;)a.next_in[d]==t[c]?c++:c=0!=a.next_in[d]?0:4-c,d++,b--;a.total_in+=d-a.next_in_index;a.next_in_index=d;a.avail_in=
b;a.istate.marker=c;if(4!=c)return-3;b=a.total_in;d=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=d;a.istate.mode=7;return 0};k.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var g=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];h.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.read=this.write=this.bitb=this.bitk=this.mode=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,
null,0,0))};h.prototype.proc=function(a,c){var e;var h=a.next_in_index;var k=a.avail_in;var n=this.bitb;var l=this.bitk;var m=this.write;for(e=m<this.read?this.read-m-1:this.end-m;;)switch(this.mode){case 0:for(;3>l;){if(0!=k)c=0;else return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);k--;n|=(a.next_in[h++]&255)<<l;l+=8}var q=n&7;this.last=q&1;switch(q>>>1){case 0:n>>>=3;l-=3;q=l&7;n>>>=q;l-=q;this.mode=1;break;case 1:var r=
new Int32Array(1);var u=new Int32Array(1);var t=[];var v=[];q=u;var z=t,A=v;r[0]=9;q[0]=5;z[0]=b;A[0]=d;this.codes.init(r[0],u[0],t[0],0,v[0],0,a);n>>>=3;l-=3;this.mode=6;break;case 2:n>>>=3;l-=3;this.mode=3;break;case 3:return n>>>=3,l-=3,this.mode=13,a.msg="invalid block type",c=-3,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c)}break;case 1:for(;32>l;){if(0!=k)c=0;else return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=
h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);k--;n|=(a.next_in[h++]&255)<<l;l+=8}if((~n>>>16&65535)!=(n&65535))return this.mode=13,a.msg="invalid stored block lengths",c=-3,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);this.left=n&65535;n=l=0;this.mode=0!=this.left?2:0!=this.last?7:0;break;case 2:if(0==k)return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,
write=m,this.inflate_flush(a,c);if(0==e&&(m==end&&0!=read&&(m=0,e=m<this.read?this.read-m-1:this.end-m),0==e&&(this.write=m,c=this.inflate_flush(a,c),m=this.write,e=m<this.read?this.read-m-1:this.end-m,m==this.end&&0!=this.read&&(m=0,e=m<this.read?this.read-m-1:this.end-m),0==e)))return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);c=0;q=this.left;q>k&&(q=k);q>e&&(q=e);w(a.next_in,h,this.window,m,q);h+=q;k-=q;m+=q;e-=q;if(0!=
(this.left-=q))break;this.mode=0!=this.last?7:0;break;case 3:for(;14>l;){if(0!=k)c=0;else return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);k--;n|=(a.next_in[h++]&255)<<l;l+=8}this.table=q=n&16383;if(29<(q&31)||29<(q>>5&31))return this.mode=9,a.msg="too many length or distance symbols",c=-3,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);q=258+(q&
31)+(q>>5&31);if(null==this.blens||this.blens.length<q)this.blens=new Int32Array(q);else for(v=0;v<q;v++)this.blens[v]=0;n>>>=14;l-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>l;){if(0!=k)c=0;else return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);k--;n|=(a.next_in[h++]&255)<<l;l+=8}this.blens[g[this.index++]]=n&7;n>>>=3;l-=3}for(;19>this.index;)this.blens[g[this.index++]]=0;this.bb[0]=7;q=
this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(0!=q)return c=q,-3==c&&(this.blens=null,this.mode=9),this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,write=m,this.inflate_flush(a,c);this.index=0;this.mode=5;case 5:for(;;){q=this.table;if(!(this.index<258+(q&31)+(q>>5&31)))break;for(q=this.bb[0];l<q;){if(0!=k)c=0;else return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,
c);k--;n|=(a.next_in[h++]&255)<<l;l+=8}q=this.hufts[3*(this.tb[0]+(n&f[q]))+1];u=this.hufts[3*(this.tb[0]+(n&f[q]))+2];if(16>u)n>>>=q,l-=q,this.blens[this.index++]=u;else{v=18==u?7:u-14;for(t=18==u?11:3;l<q+v;){if(0!=k)c=0;else return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);k--;n|=(a.next_in[h++]&255)<<l;l+=8}n>>>=q;l-=q;t+=n&f[v];n>>>=v;l-=v;v=this.index;q=this.table;if(v+t>258+(q&31)+(q>>5&31)||16==u&&1>v)return this.blens=
null,this.mode=9,a.msg="invalid bit length repeat",c=-3,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);u=16==u?this.blens[v-1]:0;do this.blens[v++]=u;while(0!=--t);this.index=v}}this.tb[0]=-1;r=new Int32Array(1);u=new Int32Array(1);t=new Int32Array(1);v=new Int32Array(1);r[0]=9;u[0]=6;q=this.table;q=this.inftree.inflate_trees_dynamic(257+(q&31),1+(q>>5&31),this.blens,r,u,t,v,this.hufts,a);if(0!=q)return-3==q&&(this.blens=null,
this.mode=13),c=q,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);this.codes.init(r[0],u[0],this.hufts,t[0],this.hufts,v[0],a);this.mode=6;case 6:this.bitb=n;this.bitk=l;a.avail_in=k;a.total_in+=h-a.next_in_index;a.next_in_index=h;this.write=m;if(1!=(c=this.codes.proc(this,a,c)))return this.inflate_flush(a,c);c=0;this.codes.free(a);h=a.next_in_index;k=a.avail_in;n=this.bitb;l=this.bitk;m=this.write;e=m<this.read?this.read-m-
1:this.end-m;if(0==this.last){this.mode=0;break}this.mode=7;case 7:this.write=m;c=this.inflate_flush(a,c);m=this.write;if(this.read!=this.write)return this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);mode=12;case 8:return c=1,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c);case 9:return c=-3,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,
a.next_in_index=h,this.write=m,this.inflate_flush(a,c);default:return c=-2,this.bitb=n,this.bitk=l,a.avail_in=k,a.total_in+=h-a.next_in_index,a.next_in_index=h,this.write=m,this.inflate_flush(a,c)}};h.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};h.prototype.set_dictionary=function(a,b,c){w(a,b,window,0,c);this.read=this.write=c};h.prototype.sync_point=function(){return 1==this.mode};h.prototype.inflate_flush=function(a,b){var c=a.next_out_index;var d=this.read;var e=
(d<=this.write?this.write:this.end)-d;e>a.avail_out&&(e=a.avail_out);0!=e&&-5==b&&(b=0);a.avail_out-=e;a.total_out+=e;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,d,e));w(this.window,d,a.next_out,c,e);c+=e;d+=e;d==this.end&&(d=0,this.write==this.end&&(this.write=0),e=this.write-d,e>a.avail_out&&(e=a.avail_out),0!=e&&-5==b&&(b=0),a.avail_out-=e,a.total_out+=e,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,d,e)),w(this.window,d,a.next_out,
c,e),c+=e,d+=e);a.next_out_index=c;this.read=d;return b};r.prototype.init=function(a,b,c,d,f,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=f;this.dtree_index=g;this.tree=null};r.prototype.proc=function(a,b,c){var d,e;var g=b.next_in_index;var h=b.avail_in;var k=a.bitb;var l=a.bitk;var m=a.write;for(e=m<a.read?a.read-m-1:a.end-m;;)switch(this.mode){case 0:if(258<=e&&10<=h&&(a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=
m,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),g=b.next_in_index,h=b.avail_in,k=a.bitb,l=a.bitk,m=a.write,e=m<a.read?a.read-m-1:a.end-m,0!=c)){this.mode=1==c?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(d=this.need;l<d;){if(0!=h)c=0;else return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);h--;k|=(b.next_in[g++]&255)<<
l;l+=8}d=3*(this.tree_index+(k&f[d]));k>>>=this.tree[d+1];l-=this.tree[d+1];var p=this.tree[d];if(0==p){this.lit=this.tree[d+2];this.mode=6;break}if(0!=(p&16)){this.get=p&15;this.len=this.tree[d+2];this.mode=2;break}if(0==(p&64)){this.need=p;this.tree_index=d/3+this.tree[d+2];break}if(0!=(p&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";c=-3;a.bitb=k;a.bitk=l;b.avail_in=h;b.total_in+=g-b.next_in_index;b.next_in_index=g;a.write=m;return a.inflate_flush(b,c);case 2:for(d=this.get;l<
d;){if(0!=h)c=0;else return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);h--;k|=(b.next_in[g++]&255)<<l;l+=8}this.len+=k&f[d];k>>=d;l-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(d=this.need;l<d;){if(0!=h)c=0;else return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);h--;k|=(b.next_in[g++]&255)<<l;l+=8}d=3*(this.tree_index+
(k&f[d]));k>>=this.tree[d+1];l-=this.tree[d+1];p=this.tree[d];if(0!=(p&16)){this.get=p&15;this.dist=this.tree[d+2];this.mode=4;break}if(0==(p&64)){this.need=p;this.tree_index=d/3+this.tree[d+2];break}this.mode=9;b.msg="invalid distance code";c=-3;a.bitb=k;a.bitk=l;b.avail_in=h;b.total_in+=g-b.next_in_index;b.next_in_index=g;a.write=m;return a.inflate_flush(b,c);case 4:for(d=this.get;l<d;){if(0!=h)c=0;else return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=
m,a.inflate_flush(b,c);h--;k|=(b.next_in[g++]&255)<<l;l+=8}this.dist+=k&f[d];k>>=d;l-=d;this.mode=5;case 5:for(d=m-this.dist;0>d;)d+=a.end;for(;0!=this.len;){if(0==e&&(m==a.end&&0!=a.read&&(m=0,e=m<a.read?a.read-m-1:a.end-m),0==e&&(a.write=m,c=a.inflate_flush(b,c),m=a.write,e=m<a.read?a.read-m-1:a.end-m,m==a.end&&0!=a.read&&(m=0,e=m<a.read?a.read-m-1:a.end-m),0==e)))return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);a.window[m++]=a.window[d++];
e--;d==a.end&&(d=0);this.len--}this.mode=0;break;case 6:if(0==e&&(m==a.end&&0!=a.read&&(m=0,e=m<a.read?a.read-m-1:a.end-m),0==e&&(a.write=m,c=a.inflate_flush(b,c),m=a.write,e=m<a.read?a.read-m-1:a.end-m,m==a.end&&0!=a.read&&(m=0,e=m<a.read?a.read-m-1:a.end-m),0==e)))return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);c=0;a.window[m++]=this.lit;e--;this.mode=0;break;case 7:7<l&&(l-=8,h++,g--);a.write=m;c=a.inflate_flush(b,c);m=a.write;
if(a.read!=a.write)return a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);this.mode=8;case 8:return c=1,a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);case 9:return c=-3,a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=g,a.write=m,a.inflate_flush(b,c);default:return c=-2,a.bitb=k,a.bitk=l,b.avail_in=h,b.total_in+=g-b.next_in_index,b.next_in_index=
g,a.write=m,a.inflate_flush(b,c)}};r.prototype.free=function(a){};r.prototype.inflate_fast=function(a,b,c,d,g,h,k,l){var e=l.next_in_index;var m=l.avail_in;var n=k.bitb;var p=k.bitk;var q=k.write;var r=q<k.read?k.read-q-1:k.end-q;a=f[a];var u=f[b];do{for(;20>p;)m--,n|=(l.next_in[e++]&255)<<p,p+=8;var t=n&a;var v=c;var x=d;var z=3*(x+t);if(0==(b=v[z]))n>>=v[z+1],p-=v[z+1],k.window[q++]=v[z+2],r--;else{do{n>>=v[z+1];p-=v[z+1];if(0!=(b&16)){b&=15;var A=v[z+2]+(n&f[b]);n>>=b;for(p-=b;15>p;)m--,n|=(l.next_in[e++]&
255)<<p,p+=8;t=n&u;v=g;x=h;z=3*(x+t);b=v[z];do if(n>>=v[z+1],p-=v[z+1],0!=(b&16)){for(b&=15;p<b;)m--,n|=(l.next_in[e++]&255)<<p,p+=8;t=v[z+2]+(n&f[b]);n>>=b;p-=b;r-=A;if(q>=t)t=q-t,k.window[q++]=k.window[t++],k.window[q++]=k.window[t++],A-=2;else{t=q-t;do t+=k.end;while(0>t);b=k.end-t;if(A>b){A-=b;if(0<q-t&&b>q-t){do k.window[q++]=k.window[t++];while(0!=--b)}else w(k.window,t,k.window,q,b),q+=b;t=0}}do k.window[q++]=k.window[t++];while(0!=--A);break}else if(0==(b&64))t+=v[z+2],t+=n&f[b],z=3*(x+t),
b=v[z];else return l.msg="invalid distance code",A=l.avail_in-m,A=p>>3<A?p>>3:A,m+=A,e-=A,p-=A<<3,k.bitb=n,k.bitk=p,l.avail_in=m,l.total_in+=e-l.next_in_index,l.next_in_index=e,k.write=q,-3;while(1);break}if(0==(b&64)){if(t+=v[z+2],t+=n&f[b],z=3*(x+t),0==(b=v[z])){n>>=v[z+1];p-=v[z+1];k.window[q++]=v[z+2];r--;break}}else{if(0!=(b&32))return A=l.avail_in-m,A=p>>3<A?p>>3:A,m+=A,e-=A,p-=A<<3,k.bitb=n,k.bitk=p,l.avail_in=m,l.total_in+=e-l.next_in_index,l.next_in_index=e,k.write=q,1;l.msg="invalid literal/length code";
A=l.avail_in-m;A=p>>3<A?p>>3:A;m+=A;e-=A;p-=A<<3;k.bitb=n;k.bitk=p;l.avail_in=m;l.total_in+=e-l.next_in_index;l.next_in_index=e;k.write=q;return-3}}while(1)}}while(258<=r&&10<=m);A=l.avail_in-m;A=p>>3<A?p>>3:A;e-=A;k.bitb=n;k.bitk=p-(A<<3);l.avail_in=m+A;l.total_in+=e-l.next_in_index;l.next_in_index=e;k.write=q;return 0};A.prototype.huft_build=function(a,b,c,d,f,g,h,k,l,m,q){var e,n,p,r;var u=0;var t=c;do this.c[a[b+u]]++,u++,t--;while(0!=t);if(this.c[0]==c)return h[0]=-1,k[0]=0;var v=k[0];for(n=
1;15>=n&&0==this.c[n];n++);var x=n;v<n&&(v=n);for(t=15;0!=t&&0==this.c[t];t--);m=t;v>t&&(v=t);k[0]=v;for(k=1<<n;n<t;n++,k<<=1)if(0>(k-=this.c[n]))return-3;if(0>(k-=this.c[t]))return-3;this.c[t]+=k;this.x[1]=n=0;u=1;for(p=2;0!=--t;)this.x[p]=n+=this.c[u],p++,u++;u=t=0;do 0!=(n=a[b+u])&&(this.v[this.x[n]++]=t),u++;while(++t<c);c=this.x[m];u=this.x[0]=t=0;b=-1;var z=-v;for(r=p=this.u[0]=0;x<=m;x++)for(a=this.c[x];0!=a--;){for(;x>z+v;){b++;z+=v;r=m-z;r=r>v?v:r;if((e=1<<(n=x-z))>a+1&&(e-=a+1,p=x,n<r))for(;++n<
r&&!((e<<=1)<=this.c[++p]);)e-=this.c[p];r=1<<n;if(1440<this.hn[0]+r)return-3;this.u[b]=p=this.hn[0];this.hn[0]+=r;0!=b?(this.x[b]=t,this.r[0]=n,this.r[1]=v,n=t>>>z-v,this.r[2]=p-this.u[b-1]-n,w(this.r,0,l,3*(this.u[b-1]+n),3)):h[0]=p}this.r[1]=x-z;u>=c?this.r[0]=192:q[u]<d?(this.r[0]=256>this.v[u]?0:96,this.r[2]=this.v[u++]):(this.r[0]=g[this.v[u]-d]+16+64,this.r[2]=f[this.v[u++]-d]);e=1<<x-z;for(n=t>>>z;n<r;n+=e)w(this.r,0,l,3*(p+n),3);for(n=1<<x-1;0!=(t&n);n>>>=1)t^=n;t^=n;for(n=(1<<z)-1;(t&n)!=
this.x[b];)b--,z-=v,n=(1<<z)-1}return 0!=k&&1!=m?-5:0};A.prototype.inflate_trees_bits=function(a,b,c,d,f){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)f.msg="oversubscribed dynamic bit lengths tree";else if(-5==a||0==b[0])f.msg="incomplete dynamic bit lengths tree",a=-3;return a};A.prototype.inflate_trees_dynamic=function(a,b,c,d,f,g,h,k,m){this.initWorkArea(288);this.hn[0]=0;g=this.huft_build(c,0,a,257,q,z,g,d,k,this.hn,this.v);if(0!=g||
0==d[0])return-3==g?m.msg="oversubscribed literal/length tree":-4!=g&&(m.msg="incomplete literal/length tree",g=-3),g;this.initWorkArea(288);g=this.huft_build(c,a,b,0,C,l,h,f,k,this.hn,this.v);return 0!=g||0==f[0]&&257<a?(-3==g?m.msg="oversubscribed distance tree":-5==g?(m.msg="incomplete distance tree",g=-3):-4!=g&&(m.msg="empty distance tree with lengths",g=-3),g):0};A.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),
this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;w(this.c,0,this.u,0,15);w(this.c,0,this.x,0,16)};var F="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof v&&(v.exports={inflateBuffer:B,arrayCopy:w})},{}]},{},[17]);
